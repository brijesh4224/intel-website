<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimize LLVM Code Generation for Data Analytics</title>

    <!-- font family -->
    <link href="https://fonts.cdnfonts.com/css/intel-clear" rel="stylesheet">
    <link rel="stylesheet" href="/css/dk_arria_10_FPGA_developer_center.css">
    <link rel="stylesheet"href="/css/dk_developer_edge_iot_5G_industrial_automation_see_all_Intelligent_connection_management_for_automated_handover.css">
    <link rel="stylesheet"href="/css/dk_developer_edge_iot_&_5G_optimize_fine_tuning_and_deployment_of_LLMs_on_an_ai_pc.css">
    <link rel="stylesheet" href="/css/rushita_automotive.css">
    <!-- header footer -->
    <link rel="stylesheet" href='/css/yatri.css'>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">

</head>

<style>
    .dk_color1{
        color: #069 !important;
        font-weight: 700 !important;
    }
    .dk_color2{
        color: #b24501;
    }
    /****** Device Information ******/
        .mv_deploy_nav_tab{
            background-color: #fff;
        }
        .mv_deploy_nav_pills{
            border-bottom: 1px solid #E6E6E6;
            flex-wrap: nowrap !important;
            overflow-x: auto !important;
            width: 100% !important;
        }
        .mv_deploy_nav_link {
            color: #0068b5 !important;
        }
        .mv_deploy_nav_pills .mv_deploy_nav_link{
            background-color: #fff !important;
            text-wrap: nowrap !important;
        }
        .mv_deploy_nav_pills .mv_deploy_nav_link.active{
            border-radius: 0rem !important;
            color: #0068b5 !important;
            border-bottom: 4px solid #00aeef;
            background-color: #F2F2F2 !important;
        }
        .mv_deploy_nav_pills .mv_deploy_nav_link:hover{
            border-radius: 0rem;
            background-color: #F2F2F2 !important;
        }
        .mv_gpu_flex_padd{
            padding: 3rem 0rem;
        }
        .mv_gpu_flex{
            align-content: center;
        }
        .mv_gpu_flex h1{
            font-weight: 350;
        }
        .mv_gpu_flex p{
            margin-bottom: .5rem;
        }
        .mv_gpu_flex p a{
            color: #0068b5;
            border-bottom: 1px dashed #0068b5;
        }
        .mv_gpu_flex p a:hover{
            border-bottom: 1px solid #0068b5;
        }
        .mv_gpu_flex_img img{
            width: 100%;
        }
        .mv_enable_boundless_padd{
            padding: 3rem 0rem;
        }
        .mv_enable_img img{
            width: 100%;
            margin-bottom: 10px;
        }
    @media(max-width:768px){
        .mv_product_table{
            width: 100% !important;
        }
    }
</style>

<body>
    <!-- header -->
    <div id="navbar"></div>

    <!-------------------------------------------------------------------------->
    <section class="m_ai_tdrop" style="border-bottom: 1px solid rgb(226, 221, 221);">
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Developers
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="#">Overview</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Topics & Technologies</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Tools</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Resources & Documentation</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Learn</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Community & Events</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Developer Programs</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Get Help</a></li>
            </ul>
        </div>
    
        <div class="m_ai_shlash">/</div>
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Tools
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="#">Software Catalog</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">oneAPI</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Open Edge Platform</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">FPGA</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Active Management Technology SDK</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Advisor</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® AI Reference Models</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Collaboration Suite for WebRTC SDK</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Tiber™ AI Cloud</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Distribution for Python*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Distribution for GDB*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® DPC++ Compatibility Tool</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Dynamic Application Loader</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Frameworks</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Embree</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Extension for Scikit-learn*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Fortran Compiler</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Graphics Performance Analyzers</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Homomorphic Encryption Toolkit</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® In-Band Manageability</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Integrated Performance Primitives</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Integrated Simulation Infrastructure with Modeling</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Instruction Set Architecture (ISA) Extensions</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Intelligent Storage Acceleration Library (Intel® ISA-L)</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Modin*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® MPI Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Neural Compressor</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">OpenCL™ Runtime</a></li>   
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Open Image Denoise</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Open Path Guiding Library (Intel® Open PGL)</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Pin</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Platform Analysis Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel Tools for OpenCL™ Software</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel Tools for OpenCL™ Applications</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OpenSWR</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">OpenVINO™ Toolkit</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Open Volume Kernel Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Optimization for XGBoost*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OSPRay</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OSPRay for Hydra*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OSPRay Studio</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">PyTorch* Optimizations from Intel</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">TensorFlow* Optimizations from Intel</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Rendering Toolkit</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Smart Edge Open</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Software Guard Extensions</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Secure Device Onboard</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Software Development Emulator</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Quantum SDK</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Query Processing Library (Intel® QPL)</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Video Processing Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® VTune™ Profiler</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Resellers</a></li>
            </ul>
        </div>

        <div class="m_ai_shlash">/</div>
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                oneAPI
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="#">Overview</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Data Parallel C++/SYCL*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Toolkits</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Tech Articles & How-Tos</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Components</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Code Samples</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Training</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Documentation</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Support</a></li>
            </ul>
        </div>

        <div class="m_ai_shlash">/</div>
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Tech Articles & How-Tos
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="#">Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">News Updates</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Webinars</a></li>
            </ul>
        </div>

        <div class="m_ai_shlash">/</div>
        <div class="m_ai_httl">Optimize LLVM Code Generation for Data Analytics</div>
    </section>
    <!-------------------------------------------------------------------------------------------------------->

    <!-- VMware Horizon -->
    <section>
        <div class="mv_vmware_bg_color">
            <div class="container">
                <div class="mv_vmware_padd">
                    <div class="row">
                        <div class="col-md-12 col-sm-12">
                            <div class="mv_vmware_heading">
                                <h3>Optimize LLVM Code Generation for Data Analytics Using Vectorization</h3>
                            </div>
                        </div>
                    </div>
                    <div class="mv_cd_page_marquee_info">
                        <div class="mv_cd_page_marquee_action">
                            <div class="mv_cd_page_marquee_action_padd">
                                <label for="">ID</label>
                                <span>672732</span>
                            </div>
                            <div class="mv_cd_page_marquee_action_padd">
                                <label for="">Updated</label>
                                <span>8/6/2020</span>
                            </div>
                            <div class="mv_cd_page_marquee_action_padd">
                                <label for="">Version</label>
                                <span>Latest</span>
                            </div>
                            <div class="mv_cd_page_marquee_action_padd">
                                <label for=""></label>
                                <span>Public</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="container py-5">
        <div class="row">
            <div class="d-flex justify-content-end col-xl-10 py-3 d-md-none">
                <i class="fa-solid fa-print fs-4 px-2 " style="color:#0068B5"></i>
                <i class="fa-regular fa-envelope fs-4 px-2" style="color:#0068B5"></i>
            </div>
            <div class="col-lg-3 col-md-4">
                <!-- nav -->
                <div class="VK_sticky_side_bar VK_side_bar_postion_stickey">
                    <div>
                        <div class="VK_sidebar_dropdown">
                            <details>
                                <summary>
                                    <a href="#dk_The_problem" class="text-decoration-none VK_a">
                                        The Problem and Acceleration via LLVM
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_analyzing" class="text-decoration-none VK_a my-1">
                                            Analyzing the Design
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_confirming" class="text-decoration-none VK_a my-1">
                                            Confirming Vectorization Opportunity by Profiling
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_vectorization" class="text-decoration-none VK_a my-1">
                                            Vectorization Approaches
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <details>
                                <summary>
                                    <a href="#dk_auto_vec" class="text-decoration-none VK_a">
                                        Auto-Vectorization for LLVM Code Generation
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_start_example" class="text-decoration-none VK_a my-1">
                                            Start from a Basic Example 
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_enable_pass" class="text-decoration-none VK_a my-1">
                                            Enable the Loop Vectorization Optimization Pass
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_set_engine" class="text-decoration-none VK_a my-1">
                                            Set Up CPU Information for the Engine
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_set_option" class="text-decoration-none VK_a my-1">
                                            Set the Clang Optimization Option
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <details>
                                <summary>
                                    <a href="#dk_data_prog" class="text-decoration-none VK_a">
                                            Data-Oriented Programming
                                    </a>
                                </summary>
                                    <ul class="list-unstyled ps-3 mb-0">
                                        <li>
                                            <a href="#dk_example" class="text-decoration-none VK_a my-1">
                                                Example: Simulating a Real Programming Structure
                                            </a>
                                        </li>
                                    </ul>
                                    <ul class="list-unstyled ps-3 mb-0">
                                        <li>
                                            <a href="#dk_performance" class="text-decoration-none VK_a my-1">
                                                Performance Results
                                            </a>
                                        </li>
                                    </ul>
                            </details>
                            <p class="m-0">
                                <a href="#dk_conclusion" class="text-decoration-none VK_a">
                                   Conclusion
                                </a>
                            </p>
                            <p class="m-0">
                                <a href="#dk_other_res" class="text-decoration-none VK_a">
                                    Other Resources
                                </a>
                            </p>
                            <p class="m-0">
                                <a href="#dk_line" class="text-decoration-none VK_a">
                                    -------
                                </a>
                            </p>
                            <p class="m-0">
                                <a href="#dk_you_may" class="text-decoration-none VK_a">
                                    You May Also Like
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- thinkcode -->
                <!-- <div class="dk_things_code_main">
                    <div class="dk_things_code">
                        <h2 class="text-left headline-font-one-bold">Loss Prevention Retail Reference Implementation provides:</h2>
                        <div class="dk_high_quality">
                            <ul>
                                <li>High-quality testable ingredients needed to create a solution to prevent thefts at stores.</li>
                                <li>Building blocks needed to enable the use case with solid performance numbers.</li>
                                <li>Hardware requirements to support the workloads and scale the solution.</li>
                            </ul>
                        </div>
                    <div class="dk_get_code">
                        <button class="dk_button">Get Started on GitHub<sup>*</sup></button>
                    </div>
                    </div> 
                </div> -->
            </div>
            <div class="col-lg-9 col-md-8">
                <div class="d-md-flex justify-content-end col-xl-10 py-3 d-none">
                    <i class="fa-solid fa-print fs-4 px-2 " style="color:#0068B5"></i>
                    <i class="fa-regular fa-envelope fs-4 px-2" style="color:#0068B5"></i>
                </div>
                <div class="col-xl-10 VK_all_sections">
                    <div style="padding-bottom: 16px;">
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <h4>Boost Efficiency for Your Big Data Workloads</h4>
                        <div class="row">
                            <div class="col-6">
                                <p>Bo Jiang, machine learning engineer, and<br> Haifeng Chen, software engineering manager, Intel Corporation<br> <a    class="b_special_a1" href="">@IntelDevTools</a></p>
                            </div>
                            <div class="col-6">
                                <p><strong>Get the Latest on All Things CODE</strong><br> <a class="mv_coman_btn" href="">Sign Up</a></p> 
                            </div>
                        </div>
                        <p>&nbsp;</p>
                        <p>The explosion of big data has spurred tremendous increases in data analytics workloads. Compared to online transaction processing (OLTP), the queries in analytics workloads are usually complex, long-running, and CPU-bound. Code generation is an effective way to accelerate analytical data processing. It allows query-specific information known only at runtime, such as column types and expression operators, to be used in performance-critical functions as if they were available at compile time—yielding more efficient implementations.</p>
                        <p>Low Level Virtual Machine (LLVM) is a collection of open-source compiler libraries and related tools designed to be modular and reusable. The LLVM core libraries provide a modern optimizer, along with code generation support for many popular instruction set architectures. LLVM enables analytics engines to perform just-in-time (JIT) compilation within a running process, taking advantage of the benefits of its powerful optimizer. LLVM runtime code generation is an effective technology used by many data analytics engines (for example, Apache Impala* software, Apache Arrow Gandiva) to improve the execution performance of queries.</p>
                        <p>The performance of the LLVM code generation engine has a key impact on the overall data analytics engine performance. The current implementations don’t fully take advantage of the hardware capabilities of modern CPUs such as vectorization. In this article, we describe our learnings from a real case using Intel® architecture-based vectorization to optimize runtime code generation.</p>
                    </div>
                    <section id="dk_The_problem">
                        <h3 style="font-weight: 350; margin-bottom: 1.5rem;">The Problem and Acceleration via LLVM</h3>
                    </section>
                    <section id="dk_analyzing">
                        <h4>Analyzing the Design</h3>
                        <p>We started with a test code that needed help in optimization. It came from one of the customers of Intel. The code was extracted from data analytics software, and consisted of the query expression evaluation module using LLVM-based runtime code generation.</p>
                        <p style="text-align:center"><img class="w-100" src="/img/darshit_image/optimize-llvm-code-data-analytics-vectorization-fig1.jpg"></p>
                        <p style="text-align:center"><strong>Figure 1. LLVM engine block diagram</strong></p>
                        <p style="text-align:center">&nbsp;</p>
                        <p class="mb-0">The workflow has three stages:</p>
                        <ol> 
                            <li>Create module: The engine creates an LLVM intermedia representation (IR) module using the SQL query from the caller.</li> 
                            <li>Optimize module: It optimizes the created module with LLVM’s optimizers, which are called passes, and provides an optimized module for the JIT engine.</li> 
                            <li>JIT module: The LLVM JIT engine takes data from an inputView and runs the instructions in the optimized module. The resulting data is generated and provided as an outputView.</li> 
                        </ol>
                        <p>In detail, LLVM primarily uses an IR for all parts of code generation. In the module creation stage, the engine uses LLVM’s IRBuilder to programmatically generate IR instructions. For example, for expression evaluation, it uses IRBuilder to generate the code of the loop function prototype, including the IRs to form the loop and the IRs to calculate the expression once inside the loop.</p>
                        <p>There are many duplicated IR codes in the function (for example, the arithmetic operations, the data get and set), so the precompilation technique is used. These common codes are implemented in C++ first (for example, lib.cpp in Figure 1), and then cross-compiled to IR files using Clang. These IR files are called precompiled libs (for example, lib.bc in Figure 1). During code generation, these precompiled libs are loaded and linked with the IRBuilder-generated IR to get a combined IR module. This combined IR module, which consists of all necessary code, is then sent to the LLVM optimizer. After optimization, the IR module is run in the LLVM JIT engine.</p>
                        <p>Although this design increased the SQL execution speed greatly compared to traditional approaches, it still doesn’t fully use the capabilities of modern Intel® CPU architecture. Specifically, the data processing is still row by row. As a result, the vectorization is not enabled.</p>
                        <p>Also, modern Intel CPUs support different vectorization widths using different single instruction, multiple data (SIMD) instructions (for example, Intel® Streaming SIMD Extensions [Intel® SSE], Intel® Advanced Vector Extensions [Intel® AVX], and Intel® Advanced Vector Extensions AVX-512 [Intel® AVX-512]). To take full advantage of the power of Intel CPUs, we need to complete a series of steps.</p>
                        <p>&nbsp;</p>
                    </section> 
                        <section id="dk_confirming">
                            <h4>Confirming Vectorization Opportunity by Profiling</h4>
                            <p class="mb-0">The test code consists of several test cases. A typical test case calculates the expression l_extendedprice*(1-l_discount)*(1+l_tax) over ten million rows of data. The data is organized in columnar data format in memory. For each column, the data structure in memory consists of two buffers:</p>
                            <ul> 
                                <li>char* mData</li> 
                                <li>int8_t* mNull</li> 
                            </ul>
                            <p>The mData buffer is for the data and the mNull buffer is used to indicate whether the corresponding data in mData is null or not.</p>
                            <p class="mb-0">To implement the test case:</p>
                            <ol> 
                                <li>It creates a table schema with several columns and generates the table data with ten million rows.</li> 
                                <li>It generates the function prototype using the expression and optimizes the generated function.</li> 
                                <li>It evaluates (runs) the optimized function with the table data as input and measures the runtime.</li> 
                            </ol>
                            <p>We analyzed the test code with several measures and discovered additional opportunities for optimization. First, we dumped the generated IR, as well as the machine code of the optimized function. We noticed that there were no SIMD (Intel AVX and Intel AVX-512) instructions. Next, we conducted profiling on the baseline program using <a class="b_special_a1" href="">Intel® VTune™ Profiler</a>. Although the hot spot analysis didn’t provide much insight because it can’t analyze the code-generated function, the microarchitecture exploration report showed it’s CPU-bound (Figure 2), making it an area for further optimization. Finally, we analyzed the up limit of the performance. We wrote a minimal test program in C++ to calculate the expression directly in a loop. We compiled it with Clang -O3 and measured the runtime. The result showed that the runtime is about one-seventh of the baseline test code. By checking the disassembly of the program, we see it’s vectorized with SIMD instructions, as expected.</p>
                            <p style="text-align:center"><img class="w-100" src="/img/darshit_image/optimize-llvm-code-data-analytics-vectorization-fig2.jpg" width="680"></p>
                            <p style="text-align:center"><strong>Figure 2. Profiling on the baseline program</strong></p>
                            <p style="text-align:center">&nbsp;</p>
                            <p>The insights from our analysis are consistent. We see vectorization as an approach with high potential for optimizing the test code.</p>
                            <p>&nbsp;</p>
                            <p class="mb-0">&nbsp;</p>
                        </section>

                        <section id="dk_vectorization">
                            <h4>Vectorization Approaches</h4>
                            <p class="mb-0">There are two kinds of auto-vectorizations, explicit and implicit:</p>
                            <ul> 
                                <li>In explicit vectorization, the programmers implement the program using SIMD instructions.</li> 
                                <li>In implicit vectorization, the compiler automatically transforms IRs to SIMD. Implicit vectorization is also known as compiler auto-vectorization.</li> 
                            </ul>
                            <p>We decided to use LLVM loop auto-vectorization because it can be generalized for other expressions, making it more valuable.</p>
                            <p class="mb-0">In the compiler autovectorization approach, there are two factors that impact the LLVM loop autovectorization:</p>
                            <ol> 
                                <li>The LLVM codegen engine should be properly configured for vectorized IR generation (for example, use the proper Clang command-line option, -Ox, to specify the optimization level and use necessary loop-vectorize passes in the module optimization stage to do correct transformation for vectorization).</li> 
                                <li>The source code should be written in designs that are friendly to the loop vectorizer. The relevant techniques are widely discussed in the data-oriented programming paradigm that originated from video game development (for example, proper data layout for efficient usage of the CPU cache and parallelization, address pointer aliasing issue to avoid hindering for Loop-Invariant Code Motion [LICM]).</li> 
                            </ol>
                            <p>In the next sections, we elaborate on how to apply the techniques with sample code following this approach.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_auto_vec">
                            <h3 style="font-weight: 350; margin-bottom: 1.5rem;">Auto-Vectorization for LLVM Code Generation</h4>
                        </section>

                        <section id="dk_start_example">
                            <h4>Start from a Basic Example</h4>
                            <p>The sample code shown in this section demonstrates the common LLVM code generation procedure. Based on it, we describe how to properly configure the codegen engine for autovectorization.</p>
                            <p class="mb-0">We created two files: plus.cpp and samplejit.cpp:</p>
                            <ul> 
                                <li>Plus.cpp is used to simulate an expression, which adds ten to the input and stores the sum in the output</li> 
                                <li>Samplejit.cpp is used to simulate the LLVM code generation engine, which loads the prototype module, optimizes it, and finally JIT runs it.</li> 
                            </ul>
                            <p>The code for plus.cpp is:</p>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="dk_color1">#define LENARRAY 10240</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="dk_color1">typedef char</span> ele_t;</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">ele_t a[LENARRAY], b[LENARRAY];</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            4
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            5
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="dk_color1">int</span> plus (ele_t aa[], ele_t bb[], <span class="dk_color1">int</span> len)</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            6
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">{</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            7
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp; <span class="dk_color1">for</span> ( <span class="dk_color1">int</span> i <span class="dk_color2">=</span> <span class="dk_color1">0</span> ; i <span><span class="dk_color2"><</span></span> len ; i<span class="dk_color2">++</span> )</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            8
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bb { i ] <span class="dk_color2">=</span> aa [ i ] <span class="dk_color2">+</span> <span class="dk_color1">10</span> ;</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            9
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp; } </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            10
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;return 3148;</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            11
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>}</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>It simulates the SQL expression b=a+10 logically for 10,240 input rows. It returns a magic number (3,148) to check later.</p>
                            <p>The plus.cpp is compiled into an IR file (plus.ll) using Clang with the following instructions. This step is to simulate the creation of the module.</p>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">clang -c -emit-llvm -O0 plus.cpp -o plus.bc</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">llvm-dis plus.bc - plus.ll</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>You can easily get vectorized IR code with the proper compile option, -Ox. But in this case, we want to use the LLVM JIT engine to vectorize the loop, so we explicitly specify the optimize level to -O0 (no optimization). From plus.ll, we can see the IR code is not vectorized.</p>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="dk_color1">int</span> main{<span class="dk_color1">int</span> argc, <span class="dk_color1">char</span> <span class="dk_color2">**</span>argv)  {</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; . . .</p>
                                            </div> 
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; <span style="color: #008200 !important;">// Parse the input LLVM IR file into a module.</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            4
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; . . .</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            5
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; <span style="color: #008200 !important;">// setup the MCJIT execution engine</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            6
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; . . .</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            7
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; <span style="color: #008200 !important;">// Optimize the module</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            8
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; . . .</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            9
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; &nbsp; <span style="color: #008200 !important;">// compile the module to mc</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            10
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; executionEngine <span class="dk_color2">-></span>finalizeObject();</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            11
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            12
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                               <p class="mb-0">&nbsp; &nbsp; <span style="color: #008200 !important;">// run the mc in JIT engine</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            13
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; <span slot="dk_color1">int</span> ( <span class="dk_color2">*</span>func_ptr ) ( ) <span class="dk_color2">=</span> <span class="dk_color1">NULL</span>;</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            14
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; func_ptr <span class="dk_color2">=</span> ( int ( <span class="dk_color2">*</span> ) ( ) )executionEngine <span class="dk_color2">-></span>getFunctionAddress ( <span style="color: blue;">" _Z4plusPcS_i "</span> );</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            15
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; <span class="dk_color1">int</span> res <span class="dk_color2">=</span> ( <span class="dk_color2">* </span>func_ptr ) ( );</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            16
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; std <span class="dk_color2">: :</span> cout <span class="dk_color2"><<</span> <span style="color: blue;">"res: "</span> <span class="dk_color2"><<</span> res <span class="dk_color2"><<</span> std <span class="dk_color2">: :</span> end1;</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            17
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            18
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">&nbsp; &nbsp; <span class="dk_color1">return 0</span> ;</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            19
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>}</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>As shown, first the input IR file (that is, plus.ll) is loaded into the engine as a module. Then, the engine optimizes the module. After that, the module is JIT compiled into machine code. The function plus() is run in the JIT engine (_Z4plusPcS_i is the symbol of plus()). The expected value of the variable res is 3,148, which aligns with the return value of plus().</p>
                            <p>Next, we build and run the sample code.</p>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">echo <span style="color: blue;">"Building llvmtest . . ."</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">$CPP -o llvmtest samplejit.cpp $CPPFLAGS $LDFLAGS</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">echo <span style="color: blue;">"Running llvmtest . . ."</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            4
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">. <span class="dk_color2">/</span> llvmtest plus.ll</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>There are several key steps to make sure that the LLVM engine is enabled by vectorization.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_intel_optimization_caffe">
                            <p class="mb-0">&nbsp;</p>
                            <h4>Intel® Optimization for Caffe*</h4>
                            <p>Intel has a tutorial showing how to use the following:</p>
                            <ul> 
                                <li>Build Caffe optimized for Intel architecture</li> 
                                <li>Train deep-network models using one or more compute nodes</li> 
                                <li>Deploy networks</li> 
                            </ul>
                            <p><a class="b_special_a1" href="" rel="">Tutorial</a></p>

                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">( Ubuntu <a class="dk_color1" href="">16.04</a> )
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">git clone <a class="dk_color1" href="">https</a> : <a class="dk_color2" href="">/</a><a class="dk_color2" href="">/ </a>github.com<a class="dk_color2" href="">/</a> intel<a class="dk_color2" href="">/</a> caffe.git </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">Open a Terminal <a class="dk_color1" href="">window</a></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            4
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">sudo apt-get update</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            5
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>sudo apt-get install build-essential cmake git pkg-config </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            6
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev  </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            7
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>libhdf5-serial-dev protobuf-compiler </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            8
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>sudo apt-get install libatlas-base-dev </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            9
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>sudo apt-get install –– <a class="dk_color1" href="">no</a>-install-recommends libboost-all-dev  </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            10
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>sudo apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            11
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>sudo apt-get install libopencv-dev </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            12
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>Go to Caffe root directory. </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            13
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>cp Makefile.config.example Makefile.config  </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            14
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>vi Makefile.config (add the red part) </span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            15
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <a class="dk_color1" href="">INCLUDE DIRS</a> :<a class="dk_color2" href="">=</a> $( <a class="dk_color1" href="">PYTHON INCLUDE</a> ) <a class="dk_color2" href="">/</a> usr<a class="dk_color2" href="">/</a> local<a class="dk_color2" href="">/</a> include <a class="dk_color2" href="">/</a> usr<a class="dk_color2" href="">/</a> include<a class="dk_color2" href="">/</a> hdf5<a class="dk_color2" href="">/</a> serial</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            16
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><a class="dk_color1" href="">LIBRARY DIRS</a> : <a class="dk_color2" href="">=</a> $( <a class="dk_color1" href="">PYTHON LIB</a> ) <a class="dk_color2" href="">/</a> usr<a class="dk_color2" href="">/</a> local<a class="dk_color2" href="">/</a> lib <a class="dk_color2" href="">/</a> usr<a class="dk_color2" href="">/</a> lib <a class="dk_color2" href="">/</a> usr<a class="dk_color2" href="">/</a> lib<a class="dk_color2" href="">/</a> x86_64-</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            17
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>linux-gnu <a class="dk_color2" href="">/</a> usr<a class="dk_color2" href="">/</a> lib<a class="dk_color2" href="">/</a> x86_64-linux-gnu<a class="dk_color2" href="">/</a> hdf5<a class="dk_color2" href="">/</a> serial</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;"
                                        class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            18
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"> <span>make all -j4</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </section>

                        <section id="dk_intel_optimized">
                            <p>&nbsp;</p>
                            <h4>Intel® Optimized Apache MXNet*</h4>
                            <p>For more details on this library, see:</p>
                            <p><a class="b_special_a1" href="">Get Started</a></p>
                            <p><a class="b_special_a1" href="">Intel® Optimized Apache MXNet*</a></p>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="token function">git clone – –recursive https : // github.com / apache / incubator-mxnet.git</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">cd mxnet && make -j $(nproc) USE_OPENCV=1 USE_BLAS=mk1 USE MKLDNN=1 </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section id="dk_performance">
                            <p>&nbsp;</p>
                            <h4 style="font-weight: 350;">Performance Considerations and Runtime Settings</h4>
                            <p>Now let's consider TensorFlow runtime settings for best performance―specifically, convolutional neural network (CNN) inference. The concepts can be applied to other frameworks accelerated with Intel MKL-DNN and other use cases. However, some empirical testing is required. Where necessary, different recommendations are given for real-time inference (RTI) with a batch size of 1 and maximum throughput (MxT) with a tunable batch size.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_maximum">
                            <h4 style="font-weight: 350;">Maximum Throughput versus Real-Time Inference</h4>
                            <p class="mb-0">Deep-learning inference is usually done with two different strategies, each with different performance measurements and recommendations:</p>
                            <ul> 
                                <li>MxT processes many images per second, passing in batches of size that's greater than 1. You can achieve the best performance by exercising all the physical cores on a socket. This solution is intuitive: Load up the CPU with as much work as possible, and process as many images as possible in a parallel and vectorized fashion.</li> 
                                <li>RTI is a different scenario where a single image needs to be processed as quickly as possible. The goal is to avoid penalties from excessive thread launching and orchestration between concurrent processes. The strategy is to confine and run them quickly.</li> 
                            </ul>
                            <p>Let's discuss some best-known methods (BKMs) for maximizing MxT and RTI performance.</p>
                        </section>

                        <section id="dk_tensorflow">
                            <p>&nbsp;</p>
                            <h4 style="font-weight: 350;">TensorFlow Runtime Options Affecting Performance</h4>
                            <p>These runtime options heavily affect TensorFlow performance. Understanding them helps you get the best performance out of Intel optimizations. BKMs differ for MxT and RTI. The runtime options are: <strong>{intra|inter}_op_parallelism_threads</strong> and data layout.</p>
                        </section>

                        <section id="dk_intra_op">
                            <p class="mb-0">&nbsp;</p>
                            <h4>{intra|inter}_op_parallelism_threads</h4>
                            <ul> 
                                <li>Recommended settings (MxT): <strong>intra_op_parallelism = #physical cores</strong></li> 
                                <li>Recommended settings (RTI): <strong>intra_op_parallelism = #physical cores</strong></li> 
                                <li>Recommended settings for <strong>inter_op_parallelism</strong>: <strong>2</strong></li> 
                                <li>Use (shell):<br> <strong>python script.py ––num_intra_threads=cores ––num_inter_threads=2 ––mkl=True</strong></li> 
                            </ul>
                            <p><strong>intra_op_parallelism_threads</strong> and <strong>inter_op_parallelism_threads</strong> are environment variables defined in <strong>tensorflow.ConfigProto</strong>. The <strong>ConfigProto </strong>is used for configuration when creating a session. These two environment variables control number of cores to use.</p>
                            <p>The <strong>intra_op_parallelism_threads</strong> environment variable controls parallelism inside an operation. For instance, if matrix multiplication or reduction is intended to run in several threads, set this environment variable. TensorFlow schedules tasks in a thread pool that contains <strong>intra_op_parallelism_threads</strong>. OpenMP* threads are bound to thread context as closely as possible on different cores. Setting this environment variable to the number of available physical cores is recommended.</p>
                            <p>The <strong>inter_op_parallelism_threads</strong> environment variable controls parallelism among independent operations. Since these operations are not relevant to each other, TensorFlow attempts to run them concurrently in the thread pool that contains <strong>inter_op_parallelism_threads</strong>. To minimize effects that are brought to <strong>intra_op_parallelsim_threads</strong>, this environment variable is recommended to be set to the number of sockets where you want the code to run. For the Intel Optimization of TensorFlow, it's recommended to keep the entire execution on a single socket.</p>
                            <p>&nbsp;</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_data_layout">
                            <h4 style="font-weight: 350;">Data Layout</h4>
                            <ul> 
                                <li>Recommended settings: <strong>Data_format = NCHW</strong></li> 
                                <li>Use (shell):</li> 
                            </ul>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="token function">python</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">script.py ––num_intra_threads <a class="dk_color2" href="">=</a> cores ––num_inter_threads <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">2</a> ––mkl <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">True</a></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">data_format <a class="dk_color2" href="">=</a> NCHW</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>&nbsp;</p>
                            <p>In modern Intel architectures, efficient use of cache and memory greatly impacts overall performance. A good memory access pattern minimizes the performance cost of accessing data in memory. To achieve this, it's important to consider how data is stored and accessed. This is usually referred to as <em>data layout</em>. It describes how multidimensional arrays are stored linearly in the memory address space.</p>
                            <p class="mb-0">Usually, data layout is represented by four letters for a two-dimensional image.</p>
                            <ul> 
                                <li>N: Batch size, indicating number of images in a batch</li> 
                                <li>C: Channel, indicating number of channels in an image</li> 
                                <li>W: Width, indicating number of pixels in horizontal dimension of an image</li> 
                                <li>H: Height, indicating number of pixels in vertical dimension of an image</li> 
                            </ul>
                            <p>&nbsp;</p>
                            <p style="text-align:center"><img class="w-100" src="/img/darshit_image/effectively-train-execute-ml-dl-projects-on-cpus-fig04.jpg" width="750"></p>
                            <p style="text-align:center">&nbsp;</p>
                        </section>

                        <section id="dk_that_affect_per">
                            <p>&nbsp;</p>
                            <h3 style="font-weight: 350;">That Affect Performance</h3>
                            <p>The order of these four letters indicates how pixel data is stored in 1D memory space. For instance, NCHW indicates pixel data is stored in this order: width-wise, height-wise, channel-wise, and batch-wise (Figure 4). The data is then accessed from left to right with channels-first indexing. NCHW is the recommended data layout for Intel MKL-DNN because this is an efficient layout for the CPU. TensorFlow uses NHWC as the default data layout, but it also supports NCHW.</p>
                        </section>

                        <section id="dk_numa_controls">
                            <p>&nbsp;</p>
                            <p class="mb-0">&nbsp;</p>
                            <h3 style="font-weight: 350;">NUMA Controls</h3>
                            <ul> 
                                <li>Recommended settings: <strong>––cpunodebind=0 ––membind=0</strong></li> 
                                <li>Usage (shell):</li> 
                            </ul>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="token function">numactl ––cpunodebind= <a class="dk_color1" href="">0</a> ––membind= <a class="dk_color1" href="">0</a> python</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">script.py ––num_intra_threads <a class="dk_color2" href="">=</a> cores ––num_inter_threads <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">2</a> ––mkl <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">True</a> </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">data_format <a class="dk_color2" href="">=</a> NCHW</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="mb-0">&nbsp;</p>
                            <p>Running on a non-uniform memory access (NUMA) enabled machine brings with it special considerations. NUMA is a memory layout design used in data center machines that take advantage of locality of memory in multisocket machines with multiple memory controllers and blocks. The Intel Optimization for TensorFlow runs best when confining both running and memory use to a single NUMA node.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_intel_mkn">
                            <h3 style="font-weight: 350;">Intel MKL-DNN Technical Performance Considerations</h3>
                            <p>The library takes advantage of single instruction multiple data (SIMD) instructions through vectorization, and multiple cores through multithreading. Vectorization effectively uses cache and the latest instruction sets. On modern Intel® processors, a single core can perform up to two fused multiply and add (FMA) operations on 16 single-precision or 64 Int8 numbers per cycle. Also, the technique of multithreading helps in performing multiple independent operations simultaneously. Since deep-learning tasks are often independent, getting available cores working in parallel is an obvious choice to boost performance.</p>
                            <p>To achieve the best possible CPU use, Intel MKL-DNN may use hardware-specific buffer layouts for compute-intensive operations, including convolution and inner product. All the other operations run on the buffers in hardware-specific layouts or common layouts used by frameworks.</p>
                            <p>Intel MKL-DNN uses OpenMP to express parallelism. OpenMP is controlled by various environment variables: <strong>KMP_AFFINITY</strong>, <strong>KMP_BLOCKTIME</strong>, <strong>OMP_NUM_THREADS</strong>, and <strong>KMP_SETTINGS</strong>. These environment variables are described in the following sections. Changing the values of these environment variables affects performance of the framework, so we highly recommend that users tune them for their specific neural network model and platform.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_kmp_affinity">
                            <h4>KMP_AFFINITY</h4>
                            <ul> 
                                <li>Recommended settings:<br> <strong>KMP_AFFINITY=granularity=fine,verbose,compact,1,0</strong></li> 
                                <li>Usage (shell):</li> 
                            </ul>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="token function">numactl ––cpunodebind <a class="dk_color2" href="">=</a>  <a class="dk_color1" href="">0</a> ––membind <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">0</a> python</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">script.py ––num_intra_ threads<a class="dk_color2" href="">=</a>cores ––num_inter_threads<a class="dk_color2" href="">=</a> <a class="dk_color1" href="">2</a> ––mkl<a class="dk_color2" href="">=</a> <a class="dk_color1" href="">True</a> </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">data_format<a class="dk_color2" href="">=</a>NCHW ––kmp_affinity=granularity<a class="dk_color2" href="">=</a>fine,verbose,compact,1,0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>&nbsp;</p>
                            <p><strong>KMP_AFFINITY </strong>is used to restrict running certain threads to a subset of the physical processing units in a multiprocessor computer. Set this environment variable as follows:</p>
                            <p class="mb-0"><strong>KMP_AFFINITY=[&lt;modifier&gt;,...]&lt;type&gt;[,&lt;permute&gt;][,&lt;offset&gt;]</strong></p>
                            <ul> 
                                <li><strong>Modifier </strong>is a string consisting of a keyword and specifier.</li> 
                                <li><strong>Type </strong>is a string indicating the thread affinity to use.</li> 
                                <li><strong>Permute </strong>is a positive integer value that controls which levels are most significant when sorting the machine topology map. The value forces the mappings to make the specified number of most significant levels of the sort the least significant, and then inverts the order of significance. The root node of the tree is not considered a separate level for the sort operations.</li> 
                                <li>Offset is a positive integer value that indicates the starting position for thread assignment.</li> 
                            </ul>
                            <p>As an example to explain basic content of this environment variable, use the recommended setting of <strong>KMP_AFFINITY</strong>:</p>
                            <p><strong>KMP_AFFINITY=granularity=fine,verbose,compact,1,0</strong></p>
                            <p class="mb-0">The modifier is <strong>granularity=fine,verbose</strong>. The word <strong>fine </strong>causes each OpenMP thread to be bound to a single-thread context, and verbose prints messages concerning the supported affinity, for example:</p>
                            <ul> 
                                <li>The number of packages</li> 
                                <li>The number of cores in each package</li> 
                                <li>The number of thread contexts for each core</li> 
                                <li>OpenMP thread bindings to physical thread contexts</li> 
                            </ul>
                            <p>The word <strong>compact</strong> is the value of type, assigning the OpenMP thread <strong>&lt;n&gt;+1</strong> to a free thread context as close as possible to the thread context where the<strong> &lt;n&gt;</strong> OpenMP thread was placed.</p>
                            <p>Figure 5 shows the machine topology map when <strong>KMP_AFFINITY </strong>is set to these values. The OpenMP thread <strong>&lt;n&gt;+1</strong> is bound to a thread context as closely as possible to the OpenMP thread <strong>&lt;n&gt;</strong>, but on a different core. Once each core has been assigned an OpenMP thread, the subsequent OpenMP threads are assigned to the available cores in the same order, but they are assigned on different thread contexts.</p>
                            <p style="text-align:center"><img class="w-100" src="/img/darshit_image/effectively-train-execute-ml-dl-projects-on-cpus-fig05.jpg" width="750"></p>
                            <p style="text-align:center">Figure 5. Machine topology map with the setting <strong>KMP_AFFINITY=granularity=fine,compact,1,0</strong></p>
                            <p>The advantage of this setting is that consecutive threads are bound close together so that communication overhead, cache line invalidation overhead, and page thrashing are minimized. It's desirable to avoid binding multiple threads to the same core and leaving other cores unused. For more detailed description of <strong>KMP_AFFINITY</strong>, see the <a class="b_special_a1" href="">Intel® C++ Compiler Developer Guide and Reference</a>.</p>
                        </section>
                        <section id="dk_kmp_blocktime">
                            <p>&nbsp;</p>
                            <h4>KMP_BLOCKTIME</h4>
                            <ul> 
                                <li>Recommended settings for CNN: <strong>KMP_BLOCKTIME=0</strong></li> 
                                <li>Recommended settings for non-CNN: <strong>KMP_BLOCKTIME=1 </strong>(user verifies empirically)</li> 
                                <li>Usage (shell):</li> 
                            </ul>
                            <!-- code toolbar 3 -->
                            <div class="mv_code_toolbar">
                                <div class="mv_toolbar_item mv_copy_icon">
                                    <i class="fa-regular fa-copy"></i>
                                </div>
                                <div class="mv_copy_message text-end hidden">Copied</div>
                                <div class="code-content">
                                    <div style="padding-bottom: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            1
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0"><span class="token function">numactl ––cpunodebind <a class="dk_color2" href="">=</a>  <a class="dk_color1" href="">0</a> ––membind <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">0</a> python</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            2
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">script.py ––num_intra_threads=cores ––num_inter_threads= <a class="dk_color1" href="">2</a> ––mkl=<a class="dk_color1" href="">True</a></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 0rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            3
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">data_format<a class="dk_color2" href="">=</a>NCHW ––kmp_affinity<a class="dk_color2" href="">=</a>granularity<a class="dk_color2" href="">=</a>fine,verbose,compact,<a class="dk_color1" href="">1</a>,<a class="dk_color1" href="">0</a></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 0rem !important; padding-bottom: 1rem !important;" class="d-flex mv_pre pb-0">
                                        <div style="border-right: 1px solid #ccc" class="pe-3">
                                            4
                                        </div>
                                        <div class="">
                                            <div class="mv_code text-break">
                                                <p class="mb-0">––kmp_blocktime <a class="dk_color2" href="">=</a> <a class="dk_color1" href="">0</a>( <a class="dk_color1" href="">or</a> <a class="dk_color1" href="">1</a>)</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>&nbsp;</p>
                            <p>This environment variable sets the time, in milliseconds, that a thread waits after completing running a parallel region before going to sleep. The default value is 200 ms.</p>
                            <p>After completing running a parallel region, threads wait for new parallel work to become available. After a certain period of time has elapsed, they become inactive. Sleeping allows the threads to be used until more parallel work becomes available, by threaded code that isn't OpenMP and may run between parallel regions, or by other applications. A small <strong>KMP_BLOCKTIME </strong>value may offer better overall performance if the application contains threaded code that isn't OpenMP that runs between parallel regions. A larger <strong>KMP_BLOCKTIME </strong>value may be more appropriate if threads are to be reserved solely for running OpenMP, but may penalize other concurrently-running OpenMP or threaded applications. The suggested setting is <strong>0</strong> for CNN-based models.</p>
                        </section>

                        <section id="dk_omp_num">
                            <p>&nbsp;</p>
                            <h4>OMP_NUM_THREADS</h4>
                            <ul> 
                                <li>Recommended settings for CNN: <strong>OMP_NUM_THREADS = # </strong>physical cores</li> 
                                <li>Usage (shell): Export <strong>OMP_NUM_THREADS= #</strong> physical cores</li> 
                            </ul>
                            <p>This environment variable sets the maximum number of threads to use in OpenMP parallel regions if no other value is specified in the application. The value can be a single integer, in which case each integer specifies the number of threads for a parallel region at each nesting level. The first position in the list represents the outermost parallel nesting level. The default value is the number of logical processors visible to the operating system on which the program is executed. The recommended value equals the number of physical cores.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_kmp_settings">
                            <h4>KMP_SETTINGS</h4>
                            <ul> 
                                <li>Use (shell):<strong> Export KMP_SETTINGS=TRUE</strong></li> 
                            </ul>
                            <p>This environment variable enables (TRUE) or disables (FALSE) the printing of OpenMP runtime library environment settings when the program runs.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_learn_more">
                            <h3 style="font-weight: 350;">Learn More</h3>
                            <p>Start using Intel-optimized frameworks to accelerate your deep-learning workloads on the CPU today. Access resources on <a class="b_special_a1" href="">www.intel.ai</a> and get support from the <a class="b_special_a1" href="">Intel® AI Developer Forum</a>. Also, visit the <a class="b_special_a1" href="">AI Model Zoo</a> for solution-oriented resources for your accelerated TensorFlow projects. These resources help you use CPU resources to their fullest capability.</p>
                            <p>&nbsp;</p>
                        </section>

                        <section id="dk_references">
                            <h3 style="font-weight: 350;">References</h3>
                            <p><sup>1</sup> Inference using FP32 batch size Caffe for GoogleNet* v1 128, AlexNet v 256.</p>
                            <p>Configurations for inference throughput: Tested by Intel as of 6/7/2018. Platform: two-socket Intel® Xeon® Platinum processor, 8180 CPU at 2.50 GHz and 28 cores, HyperThreading ON, turbo ON. Total Memory: 376.28 GB (12 slots, 32 GB, 2666 MHz), four instances of the framework, CentOS* Linux*: 7.3.1611 core, SSD, sda RS3WC080, HDD 744.1 GB, sdb RS3WC080, HDD 1.5 TB, sdc RS3WC080, HDD 5.5 TB, deep-learning framework Caffe version: a3d5b022fe026e9092fc7abc7654b1162ab9940d. Topology: GoogleNet v1, BIOS: SE5C620.86B.00.01.0004.071220170215, Intel MKL DNN version: 464c268e544bae26f9b85a2acb9122c766a4c396, NoDataLayer. Measured: 1449 images per second vs. tested by Intel as of 06/15/2018. Platform: 2S Intel® Xeon® E5-2699 processor v3 at 2.30 GHz (18 cores), HyperThreading enabled, turbo disabled, scaling governor set to “performance” via the <strong>intel_pstate </strong>driver, 64 GB DDR4-2133 ECC RAM. BIOS: SE5C610.86B.01.01.0024.021320181901, CentOS Linux 7.5.1804 (core) kernel 3.10.0-862.3.2.el7.x86_64, SSD sdb INTEL SSDSC2BW24 SSD 223.6GB. Framework BVLC Caffe: <a class="b_special_a1" href="">GitHub*</a>, Inference and training measured with <strong>caffe time</strong> command. For <strong>ConvNet</strong> topologies, a dummy dataset was used. For other topologies, data was stored on local storage and cached in memory before training. <a class="b_special_a1" href="">BVLC Caffe</a>, revision 2a1c552b66f026c7508d390b526f2495ed3be594.</p>
                            <p>Configuration for training throughput: Tested by Intel as of 05/29/2018 Platform: two-socket Intel Xeon Platinum 8180 processor at 2.50 GHz, 28 cores, HyperThreading ON, turbo ON, total memory 376.28 GB (12 slots, 32 GB, 2666 MHz), four instances of the framework, CentOS Linux 7.3.1611 core, SSD, sda RS3WC080, HDD 744.1 GB, sdb RS3WC080, HDD 1.5TB, sdc RS3WC080, HDD 5.5TB, deep learning framework Caffe version: a3d5b022fe026e9092fc7abc765b1162ab9940d Topology: AlexNet BIOS: SE5C620.86B.00.01.0004.071220170215, Intel MKL DNN version: 464c268e544bae26f9b85a2acb9122c766a4c396 <strong>NoDataLayer</strong>. Measured: 1257 imgages per sec vs. tested by Intel as of 06/15/2018. Platform: 2S Intel Xeon E5-2699 processor v3 at 2.30 GHz (18 cores), HyperThreading enabled, turbo disabled, scaling governor set to <strong>performance</strong> via the <strong>intel_pstate</strong> driver, 64 GB, DDR4-2133 ECC RAM. BIOS: SE5C610.86B.01.01.0024.021320181901, CentOS Linux 7.5.1804 (core) kernel 3.10.0-862.3.2.el7.x86_64, SSD, sdb INTEL SSDSC2BW24, SSD 223.6 GB. Framework: <a class="b_special_a1" href="">BVLC Caffe</a>. Inference and training measured with <strong>caffe time</strong> command. For <strong>ConvNet</strong> topologies, dummy dataset was used. For other topologies, data was stored on local storage and cached in memory before training. <a class="b_special_a1" href="">BVLC Caffe</a>, revision 2a1c552b66f026c7508d390b526f2495ed3be594</p>
                            <p><sup>2</sup> System configuration: CPU threads per core: two cores per socket: 28 sockets, two NUMA nodes, two CPU family: 6 model, 85 model name: Intel Xeon Platinum 8180 processor at 2.50 GHz, HyperThreading: ON turbo: ON, memory 376 GB (12x32 GB), 24 slots, 12 occupied, 2666 MHz disks Intel RS3WC080 x 3 (800 GB, 1.6 TB, 6 TB) BIOS: SE5C620.86B.00.01.0004. 070920180847 (microcode version 0x200004d), Centos Linux 7.4.1708 (core) kernel 3.10.0-693.11.6.el7.x86_64, <a class="b_special_a1" href="">TensorFlow Source</a>, commit: 6a0b536a779f485edc25f6a11335b5e640acc8ab, Intel MKL DNN version: 4e333787e0d66a1dca1218e99a891d493dbc8ef1, <a class="b_special_a1" href="">TensorFlow benchmarks </a></p>
                            <h2 style="opacity: 0.5;">______<a class="inpage-nav-anchor" id="inpage-nav-12"></a></h2>
                        </section>

                        <section id="dk_you_may">
                            <p>&nbsp;</p>
                            <h3 style="font-weight: 350;">You May Also Like</h3>
                            <div class="mv_deploy_nav_tab">
                                <ul class="nav nav-pills mv_deploy_nav_pills pt-3" id="pills-tab" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active mv_deploy_nav_link" id="pills-home-tab" data-bs-toggle="pill"
                                                data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home"
                                                aria-selected="true">Related Webinars</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link mv_deploy_nav_link" id="pills-profile-tab" data-bs-toggle="pill"
                                                data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile"
                                                aria-selected="false">Related Articles</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link mv_deploy_nav_link" id="pills-video-tab" data-bs-toggle="pill"
                                                data-bs-target="#pills-video" type="button" role="tab" aria-controls="pills-video"
                                                aria-selected="false">Related Video</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link mv_deploy_nav_link" id="pills-design-tab" data-bs-toggle="pill"
                                                data-bs-target="#pills-design" type="button" role="tab" aria-controls="pills-design"
                                                aria-selected="false">Related Podcast</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link mv_deploy_nav_link" id="pills-simulation-tab" data-bs-toggle="pill"
                                                data-bs-target="#pills-simulation" type="button" role="tab" aria-controls="pills-simulation"
                                                aria-selected="false">Get the Software</button>
                                        </li>
                                </ul>
                                <div class="tab-content" id="pills-tabContent">
                                        <!-- 1. Device Information -->
                                        <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                                            aria-labelledby="pills-home-tab" tabindex="0">
                                            <div class="mv_coman_padd" style=" border-bottom: 1px solid #ddd; display: flex; padding-bottom: 1rem;">
                                                <div class="">
                                                    <p>Enhance Deep-Learning Workloads on 3rd Generation Intel® Xeon® Scalable Processors</p>
                                                    <a class="b_special_a1" href="">Watch</a>
                                                </div>
                                                <div class="">
                                                    <p>Advanced Code Optimization for 3rd Generation Intel Xeon Scalable Processors</p>
                                                    <a class="b_special_a1" href="">Watch</a>
                                                </div>
                                            </div>
                                            <!-- User Guides -->
                                            
                                        </div>
                                        <!-- 2. Interface Protocol -->
                                        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab"
                                            tabindex="0">
                                            <div class="mv_coman_padd" style=" border-bottom: 1px solid #ddd; display: flex; padding-bottom: 1rem;">
                                                <div class="">
                                                    <p>Use Deep Learning Optimizations from Intel in TensorFlow*</p>
                                                    <a class="b_special_a1" href="">Read</a>
                                                </div>
                                                <div class="">
                                                    <p>One-Line Code Changes to Boost pandas, scikit-learn*, and TensorFlow Performance </p>
                                                    <a class="b_special_a1" href="">Read</a>
                                                </div>
                                            </div>
                                            <!-- User Guides -->
                                        </div>
                                        <!-- 3. Design Planning -->
                                        <div class="tab-pane fade" id="pills-video" role="tabpanel" aria-labelledby="pills-video-tab"
                                            tabindex="0">
                                            <div class="mv_coman_padd" style="padding-bottom: 1rem;">
                                                <p>Optimize End-to-End Data Science and Machine Learning Acceleration</p>
                                                <a class="b_special_a1" href="">Watch</a>
                                            </div>
                                            <!-- User Guides / Device Overview / Device Datasheet / Application Notes-->
                                        </div>
                                        <!-- 4. Design Entry -->
                                        <div class="tab-pane fade" id="pills-design" role="tabpanel" aria-labelledby="pills-design-tab"
                                            tabindex="0">
                                            <div class="mv_coman_padd" style="padding-bottom: 1rem;">
                                                <p>Ignite the Next Generation of Deep Learning </p>
                                                <a class="b_special_a1" href="">Listen</a>
                                            </div>
                                            <!-- User Guides / Device Overview / Device Datasheet / White Paper -->
                                            
                                        </div>
                                        <!-- 5. Simulation and Verification -->
                                        <div class="tab-pane fade" id="pills-simulation" role="tabpanel" aria-labelledby="pills-simulation-tab"
                                            tabindex="0">
                                            <div class="mv_coman_padd" style="padding-bottom: 1rem;">
                                                <a class="b_special_a1" href=""><b>Intel® oneAPI Math Kernel Library</b></a>
                                                <p>Accelerate math processing routines, including matrix algebra, fast Fourier transforms (FFT), and vector math. Part of the Intel® oneAPI Base Toolkit.</p>
                                                <p><a class="mv_coman_btn" href="">Get It Now</a></p>
                                                <p><a class="b_special_a1" href="">See All Tools</a></p>
                                            </div>
                                            <!-- User Guides / Device Overview / Device Datasheet / Application Notes -->
                                        </div>
                                </div>
                            </div>
                        </section>
                </div>
            </div>
        </div>
    </section>

    <section style="border-top: 1px solid #d7d7d7;" class="container py-5">
        <h4 class="h6">Product and Performance Information</h4>
        <div class="disclaimer" style="font-size: 12px;"><sup>1</sup> Performance varies by use, configuration and other
            factors. Learn more at <a class="b_special_a1" href="">www.Intel.com/PerformanceIndex.</a></div>
        </div>
    </section>

    <!-- footer -->
    <div id="footer"></div>

    <!-- nav script -->
    <script>
        // navbar include  
        fetch('/y_index/y_navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
        // footer include 
        fetch('/y_index/y_footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            });
    </script>
    <!-- nav script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (document.getElementsByClassName('VK_all_sections section') && document.getElementsByClassName('VK_sidebar_dropdown')) {
                const sections = document.querySelectorAll('.VK_all_sections section');
                const navLinks = document.querySelectorAll('.VK_sidebar_dropdown a');
                const detailsElements = document.querySelectorAll('.VK_sidebar_dropdown details');

                function removeActiveClass() {
                    navLinks.forEach(link => link.classList.remove('VK_sidebar_active_link'));
                    detailsElements.forEach(details => {
                        details.removeAttribute('open');
                        details.setAttribute('close', ''); // Optional: to visually indicate it's closed
                    });
                }

                function activateLinkAndDetails(targetId) {
                    navLinks.forEach(link => {
                        if (link.getAttribute('href') === `#${targetId}`) {
                            link.classList.add('VK_sidebar_active_link');
                            let parentDetails = link.closest('details');

                            // Open all ancestor details elements
                            while (parentDetails) {
                                parentDetails.setAttribute('open', '');
                                parentDetails.removeAttribute('close'); // Optional: remove the closed indicator
                                parentDetails = parentDetails.parentElement.closest('details');
                            }
                        }
                    });
                }

                function onScroll() {
                    let currentSection = '';
                    sections.forEach(section => {
                        const sectionTop = section.getBoundingClientRect().top;
                        const sectionBottom = section.getBoundingClientRect().bottom;

                        // Check if the section is in view
                        if (sectionTop <= 100 && sectionBottom >= 0) {
                            currentSection = section.getAttribute('id');
                        }
                    });

                    if (currentSection) {
                        removeActiveClass();
                        activateLinkAndDetails(currentSection);
                    } else {
                        removeActiveClass();
                    }
                }

                window.addEventListener('scroll', onScroll);
            } else {
                return
            }
        });
    </script>

    <!-- copy script -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".mv_copy_icon").forEach((icon) => {
                icon.addEventListener("click", async function () {
                    try {
                        const toolbar = this.closest(".mv_code_toolbar");
                        const codeBlock = toolbar.querySelector(".code-content");
                        const codeContent = codeBlock.innerText;

                        // Use Clipboard API to copy text
                        await navigator.clipboard.writeText(codeContent);

                        // Hide the copy icon and show the "Copied!" message
                        const message = toolbar.querySelector(".mv_copy_message");
                        this.classList.add("hidden"); // Hide the copy icon
                        message.classList.remove("hidden"); // Show the "Copied!" message

                        // Hide the message and show the icon again after 2 seconds
                        setTimeout(() => {
                            message.classList.add("hidden");
                            this.classList.remove("hidden");
                        }, 2000); // Adjust delay as needed

                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                    }
                });
            });
        });
    </script>

</body>

</html>



