<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimize Performance on Intel® Processors with HBM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link href=" https://fonts.cdnfonts.com/css/intel-clear " rel="stylesheet">
    <link rel="stylesheet" href="../css/owl.carousel.min.css">
    <link rel="stylesheet" href="../css/yatri.css">
    <link rel="stylesheet" href="../css/rushita.css">
    <link rel="stylesheet" href="../css/rushita_automotive.css">

    <link rel="stylesheet" href="../css/owl.theme.default.min.css">
    <style>
        * {
            font-family: 'Intel Clear', sans-serif;
        }

        .dk_new_options_table {
            border: none !important;
            justify-content: center !important;
            text-align: center !important;
        }

        .dk_new_options_table thead tr td {
            margin-left: 0;
            max-width: fit-content;
            white-space: normal;
            overflow: auto;
            background: #fff;
            padding: 1rem;
            text-align: left;
            border-left: .125rem solid #e2e2e2;
            font-weight: 700 !important;
        }

        .dk_new_options_table thead tr:nth-child(even) td {
            background-color: #f7f7f7;
        }

        .mv_intel_amx h2 {
            font-weight: 300;
        }

        .mv_intel_amx {
            font-size: 1.25rem;
        }

        .mv_intel_amx_bg_color {
            background-color: #0068B5;
        }

        .mv_intel_amx_content {
            padding-right: 200px;
        }

        .mv_intel_amx_item {
            align-content: center;
        }

        .mv_intel_amx {
            color: #fff;
            padding: 1rem;
        }

        .mv_intel_amx h3 {
            font-weight: 300;
        }

        .mv_intel_amx p {
            margin-top: 1.5rem;
            margin-bottom: 0rem;
        }

        .mv_intel_amx_image {
            padding: 1rem;
        }

        .mv_intel_amx_image img {
            width: 100%;
            /* height: 199px; */
        }

        .mv_intel_amx_heading_text {
            font-size: 1.2rem;
            line-height: 1.15;
        }

        .VK_sidebar_active_link {
            color: #262626;
            font-weight: 700;
        }

        .VK_sidebar_active_link:hover {
            color: #262626;
        }

        .VK_print_email_font span {
            font-size: 1.375rem;
        }

        .VK_side_bar_postion_stickey {
            position: sticky;
            top: 0px;
            z-index: 3;
            background-color: #fff;
        }

        .VK_side_heading {
            font-size: 26px;
            font-weight: 400;
        }

        .VK_sidebar_dropdown P {
            margin-left: .313rem !important;
            margin-bottom: .313rem !important;
        }

        .VK_sidebar_dropdown details {
            margin-left: .313rem !important;
            margin-bottom: .313rem !important;
        }
        code {
    color: #000 !important;
    background-color: #E6E6E6;
}
.k_btn{
    height: 80px;
}
.code-simple{
    background-color: #E6E6E6;
}
    </style>
</head>

<body>
    <div id="navbar"></div>

    <section class="m_ai_tdrop">
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Developers
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive"
                        href="../dhruvin_developer-tools/ds_Developer-Zone.html">Overview</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_in_Viewall_SDF_Industrial-Automation_Control-flow-Enforcement_Technology.html">Topics
                        & Technologies</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../dhruvin_developer-tools/ds_Development-Tools.html">Tools</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_in_Viewall_SDF_Industrial-Automation_Hardware-Platforms.html">Hardware
                        Platforms</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../dhruvin_developer-tools/ds_Resource-Documentation-Center.html">Resources &
                        Documentation</a></li>
                <li><a class="dropdown-item m_dropActive" href="../dhruvin_developer-tools/ds_Learn.html">Learn</a>
                </li>
                <li><a class="dropdown-item m_dropActive"
                        href="../dhruvin_developer-tools/ds_Communities-and-Events.html">Community & Events</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../dhruvin_developer-tools/ds_Developer-Programs.html">Developer Programs</a></li>
                <li><a class="dropdown-item m_dropActive" href="../dhruvin_developer-tools/ds_Get-Help.html">Get
                        Help</a></li>
            </ul>
        </div>


        <div class="m_ai_shlash">/</div>
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Tools
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="../Product/B20_developer_catelog.html">Software
                        Catalog</a></li>
                <li><a class="dropdown-item m_dropActive" href="../Product/B17_oneapi.html">oneAPI</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Tiber™Edge-Platform.html">Intel® Tiber™ Edge
                        Platform</a></li>
                <li><a class="dropdown-item m_dropActive" href="../Product/B10_intel_Quarts.html">FPGA</a></li>
                <li><a class="dropdown-item m_dropActive" href="../VK_developers/VK_technology_sdk.html">Intel®
                        Active Management Technology SDK</a></li>
                <li><a class="dropdown-item m_dropActive" href="../VK_developers/VK_intel_adviser.html">Intel®
                        Advisor</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® AI Reference Models</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Collaboration-Suite-for-WebRTC.html">Intel®
                        Collaboration Suite for WebRTC SDK</a>
                </li>
                <li><a class="dropdown-item m_dropActive" href="../Product/B1_19_Intel_AICloud.html">Intel® Tiber™
                        AI Cloud</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Distribution-for-Python.html">Intel® Distribution
                        for Python*</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Distribution-for-GDB.html">Intel® Distribution for
                        GDB*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® DPC++ Compatibility Tool</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Dynamic Application Loader</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Topics_viewall_Cloud-Insider-Program_AI-Frameworks-and-Tools.html">Frameworks</a>
                </li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Embree</a></li>
                <li><a class="dropdown-item m_dropActive" href="../VK_developers/VK_ai_scikit.html">Intel® Extension
                        for Scikit-learn*</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Fortran-Compiler.html">Intel® Fortran Compiler</a>
                </li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Graphics Performance Analyzers</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-HE-Toolkit.html">Intel® Homomorphic Encryption
                        Toolkit</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-In-Band-Manageability.html">Intel® In-Band
                        Manageability</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Cryptography-Primitives-Library.html">Intel®
                        Integrated Performance Primitives</a></li>
                <li><a class="dropdown-item m_dropActive" href="../rushita_Solutions/">Intel® Integrated Simulation
                        Infrastructure with
                        Modeling</a></li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Instruction-Set-Architecture(ISA)Extensions.html">Instruction
                        Set Architecture (ISA) Extensions</a>
                </li>
                <li><a class="dropdown-item m_dropActive"
                        href="../rushita_Solutions/k_solutions_Intel-Intelligent-Storage-Acceleration-Library.html">Intel®
                        Intelligent Storage Acceleration Library
                        (Intel® ISA-L)</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Modin*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® MPI Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Neural Compressor</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">OpenCL™ Runtime</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Open Image Denoise</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Open Path Guiding Library (Intel® Open
                        PGL)</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Pin</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Platform Analysis Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel Tools for OpenCL™ Software</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel Tools for OpenCL™ Applications</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OpenSWR</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">OpenVINO™ Toolkit</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Open Volume Kernel Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Optimization for XGBoost*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OSPRay</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OSPRay for Hydra*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® OSPRay Studio</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">PyTorch* Optimizations from Intel</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">TensorFlow* Optimizations from Intel</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Rendering Toolkit</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Smart Edge Open</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Software Guard Extensions</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Secure Device Onboard</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Software Development Emulator</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Trust Domain Extensions (Intel® TDX)</a>
                </li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Quantum SDK</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Query Processing Library (Intel® QPL)</a>
                </li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® Video Processing Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Intel® VTune™ Profiler</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Resellers</a></li>
            </ul>
        </div>
        <div class="m_ai_shlash">/</div>
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                oneAPI
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="#">Overview</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Data Parallel C++/SYCL*</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Toolkits</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Tech Articles & How-Tos</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Components</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Code Samples</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Training</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Documentation</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Support</a></li>
            </ul>
        </div>
        <div class="m_ai_shlash">/</div>
        <div>
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Tech Articles & How-Tos
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item m_dropActive" href="#">Library</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">News Updates</a></li>
                <li><a class="dropdown-item m_dropActive" href="#">Webinars</a></li>
            </ul>
        </div>
        <div class="m_ai_shlash">/</div>
        <div class="m_ai_httl">Optimize Performance on Intel® Processors with HBM
        </div>
    </section>
    <section style="background-color: #0068B5;">
        <div class="k_container11">
            <div class="row  py-3">
                <div
                    class="col-lg-8 col-md-12 col-sm-12   mx-0 text-white align-content-center  k_tstartauto k_text2  px-0 mx-0 k_mdorder2 ">
                    <h3 class="fs3 mb-2 fw-lighter k_marketsmall">Performance Optimization on Intel® Processors with High Bandwidth Memory</h3>
                    <p class=" fs-5 k_md-small">A Deep Dive into Performance Tuning for the Intel® Xeon® CPU Max Series
                    </p>
                    
                </div>
                <div class="col-lg-3 col-md-12 col-sm-12 k_mdimg  k_mdorder1">
                    <img src="../img/rushita_img/universe.webp" alt="" width="100%">
                </div>
            </div>
        </div>
    </section>
    <section class="k_space k_spacenone">
        <div class="k_container11">
            <div class="row  g-3">
                <div class="float-end k_bignone" style="padding-left:70%;">
                    <div>
                        <a href="#" class="fs-4"><i class="fa-solid fa-print mx-3 k_icon0"></i></a>
                        <a href="#" class="fs-4"> <i class="fa-regular fa-envelope k_icon0"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-12">
                    <div class="VK_sticky_side_bar VK_side_bar_postion_stickey">
                        <div>
                            <div class="VK_sidebar_dropdown">
                                <ul class="k_listnone k_menu ">
                                    <li class="k_text"><a href="#section1" class="k_submenu-toggle">Performance Analysis</a>
                                        <ul class="k_listnone k_submenu">
                                            <li class="k_text"><a href="#section2"></a>Memory Access Patterns</a></li>
                                            <li class="k_text"><a href="#section3"></a>Software Prefetching</a></li>
                                            <li class="k_text"><a href="#section4"></a>Memory Layout</a></li>
                                        </ul>
                                    </li>
                                    <li class="k_text"><a href="#section5">Conclusions</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div>
                      <p><b>
                        Get the Latest on All Things CODE</b></p>
                        <p class="text-center k_btnget py-2 k_under k_btn100 my-2 kcokbtn1024" style="width: 80px;">
                            <a href="#" class="text-white">Sign Up</a>
                        </p>
                        <p id="singleauthorbio" class="authorbio"><p><b>Vamsi Sripathi</b><i>, Software Enabling and Optimization Engineer</i></p>
                        <p>Intel Corporation</p>
                        </p>
                    </div>
                </div>
                <div class="col-lg-8 col-md-7 col-sm-12  k_16smpx k_width75">
                    <div class="float-end mx-3 k_smnone">
                        <div>
                            <a href="#" class="fs-4"><i class="fa-solid fa-print mx-3 k_icon0"></i></a>
                            <a href="#" class="fs-4"> <i class="fa-regular fa-envelope k_icon0"></i></a>
                        </div>
                    </div>
                    <div class=" k_smpaddnone k_smpaddnone1 pt-5">
                        <p>Quantum chromodynamics (QCD) is the theory/study of strong force interaction between subatomic particles. Lattice QCD solves QCD problems by representing the particles and forces as a lattice discretized on space and time domains. HotQCD is a C++ hybrid MPI/OpenMP* lattice QCD simulation framework widely used by the high energy physics research community.</p>
                        <p class="k_plink1 k_intext1blue1">This article describes the performance tuning techniques applied to HotQCD to achieve optimal performance on the Intel® Xeon® CPU Max Series. The key differentiator of the <a href="#">Intel Xeon CPU Max Series</a> over other Intel Xeon processors is the addition of high bandwidth memory (HBM) (<strong>Figure 1a</strong>). In simple terms, HBM is a 3D stacked DRAM interface that delivers higher memory bandwidth performance than DDR memory (single stack DRAM). The Intel Xeon CPU Max Series features up to 56 cores (per CPU socket) with HBM2e in the form of four stacks of eight high DRAM dies per socket, with each DRAM die in the stack having a capacity of 2 GB (4 x 8 x 2 = 64 GB HBM per socket).</p>
                        <h2 class="fw-light mt-5">Performance Analysis</h2>
                        <p class="k_plink1 k_intext1blue1">Intel® processors with HBM have many configuration modes: memory (Flat, Cache, HBM-only) and NUMA (SNC1, SNC4). The details of each mode are beyond the scope of this article, but you can find more information in the <a href="#">Intel Xeon CPU Max Series Configuration and Tuning Guide</a>. The system used for this article was configured in HBM-only memory mode (no DDR5) with SNC4 (Sub-NUMA Clustering-4) (<strong>Figure 1b</strong>).</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 1</strong><strong>.</strong> <strong>(a) Intel® Xeon® CPU Max Series; (b) Intel Xeon CPU Max Series in HBM-only + SNC4 mode</strong></p>
                        <p>The performance snapshot of HotQCD [benchmarked with a lattice size of 32<sup>4</sup>&nbsp;(x=y=z=t=32) with one RHS (right-hand side) vector] shows that the most time-consuming function (<span class="code-simple">dslash</span>, which consumes 90% of the total execution time) is memory bandwidth-bound (i.e., the processor was stalled ~50% of the time waiting for memory operations) (<strong>Figure 2</strong>).</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM1.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 2. Baseline performance snapshot from the Intel® VTune™ Profiler using microarchitecture exploration analysis</strong></p>
                        <p>The OpenMP parallel region of <span class="code-simple">dslash</span> is shown in <strong>Figure 3</strong>. At each point in the lattice, a set of four dense matrix-vector products is performed through operator overloading. The function is fully vectorized with Intel® AVX-512 intrinsics with no synchronization among threads. <span class="code-simple">Link_std</span> has two matrix-vector products with each matrix and vector comprised of nine and three cache lines, making a total of 4 x 2 x (9 + 3) = 96 cache lines read. <span class="code-simple">Link_naik</span> is like <span class="code-simple">link_std</span> except that its matrix is populated by loading only seven cache lines, for a total of 4 x 2 x (7 + 3) = 80 cache lines read. All the memory accesses are cache line-aligned with a negligible amount of data reuse, which clearly shows that this function is memory bandwidth-bound (with a FLOP:byte ratio of ~0.9) with heavy read traffic [for every 176 (96 + 80) cache lines read, only three cache lines are written to memory]. In other words, the processor needs to continuously read data from memory to perform the floating-point calculations.</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM2.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 3</strong><strong>.</strong> <strong>HotQCD dslash code</strong></p>
                        <h3>Memory Access Patterns<a class="inpage-nav-anchor" id="inpage-nav-undefined-undefined"></a></h3>
                        <p><strong>Figure 4</strong> shows the operation sequence in the <span class="code-simple">link_std</span> block (lines 1517 and 1518) over the inner (each point in a 4-D lattice) and outer (lattice points) loops with the same color indicating a contiguous memory region and a different color indicating a large stride in memory (relative to the temporal memory access requests). Each matrix (nine cache lines, denoted CL) is loaded from contiguous memory with a constant stride of 1,172 elements across the outer loop. A stride of 1,172 FP32 elements (1,172 x 32 bytes = 4,688 bytes) leads to accessing a new 4 KB page at each outer loop iteration. The successive vectors loaded (in the inner loop) are separated by large strides as well. However, they form a contiguous address stream over the outer loop iteration space. When compared to the matrices, the vectors have better access pattern because there is no jumping across 4 KB pages. Finally, each matrix-vector product is fully unrolled with 27 AVX-512/ZMM registers. The matrix needs 3 x 3 x 2 (for the real and imaginary parts of the complex numbers) = 18 ZMM registers. The vector needs 3 x 1 x 2 = 6 ZMM registers plus three ZMM for accumulation of results across the inner loop.</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM3.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 4</strong><strong>.</strong> <strong>Dslash memory access patterns</strong></p>
                        <h3>Software Prefetching</h3>
                        <p class="k_plink1 k_intext1blue1">Intel processors have various hardware prefetchers (L1$, L2$) capable of detecting both streaming and striding access patterns (see the <a href="#">Intel 64 and IA-32 Architectures Optimization Reference Manual</a> for more details), but they all prefetch within a 4 KB page boundary and do not fetch data across pages. Because the matrices in HotQCD are accessed in strides that cross the page boundary, the effectiveness hardware prefetching is reduced. This is further compounded by the fact that there are multiple strided access streams in the loop body, which can further stress the hardware prefetcher. This led us to investigate the performance impact of using explicit software prefetching to mitigate the effects of large access strides. In other words, we aim to enhance the effectiveness of hardware prefetchers by issuing prefetch instructions (available in the <a href="#">x86 ISA</a>) to preemptively fetch the data from memory before being consumed in corresponding computation operations (<strong>Figure 5</strong>).</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM4.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 5</strong><strong>.</strong> <strong>Dslash with software prefetching</strong></p>
                        <p>The effectiveness of software prefetching is mainly driven by two factors:</p>
                        <ul>
                            <li><strong>Prefetch distance:</strong> The ideal prefetch distance is determined by factors such as the size of working set, the latency of instructions in the loop body, and the location of data (memory/cache) that is being fetched. Prefetching too far ahead can cause the prefetched data to be evicted from caches by the intermediate iteration working sets, whereas prefetching too near would not hide the latency of memory hierarchy. In either case, it reduces the usefulness of software prefetching and can even degrade performance because of the additional memory access requests generated by the prefetch instructions, which is an additional burden on the already saturated memory pipeline queues.</li>
                            <li><strong>Cache hierarchy:</strong> This controls the cache level to which the requested data is to be placed. x86 ISA has prefetch instructions that can place data in L1, L2, and last level cache with additional control available to minimize cache pollution at lower level for non-temporal accesses. In some applications, it would be beneficial to have a multilevel prefetching mechanism as well, wherein a larger prefetch distance is used to prefetch data from memory to L2 cache, and a shorter distance for prefetching from L2 to L1 cache.</li>
                        </ul>
                        <p>There are two primary mechanisms to use software prefetching in applications: Intel® compiler flags or prefetch intrinsic functions. We chose the latter because it gives us finer control. <strong>Figure 6</strong> shows the speedup from software prefetching + hardware prefetchers over the baseline performance (using only hardware prefetchers) with different distance and cache hierarchy. We get 1.13x speedup by prefetching data from 10 iterations ahead (site) to L2 cache.</p>
                        <div class="my-5 col-sm-12 col-md-4 m-auto" >
                            <img src="../img/rushita_img/HBM5.png" alt="" width="100%" height="400px">
                        </div>
                        <p style="text-align:center"><strong>Figure 6</strong><strong>.</strong> <strong>Performance improvement from software prefetching</strong></p>
                        <h3>Memory Layout<a class="inpage-nav-anchor" id="inpage-nav-undefined-2"></a></h3>
                        <p>In HotQCD, the key operation is to calculate the inverse of a large matrix using the indirect, iterative conjugate gradient (CG) method to solve the linear system. The CG takes approximately 2,000 iterations to converge. Each CG iteration computes the updated vector by computing four matrix-vector products (discussed previously) followed by halo exchange among MPI ranks. Across the CG iterations, the matrices remain unmodified with only the vectors getting updated. We can take advantage of this pattern wherein the first CG iteration copies the matrices to a more performant non-strided/packet format. In the subsequent iterations, we load the matrices from the packed buffer (<strong>Figures 7</strong> and <strong>8</strong>).</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM6.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 7</strong><strong>.</strong> <strong>Dslash packed matrix layout</strong></p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM7.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 8</strong><strong>.</strong> <strong>Matrix packed layout code</strong></p>
                        <p>By having a contiguous matrix memory layout, we avoid strided accesses across both inner and outer loops. This is especially beneficial because the hardware prefetcher is heavily stressed by striding &gt;4 KB in the native matrix layout (baseline). The CG takes ~2,000 iterations, so the copy cost in the first iteration is amortized. Because we need to copy the matrix in native layout to a packed buffer, we need to allocate extra memory (1 GB for the tested problem size). This, however, is not a limiting factor because the total runtime memory footprint of HotQCD is well within the HBM capacity of 64 GB per socket.</p>
                        <p><strong>Figure 9</strong> shows the VTune™ Profiler snapshot comparison of baseline against packed memory layout. The packed memory layout shows lower cycles per instructions (CPIs) (0.4 vs 1.4) and fewer execution slots stalled on memory requests (28% vs 44%).</p>
                        <div class="my-5">
                            <img src="../img/rushita_img/HBM8.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 9</strong><strong>.</strong> <strong>VTune™ Profiler comparison between the baseline and packed layout</strong></p>
                        <p>Overall, by employing packed memory layout, the performance of HotQCD improves by 1.38x over baseline (<strong>Figure 10</strong>). The <span class="code-simple">dslash</span> kernel gets a boost of 1.54x, but it does not fully translate to the full benchmark gains as the packed layout causes cache pollution and slows down the subsequent vector operations that follow <span class="code-simple">dslash</span>. The optimizations are applicable to Intel Xeon systems without HBM as well, with observed performance gains of 1.21x over baseline (<strong>Figure 11</strong>).</p>
                        <div class="my-5 col-sm-12 col-md-7 m-auto">
                            <img src="../img/rushita_img/HBM9.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 10</strong><strong>.</strong> <strong>HotQCD relative performance speedup on the Intel® Xeon® CPU Max Series</strong></p>
                        <div class="my-5 col-sm-12 col-md-7 m-auto">
                            <img src="../img/rushita_img/HBM10.png" alt="" width="100%">
                        </div>
                        <p style="text-align:center"><strong>Figure 11</strong><strong>.</strong> <strong>HotQCD performance on the Intel® Xeon® processor and the Intel® Xeon® CPU Max Series</strong></p>

                        <h2 class="fw-light mt-5">Conclusions</h2>
                        <p>We conclude with the following key takeaways:</p>
                        <ul>
                            <li>The Intel Xeon CPU Max Series featuring HBM delivers significant performance boosts over their DDR5 counterparts: 1.66x to 1.88x.</li>
                            <li>Prefetching can further boost HBM performance: 1.13x over HBM baseline.</li>
                            <li>It’s imperative to understand application memory access patterns to fully tune prefetch performance. While prefetch instructions are cheap, use them with care.</li>
                            <li>Large memory access strides that cross the 4 KB page boundary are not ideal for HBM performance. As demonstrated, prefer to read contiguous chunks of memory over strided accesses. This delivers optimal HBM performance: 1.38x to 1.54x over baseline.</li>
                        </ul>
                    </div>
                </div>
            </div>
    </section>
    <section class="mt-5">
        <div class="k_container11">
            <div class="row">
                <div>
                    <h2 class="fw-light">The Parallel Universe Magazine - Issue #53</h2>
                    <P>Intel’s quarterly magazine for software innovation helps you take your software development into the future with the latest tools, tips, and training to expand your expertise.  </P>
                </div>
                <div class="row k_space ">
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text k_gutter">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="../rushita_Solutions/k_solutions_Direct-Memory-Access-Reduce-Data-Center-Tax.html">
                                Beyond Direct Memory Access: Reducing the Data Center Tax with Intel Data Streaming Accelerator
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text k_gutter">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="#">
                                Cultivate Parallel Standards: Diversity, Alignment, and Cross-Pollination
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text k_gutter">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="../rushita_Solutions/k_solutions_Minimizing-the-Risks-Generative-AI.html">
                                The Moat Is Trust or Maybe Just Responsible AI
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="../rushita_Solutions/k_solutions_Train-Large-Language-Models-Create-Chatbot.html">
                                Create Your Own Custom Chatbot
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="#">
                                Fine-Tune the Falcon 7 Billion Parameter Model with Hugging Face* and oneAPI
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="../rushita_Solutions/k_solutions_Use-Fortran-DO-CONCURRENT-for-Accelerator-Offload.html">
                                Using Fortran DO CONCURRENT for Accelerator Offload
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="../rushita_Solutions/k_solutions_Optimize-Performance-on-Intel-Processors-with-HBM.html">
                                Performance Optimization on Intel Processors with High-Bandwidth Memory
                            </a>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4 k_laptop k_text">
                        <div class="k_btn k_resoursebtn k_xeonbtn p-3 k_btngrey">
                            <a href="../rushita_Solutions/k_solutions_Parallel-Universe-Magazine.html">
                                Check out the Latest Issue
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="my-4" style="font-size: 13px;">
        <div class="k_container11">
            <div class="row">
                <div>
                    <hr class="mb-5">
                    <p>Product and Performance Information </p>
                    <div class="k_plink1 k_intext1blue1"><sup>1</sup>Performance varies by use, configuration and other
                        factors. Learn more at &nbsp;<a href="#">www.Intel.com/PerformanceIndex.</a>.
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div id="footer"></div>
    <script>
        // navbar include  
        fetch('../y_index/y_navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
        // footer include 
        fetch('../y_index/y_footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script src="../js/jquery-3.7.1.js"></script>

    <script src="../js/owl.carousel.min.js"></script>
    <script src="../js/rushita.js"></script>
</body>

</html>