<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Avatar Chatbot with PyTorch and OPEA</title>

    <link rel="stylesheet" href="/css/dk_developer_edge_iot_&_5G_social_distancing_for_retail_settings.css">

    <!-- header footer -->
    <link rel="stylesheet" href='/css/yatri.css'>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
</head>

<style>
    .dk_oneapi_deco{
        color: #0068b5;
        font-weight: bold;
    }
    .dk_oneapi_deco:hover{
        text-decoration: underline;
    }
    @media (max-width: 767px){
    .dk_designed_oneapi{
        flex-wrap: wrap-reverse !important;
    }
    .dk_designed_oneapi img{
        margin-bottom: 2rem;
        }  
    .dk_types_of_information img{
        width: 100% !important;
    }     
    }
    .dk_overview_api{
        word-wrap: break-word;
        background-color: #e6e6e6;
        padding: 20px;
        border-left: 3px solid #fdb813;
    }
    .dk_overview_api p{
        font-weight: bold;
    }
    .dk_overview_api_sub{
        color: blue;
        text-decoration: underline !important;
        font-weight: 700;
    }
    .dk_overview_api_sub:hover{
        color: blue;
    }
    .dk_overview_api_sub2{
        color: blue;
        text-decoration: underline !important;
        font-weight: 400;
    }
    .dk_overview_api_sub2:hover{
        color: blue;
    }
</style>

<body>

    <!-- header -->
    <div id="navbar"></div>

    <!-- Social Distancing for Retail Settings -->
    <section>
        <div class="mv_intel_amx_bg_color">
            <div class="container">
                <div class="row mv_intel_amx_content">
                    <div class="col-md-12 col-sm-12 mv_intel_amx_item">
                        <div class="mv_intel_amx">
                            <h2 style="font-weight: 300; font-size: 1.75rem;">Create an AI Avatar Talking Bot with PyTorch* and Open Platform for Enterprise AI (OPEA)</h2>
                            <p>Build and deploy on Intel® Xeon® Scalable Processors and Intel® Gaudi® Al Accelerators</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container py-5">
        <div class="row">
            <div class="d-flex justify-content-end col-xl-10 py-3 d-md-none">
                <i class="fa-solid fa-print fs-4 px-2 " style="color:#0068B5"></i>
                <i class="fa-regular fa-envelope fs-4 px-2" style="color:#0068B5"></i>
            </div>
            <div class="col-lg-3 col-md-4">
                <!-- nav -->
                <div class="VK_sticky_side_bar VK_side_bar_postion_stickey">
                    <div>
                        <div class="VK_sidebar_dropdown">
                            <details>
                                <summary>
                                    <a href="#dk_overview_ai_avtar" class="text-decoration-none VK_a">
                                        Overview
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_open_platform" class="text-decoration-none VK_a my-1">
                                            Open Platform for Enterprise AI (OPEA)
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <details>
                                <summary>
                                    <a href="#dk_how_to_build" class="text-decoration-none VK_a">
                                        How to build an AI Avatar Chatbot under the OPEA framework?
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_flow_chart" class="text-decoration-none VK_a my-1">
                                            I. Flow Chart
                                            <ol>
                                                <li><a href="#dk_build_animation">Build a new Microservice “Animation” in GenAIComps Repo</a></li>
                                                <li><a href="#dk_build_avatar">Build a new Megaservice “AvatarChatbot” in GenAIExamples</a></li>
                                                <li><a href="#dk_define_gateway">Define Gateway for our megaservice</a></li>
                                            </ol>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#dk_lip_synchronization" class="text-decoration-none VK_a my-1">
                                            II. Lip Synchronization and Face Animation Models
                                            <ol>
                                                <li><a href="#dk_wav2lip">Wav2Lip + GFPGAN</a></li>
                                                <li><a href="#dk_sadtalker">SadTalker</a></li>
                                            </ol>
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <p class="m-0">
                                <a href="#dk_how_deploy_intel" class="text-decoration-none VK_a">
                                    How to deploy on Intel® Xeon® scalable processors and Intel® Gaudi® AI Accelerators
                                </a>
                            </p>
                            <details>
                                <summary>
                                    <a href="#dk_deep_learning" class="text-decoration-none VK_a">
                                        Deep Learning Optimizations
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_mode_of_operation" class="text-decoration-none VK_a my-1">
                                            Mode of Operation: Eager mode vs. Lazy mode
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_run_inference" class="text-decoration-none VK_a my-1">
                                            Run Inference Using BF16 & FP8 with PyTorch Autocast and Intel® Neural Compressor
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <details>
                                <summary>
                                    <a href="#dk_feature_improve" class="text-decoration-none VK_a">
                                        Feature Improvements
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_text_to_speech" class="text-decoration-none VK_a my-1">
                                            Text-to-Speech (TTS) Service
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_animation_service" class="text-decoration-none VK_a my-1">
                                            Animation Service
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <p class="m-0">
                                <a href="#dk_instructions_run" class="text-decoration-none VK_a">
                                    Instructions to Run the AI Avatar Chatbot – Try on your own!
                                </a>
                            </p>
                            <details>
                                <summary>
                                    <a href="#dk_future_work" class="text-decoration-none VK_a">
                                        Future Work
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_real_time" class="text-decoration-none VK_a my-1">
                                            Real-time streaming of LLM and TTS outputs and animated frames
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_useful_res" class="text-decoration-none VK_a my-1">
                                            Useful Resources
                                            <ul style="list-style-type: none;">
                                                <li><a href="#references">References</a></li>
                                            </ul>
                                        </a>
                                    </li>
                                </ul>
                               
                            </details>
                        </div>
                    </div>
                </div>
                <!-- thinkcode -->
                <div class="dk_things_code_main">
                    <div class="dk_things_code">
                        <h2 class="text-left headline-font-one-bold mb-4">Stay in the Know on All Things CODE</h2>
                        <a class="dk_button" href="">Sign Up</a>
                        <p class="mb-0">&nbsp;</p>
                    </div> 
                </div>
                <p><i>Chun Tao, AI Software Solutions Engineer Intern, Intel | <a class="b_special_a2" href="">LinkedIn<br>
                </a>Alex Sin, AI Software Solutions Engineer, Intel | <a class="b_special_a2" href="">LinkedIn</a> <br>
               Louie Tsai, AI Software Solutions Engineer, Intel | <a class="b_special_a2" href="">LinkedIn<br>
                </a>Ramya Ravi, AI Software Marketing Engineer, Intel | <a class="b_special_a2" href="">LinkedIn<br>
                </a></i></p>
            </div>
            <div class="col-lg-9 col-md-8">
                <div class="d-md-flex justify-content-between col-xl-10 py-3 d-none">
                    <div class="">
                        <p>10/28/2024</p>
                    </div>
                    <div class="">
                        <i class="fa-solid fa-print fs-4 px-2 " style="color:#0068B5"></i>
                        <i class="fa-regular fa-envelope fs-4 px-2" style="color:#0068B5"></i>
                    </div>
                </div>
                <div class="col-xl-10 VK_all_sections">
                    <section id="dk_random_number">
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">&nbsp;</p>
                    </section>

                    <section id="dk_overview_ai_avtar">
                        <h3 style="font-weight: 300;">Overview</h3>
                        <p style="text-align:justify">AI Avatar chatbots are reshaping the business of various industries in today’s AI world. From reception desks of financial and educational institutions to public facilities such as airports and hospitals, ubiquitous digital human AIs assist in answering customer queries and providing personalized guidance.</p>
                        <p style="text-align:justify">To meet this need from enterprises of digital human AIs, we developed an “<a class="b_special_a1" href="">AI Avatar Audio Chatbot</a>”. This article introduces how to leverage <a class="b_special_a1" href="">Open Platform for Enterprise AI (OPEA)</a>, an open, multi-provider, and robust framework of composable building blocks for state-of-the-art (SOTA) Generative AI (GenAI) systems to create an AI Avatar Chatbot on <a class="b_special_a1" href="">Intel® Xeon® Scalable Processors</a> and <a class="b_special_a1" href="">Intel® Gaudi® Al Accelerators</a>. It also highlights how Intel-optimized software such as <a class="b_special_a1" href="">Intel® Gaudi® Software Suite</a> and <a class="b_special_a1" href="">PyTorch*</a> can help accelerate the training and inference performance of these AI solutions. accelerate the training and inference performance of these AI solutions.</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/ai-generated-images.png" alt="">
                        </div>
                        <p class="mb-4"><strong>Figure 1. Sample images generated from Stable Diffusion 3 Medium [13]</strong></p>
                    </section>

                    <section id="dk_open_platform">
                        <h4>Open Platform for Enterprise AI (OPEA)</h4>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/opea-stacked-logo-rwd.png" alt="">
                        </div>
                        <p class="mb-0">The OPEA platform includes:</p>
                        <ul>
                            <li>A framework of microservice building blocks for SOTA GenAI systems including LLM, data stores, and prompt engines</li>
                            <li>Architectural blueprints of Retrieval-Augmented Generation (RAG) GenAI component stack structure</li>
                            <li>Micro and Megaservices to get GenAI solutions into production and deployment</li>
                            <li>A four-step assessment for grading GenAI systems around performance, features, trustworthiness, and enterprise-grade readiness</li>
                        </ul>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/newsroom-rag-flow.jpg" alt="">
                        </div>
                        <p><strong>Figure 2. Retrieval Augmented Generation (RAG) enhanced GenAI Ref Solution on OPEA [14]</strong></p>
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">For any OPEA Enterprise AI solution, there are three major components:</p>
                        <ol>
                            <li>Microservices: Provides flexible and scalable solutions.<br>
                            The <a class="b_special_a1" href="">GenAIComps repo</a> hosts all the available microservices. Each microservice is designed to perform a specific function or task within the application architecture.<br>
                            &nbsp;</li>
                            <li>Megaservices: Provides comprehensive solutions.<br>
                            The <a class="b_special_a1" href="">GenAIExamples repo</a> hosts a collection of use case-based applications. Unlike individual microservices that focus on specific tasks, a megaservice orchestrates multiple microservices to deliver a comprehensive solution<br>
                            &nbsp;</li>
                            <li><strong>Gateways:</strong> Provides communication.<br>
                            The Gateway serves as the interface for users to access a megaservice and its underlying microservices. Gateways support API definition, versioning, rate limiting, request transformation, and data retrieval from microservices.</li>
                        </ol>
                        <p>Additionally, for most AI solutions, there is a corresponding UI that allows the user to interact with OPEA megaservices in a more direct, interactive, and visualized manner.</p>
                    </section>

                    <p class="">&nbsp;</p>

                    <section id="dk_how_to_build">
                     <h3 style="font-weight: 300">How to build an AI Avatar Chatbot under the OPEA framework?</h3>
                    </section>
                     <p class="mb-0">&nbsp;</p>

                     <section id="dk_flow_chart"> 
                        <h4>I. Flow Chart</h4>
                        <p style="text-align:justify">The flow of the entire application is shown in the graph. The code sample is the “Avatar Chatbot” example [15] in the OPEA GenAIExamples repository. In the flowchart diagram we highlight the “AvatarChatbot” megaservice, which is the core of the application. The megaservice orchestrates four different microservices “Automatic Speech Recognition (ASR)”, “Large Language Model (LLM)”, “Text-to-Speech (TTS)”, and “Animation”, connected in the form of a Directed Acyclic Graph (DAG).</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/flowchart.png" alt="">
                        </div>
                        <p><strong>Figure 3. Flowchart for the AvatarChatbot Example in OPEA [15]</strong></p>
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">Each microservice handles a particular functionality of the avatar chatbot. For example:</p>
                        <ul>
                            <li style="text-align:justify"><strong>Automatic Speech Recognition (ASR)</strong> is a voice recognition software that converts human speech to text.</li>
                            <li style="text-align:justify"><strong>Large Language Model (LLM)</strong> processes the transcribed text from ASR by understanding the user’s query and generates the appropriate text response.</li>
                            <li style="text-align:justify"><strong>Text-to-Speech (TTS)</strong> service converts the text response generated from the LLM into audio speech.</li>
                            <li style="text-align:justify"><strong>Animation</strong> service combines both the audio response from TTS and the user-defined AI avatar image/video and ensures that the avatar figure’s lip movements will match the synchronized speech. It then generates a video featuring the avatar speaking back to the user.</li>
                        </ul>
                        <p style="text-align:justify" class="mb-4">The user inputs include an audio query and an image/video visual input. The output is a face-animated avatar video. Users will be able to get close to real-time feedback from the avatar chatbot, including hearing the audible answer and watching the chatbot talk naturally.</p>
                     </section>
                     
                     <section id="dk_build_animation">
                        <h4><strong>1. Build a new Microservice “Animation” in GenAIComps Repo</strong></h4>
                        <p style="text-align:justify">To add a new microservice such as “Animation”, we would need to register that microservice under comps/animation:</p>

                            <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_green"># Register the microservice</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">@register_microservice</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name <span class="dk_code_org">=</span><span style="color: blue;">"opea_service@animation"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; service_type=ServiceType.ANIMATION,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endpoint <span class="dk_code_org">=</span><span style="color: blue;">"/v1/animation"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; host <span class="dk_code_org">=</span><span style="color: blue;">"0.0.0.0"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span><span class="dk_code_blue">9066</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_datatype<span class="dk_code_org">=</span>Base64ByteStrDoc,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_datatype<span class="dk_code_org">=</span>VideoPath,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span>}</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">@register_statistics(names<span class="dk_code_org">=</span>[ <span style="color: blue;">"opea_service@animation"</span> ])</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p style="text-align:justify">After the registration process, we define the callback function when this microservice is executed. In the case of “Animation,” we will use the “animate” function that takes a “Base64ByteStrDoc” object as its input audio and generates an “VideoPath” object that contains the path to the generated avatar video. Within “animation.py” we post an API request to the “wav2lip” FastAPI’s endpoint and collect the response, both in json format. Check out the code required in the <a class="b_special_a1" href="">link here</a>.</p>

                    <p><strong><em>Note:</em></strong><em> </em>Don’t forget to add “Base64ByteStrDoc” and “VideoPath” classes in comps/cores/proto/docarray.py and import it in comps/__init__.py!</p>

                    <p style="text-align:justify">The code for “wav2lip” server API is in the <a class="b_special_a1" href="">link here</a>. It’s a FastAPI that has its post function specified to process the incoming audio Base64Str and user-specified avatar image or video, and to output an animated video and return its path.</p>

                    <p>The above steps help us create the functional block for our microservice. To allow the user to build the necessary dependencies and run the “Animation” microservice, we need to write a Dockerfile for “wav2lip” server API and another one for “Animation”. The <a class="b_special_a1" href="">Dockerfile.intel_hpu</a>, for example, starts with the PyTorch* installer Docker image on Intel Gaudi, and ends with calling an “entrypoint” bash script.</p>

                     </section>

                    <section id="dk_build_avatar">
                        <h4 class="">2. Build a new Megaservice “AvatarChatbot” in GenAIExamples</h4>
                        <p>In python “AvatarChatbot/docker/avatarchatbot.py” file, we will first define the megaservice class AvatarChatbotService. In the “add_remote_service” function, use the “add” function of the megaservice orchestrator to add “asr”, “llm”, “tts”, and “animation” microservices as nodes in a Directed Acyclic Graph (DAG), and use the flow_to function to connect the edges.</p>

                          <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">class</span>&nbsp; AvatarChatbotService :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">def</span> __init__ ( self , host <span class="dk_code_org">=</span> <span style="color: blue;">" 0 . 0 . 0 . 0 ",</span> port <span class="dk_code_org">=</span> <span class="dk_code_blue">8000</span> ) :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.host <span class="dk_code_org">=</span> host</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.host <span class="dk_code_org">=</span> port</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice <span class="dk_code_org">=</span> ServiceOrchestrator() </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">def</span> add_remote_service ( self ) :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;asr <span class="dk_code_org">=</span> MicroService<span>(</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span>" asr " ,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host <span class="dk_code_org">=</span> ASR_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port <span class="dk_code_org">=</span> ASR_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    12
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;">"/v1/audio/transcriptions" </span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    13
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    14
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type<span class="dk_code_org">=</span>ServiceType.ASR,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    15
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    16
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;llm <span class="dk_code_org">=</span> MicroService(</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    17
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span><span style="color: blue;">"llm"</span>,</p>
                                    </div>
                                </div>
                            </div><div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    18
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host<span class="dk_code_org">=</span>LLM_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    19
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span>LLM_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    20
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;">"/v1/chat/completions"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    21
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    22
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type <span class="dk_code_org">=</span> ServiceType.LLM,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    23
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    24
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tts <span class="dk_code_org">=</span> MicroService(</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    25
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span> <span style="color: blue">"tts"</span> ,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    26
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host<span class="dk_code_org">=</span>TTS_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    27
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span>TTS_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    28
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;"> "/v1/audio/speech",</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    29
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    30
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type <span class="dk_code_org">=</span> ServiceType.TTS,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    31
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    32
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;animation <span class="dk_code_org">=</span> MicroService(</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    33
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span> <span style="color: blue;"> "animation"</span> ,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    34
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host<span class="dk_code_org">=</span>ANIMATION_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    35
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span>ANIMATION_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    36
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;">"/v1/animation"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    37
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    38
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type<span class="dk_code_org">=</span>ServiceType.ANIMATION,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    39
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    40
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.add ( asr ) .add( llm ) .add ( tts ) .add ( animation )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    41
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.flow_to ( asr , llm )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    42
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.flow_to ( llm, tts )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    43
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.flow_to ( tts , animation )
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    44
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.gateway <span class="dk_code_org">=</span> AvatarChatbotGateway(megaservice=self.megaservice, host<span class="dk_code_org">=</span> <span style="color: blue;">"0.0.0.0"</span>, port<span class="dk_code_org">=</span>self.port)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    </section>

                    <section id="dk_define_gateway">
                        <h4><strong>3. Define Gateway for our megaservice</strong></h4>
                        <p>A gateway is an interface for users to access the Megaservice. We define the AvatarChatbotGateway class in the python file - <a class="b_special_a1" href="">GenAIComps/comps/cores/mega/gateway.py</a>. The AvatarChatbotGateway contains the megaservice orchestrator, host, port, endpoint, and input and output datatype information. It also has a handle_request function that schedules passing the initial input with parameters to the first microservice and collects response from the last microservice.<br>
                            Finally, we need to write a <a class="b_special_a1" href="">Dockerfile</a> for users to easily build the AvatarChatbot backend Docker&nbsp;image and deploy the “AvatarChatbot” examples. The Dockerfile includes scripts to install necessary GenAI components and dependencies.</p>
                    </section>

                    <section id="dk_lip_synchronization">
                        <h4 style="font-weight: 400;">II. Lip Synchronization and Face Animation Models</h4>
                    </section>

                    <section id="dk_wav2lip">
                        <h4 style="font-weight: 400;">1. Wav2Lip + GFPGAN</h4>
                        <p class="mb-0"><strong>Wav2Lip [2]</strong> is a cutting-edge lip-synchronization technique that leverages deep learning to accurately align audio with video. Wav2Lip includes:</p>
                        <ul>
                            <li>A pre-trained expert lip-sync discriminator that is accurate in detecting sync in real videos</li>
                            <li>A modified LipGAN [6] model to generate a talking face video frame-by-frame</li>
                        </ul>
                        <p>The pretraining stage includes training an expert lip-sync discriminator on the LRS2 [4] dataset. The lip-sync expert is pre-trained to output the probability that the input video-audio pair is in sync.</p>
                        <p class="mb-0">During Wav2Lip training, a similar architecture to LipGAN is used. The generator contains a speech encoder, a visual encoder, and a face decoder. All three are stacks of convolutional layers. The discriminator is also a convolutional block. The modified LipGAN is trained like any other GANs: the generator is trained to minimize the adversarial loss, based on the discriminator’s score; the discriminator is trained to distinguish between frames generated by the generator versus the ground-truth frames. Overall, the generator is trained by minimizing a weighted sum of the following loss components:</p>
                        <ol>
                            <li>An L1 reconstruction loss between generated and ground-truth frames</li>
                            <li>A synchronization loss between generated video frames and input audio from the lip-sync expert</li>
                            <li>An adversarial loss between the generated and ground-truth frames, based on the discriminator score</li>
                        </ol>
                        <p>Upon inference, we feed the Wav2Lip model with the audio speech from the preceding TTS block, along with the video frames that contain the avatar figure. The trained Wav2Lip model outputs a lip-synced video featuring the avatar speaking out the speech.</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/wav2lip.png" alt="">
                        </div>
                        <p><strong>Figure 4. Wav2Lip [2] approach to generate accurate lip-sync</strong></p>
                        <p class="mb-0">&nbsp;</p>
                        <p>The video generated from Wav2Lip features lip synchronization, but the resolution around the mouth area is lowered. Optionally, we could append a GFPGAN [7] model after Wav2Lip to improve the face quality within the generated video frames. The GFPGAN model estimates a high-quality image from an input facial image suffering from unknown degradation through face restoration. It is a U-Net [8] degradation removal module that uses a pretrained face GAN (such as Style-GAN2 [3]) as a prior. The GFPGAN model is pretrained to restore high-quality face details in its output frames, leaving us with a more vivid and realistic avatar representation.</p>
                    </section>

                    <section id="dk_sadtalker">
                        <h4 style="font-weight: 400;">2. SadTalker</h4>
                        <p>In addition to Wav2Lip, we offer another state-of-the-art model choice to perform face animation. Stylized Audio-Driven Talking-head video generation, SadTalker [5], generates 3D motion coefficients (head, pose, expression) of a 3D Morphable Model (3DMM) [1] from audio. These coefficients are mapped to 3D key points, and further used to drive the input image through a 3D-aware face renderer. The output is a realistic talking head video.</p>
                        <p>We enabled the deployment of both Wav2Lip and SadTalker models on Intel® Xeon® Scalable processors, and Wav2Lip model on Intel® Gaudi® Al accelerators.</p>
                    </section>

                    <p class="mb-0">&nbsp;</p>

                    <section id="dk_how_deploy_intel">
                        <h4 style="font-weight: 300;">How to deploy on Intel® Xeon® scalable processors and Intel® Gaudi® AI Accelerators</h4>
                        <p>Based on your intended deployment environment, the required Docker images for the same FastAPI service/microservice/megaservice could vary. For example, “wav2lip” service container&nbsp;uses an image named “opea/wav2lip:latest” when deployed on Intel® Xeon® CPUs and another image named “opea/wav2lip-gaudi:latest” when deployed on Intel® Gaudi® AI Accelerators. These images use separate versions of Dockerfiles, to include their respective dependencies.</p>
                        
                    </section>
                    <p class="mb-0">&nbsp;</p>

                    <section id="">

                    </section>

                    <section id="dk_improvements_pgo">
                        <h4>Improvements to Inlining and PGO Reports</h4>
                        <p>The profile-guided optimization report has been greatly improved, with the data produced now being on par with the reports for the classic compilers.&nbsp; When data produced by instrumented PGO is available, the optimization report includes data for each function about whether (a) data was applied, (b) data was not applied due to the data not being found, or (c) data was not applied due to the function having changed since the data was collected.&nbsp; When data produced by hardware PGO is available, the optimization report describes which functions had the data applied.&nbsp; Additionally, there is information about which functions are considered “hot” and “cold” based on their profile usage and about indirect function calls that were specialized for specific call targets.</p>

                        <p>The inline report now works properly for Thin LTO mode (which allows for parallel compilation while performing whole-program optimization), ensuring data from one compilation is not overwritten by data from another compilation.&nbsp; We have also addressed some reported bugs related to the ordering of the output.</p>
                    </section>

                    <section id="dk_improvements_optimi">
                        <h4>Improvements to Loop Optimization Reports</h4>
                        <p>The loop optimizer now produces a remark for each loop, even those that have been completely optimized away.&nbsp; A placeholder “loop” appears in the report for purposes of holding this remark, and the location of the placeholder loop relative to other loops has been improved.</p>

                        <p>The loop optimizer now detects situations where it believes the user could make changes to improve performance and adds remarks in the optimization report explaining this.&nbsp; For example, the loop optimizer can see that a loop interchange optimization may be beneficial. However, the compiler may not do it automatically since the source loop nest is not “perfect.” (i.e., there are source statements between the different loops).&nbsp; The optimization report can flag this scenario and indicate that the user may get better performance by rewriting the source and interchanging the order of induction variables in the nest.</p>
            
                         <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">subroutine</span>&nbsp;compute ( a , b , c , d , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  a ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  b ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  c ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  d ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">do</span> &nbsp;  k <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">do</span> &nbsp;  j <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="dk_code_blue">if</span>  ( j <span class="dk_code_org">. lt .</span> k ) d (k , j ) <span class="dk_code_org">=</span> d ( j , k )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="dk_code_blue">do</span> i <span class="dk_code_org">=</span> j , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  c ( j , i ) <span class="dk_code_org">=</span>  c ( j , i ) <span class="dk_code_org">+</span>  a ( i , k ) <span class="dk_code_org">*</span>  b ( k , j )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="dk_code_blue">enddo</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    12
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="dk_code_blue">enddo</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    13
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> <span class="dk_code_blue">enddo</span></p>

                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    14
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> <span class="dk_code_blue">end &nbsp;subroutine</span>  </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p><strong>Figure 2:</strong> Nested Loop Impacting Optimization</p>
                    <p>As an example, consider the Fortran code in Figure 2.&nbsp; The programmer has placed two unrelated computations inside the same loop nest, perhaps thinking this will be more efficient than having two sets of loops. &nbsp;Suppose we compile the code with:</p>

                     <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar" style="margin: 0rem 0rem !important; padding-bottom: 1rem;">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important; padding-left: 0rem !important;" class="d-flex mv_pre">
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">ifx  -c &nbsp;-xAVX2 &nbsp;-qopt-report=3  paper2. f90 &nbsp;-qopt-report-phase=loop</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p class="mt-3">The optimization report will contain an advice remark:</p>

                    <!-- code toolbar 3 -->
                    <div class="mv_code_toolbar" style="margin: 0rem 0rem !important; padding-bottom: 1rem;">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important; padding-left: 0rem !important;" class="d-flex mv_pre">
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">LOOP BEGIN at paper2.f90 &nbsp;(6, 7) <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  remark #25445: Loop interchange not done due to: non-perfect loopnest<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  remark #25451: Advice: Loop interchange, if possible, might help loopnest. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Suggested Permutation: ( 1 2 3 ) --> ( 3 2 1 )</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>This explains that the outermost and innermost induction variables could be interchanged to produce better locality.&nbsp; However, the control flow inside the loop due to the IF statement prevents the compiler from doing this.&nbsp; After a little thought, the programmer can rewrite this code, as shown in Figure 3.&nbsp;</p>
                    <!-- code toolbar 3 -->
                    <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">subroutine</span>&nbsp;compute ( a , b , c , d , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  a ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  b ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  c ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">real<span class="dk_code_org"> * </span>8</span> &nbsp;  d ( n , n )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">do</span> &nbsp;  k <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">do</span> &nbsp;  j <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="dk_code_blue">if</span>  ( j <span class="dk_code_org">. lt .</span> k ) d (k , j ) <span class="dk_code_org">=</span> d ( j , k )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">enddo</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> <span class="dk_code_blue">enddo</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">do</span> &nbsp;  k <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    12
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">do</span> &nbsp;  j <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    13
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">do</span> &nbsp;  i <span class="dk_code_org">=</span> <span class="dk_code_blue">1</span> , n</p>

                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    14
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c ( j , i ) <span class="dk_code_org">=</span> c ( j , i ) <span class="dk_code_org">+</span> a ( i , k ) <span class="dk_code_org">*</span> b ( k , j )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    15
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">enddo</span>  </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    16
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">enddo</span>  </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    17
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> <span class="dk_code_blue">enddo</span>  </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    18
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> <span class="dk_code_blue">end &nbsp;subroutine</span>  </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p><strong>Figure 3:</strong> Nested Loop Resolved, Making Optimization Easier</p>
                    <p>Compiling this version of the code in the same manner shows that the compiler can now perform the loop interchange optimization on the second loop.</p>

                    <!-- code toolbar 3 -->
                    <div class="mv_code_toolbar" style="margin: 0rem 0rem !important; padding-bottom: 1rem;">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important; padding-left: 0rem !important;" class="d-flex mv_pre">
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">LOOP BEGIN &nbsp;at&nbsp; paper2a.f90 &nbsp;( 12 , 10 ) <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  remark #25444: Loop nest interchanged: ( 1 2 3 ) --> ( 3 2 1 )</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p>The optimizer can also point out when a group of memory references has poor spatial locality; that is, each subsequent reference is far away from the previous one.&nbsp; It can tell you when memory references aren’t known to be distinct or may involve phantom data dependencies that you can fix with annotations in your source code.&nbsp; When a loop nest is optimized to operate on blocks of memory to improve locality, remarks in the optimization report will indicate how to best tune the blocking factors.&nbsp; Finally, when the optimizer chooses to perform the unroll-and-jam optimization, it emits remarks into the report explaining how you can either suppress the optimization or tune it for better performance.</p>

                    <p>Writing optimal loop nests can be quite difficult, so look out for these advisory remarks and consider whether you can make suggested changes to improve your code’s performance. The optimizer may not have enough information to make these changes safely, so providing these remarks is the next best thing.</p>
                    </section>


                    <section id="dk_improvement_vectori">
                        <h4>Improvements to Vectorization Reports</h3>
                            <p>The OpenMP standard allows the creation of vectorized functions by specifying <span style="background-color: #e6e6e6;">#pragma omp declare simd</span> ahead of the function implementation.&nbsp; The oneAPI compiler optimization report now includes a section describing the function vectorization.&nbsp; This looks very much like the report you will see for loop vectorization but wrapped in a FUNCTION block instead of a LOOP block.&nbsp; It is possible to create more than one vectorized version of a function (for instance, using 256-bit vectors versus 512-bit vectors), and there is a separate report section for each such version.</p>
                            <p>The vectorizer now provides more information about memory references in vectorized code.&nbsp; At the highest verbosity level, the optimization report will include a remark for each vectorized reference, describing whether the reference is aligned on a vector boundary and/or masked and providing source location information (<span style="background-color: #e6e6e6;">line:column</span>) for the reference.&nbsp; When the <span style="background-color: #e6e6e6;">-g</span> option is selected, the vectorizer will also include limited name information for the memory reference in question. &nbsp;&nbsp;</p>
                        <p>For example:</p>

                        <!-- code toolbar 3 -->
                    <div class="mv_code_toolbar" style="margin: 0rem 0rem !important; padding-bottom: 1rem;">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important; padding-left: 0rem !important;" class="d-flex mv_pre">
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">LOOP BEGIN &nbsp;at&nbsp; test.c ( 2 , 3 ) <br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15389 : &nbsp; vectorization support : &nbsp;unmasked unaligned unit stride load : &nbsp; A ( 4 : 12 ) <br> 
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15389 : &nbsp; vectorization support : &nbsp;unmasked unaligned unit stride load : &nbsp; A ( 3 : 19 ) <br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15388 : &nbsp; vectorization support : &nbsp;unmasked aligned unit stride store : &nbsp; B ( 3 : 10 )
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="mt-3">Here, the array names A and B appear only when <span style="background-color: #e6e6e6;">-g</span> is selected on the command line; otherwise, the available debug information is insufficient to produce array name information.&nbsp; Be sure to compile for debug if you want to see this information!</p>
                    <p>The vectorizer can also optimize groups of nearby memory references to use wide loads and shuffles instead of a gather load (and similarly for stores).&nbsp; The optimization report now includes remarks for this VLS (vector load/store) optimization.&nbsp; An example of this:</p>

                       <!-- code toolbar 3 -->
                       <div class="mv_code_toolbar" style="margin: 0rem 0rem !important; padding-bottom: 1rem;">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important; padding-left: 0rem !important;" class="d-flex mv_pre">
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">LOOP BEGIN &nbsp;at&nbsp; test.c ( 6 , 3 ) <br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15300: LOOP WAS VECTORIZED <br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15305: vectorization support: vector length 4<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15597: -- VLS-optimized vector load replaces 3 independent loads of stride 3<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15598 :&nbsp; load #1 &nbsp; from :&nbsp; arr1 [&nbsp; test1.c &nbsp; (9, 11)&nbsp;]<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15598 :&nbsp; load #2 &nbsp; from :&nbsp; arr1 [&nbsp; test1.c &nbsp; (7, 10)&nbsp;]<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15598 :&nbsp; load #3 &nbsp; from :&nbsp; arr1 [&nbsp; test1.c &nbsp; (8, 11)&nbsp;]<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remark #15600 :&nbsp; -- end VLS-optimized group<br>
                                            LOOP END
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>A few other minor remarks have been added, and previously noted problems with ordering vectorized loops in the report have been corrected.&nbsp; Finally, the remark numbers for the vectorization report have been corrected to always match those from the Intel Compilers Classic where a match exists to ease porting of tools that relied on the existing remark numbers.</p>
                    </section>

                    
                    <section id="dk_improvement_openmp_reports">
                        <h4>Improvements to OpenMP Reports</h4>
                        <p>The compiler now produces two separate optimization reports for OpenMP when an offload target is specified.&nbsp; The host optimization report is named <span style="background-color: #e6e6e6;">myfile.optrpt</span>, as usual.&nbsp; The device optimization report has a name derived from the selected target.&nbsp; For example, if <span style="background-color: #e6e6e6;">-fopenmp-targets=spir64</span> is specified, the name of the target report is <span style="background-color: #e6e6e6;">myfile-openmp-spir64.optrpt</span>.&nbsp; Furthermore, the contents of the target report include a banner emphasizing that the report is for offloaded device code.</p>
                        <p>The NAMED clause from OpenMP directives is now used wherever possible within the optimization report, providing source name information for clarity.&nbsp; This includes usage for map names and shared privatization.&nbsp; Map clauses implicitly generated by the compiler, rather than explicitly specified on an OpenMP directive, are identified as such.</p>
                        <p>Several new remarks have been added for both host-side and device-side optimization reports.&nbsp; These include remarks about transformations performed on loop constructs, remarks about loops running on the device, remarks identifying kernel local variables assigned to stack memory, and remarks about loop collapsing.&nbsp; The report has been divided into sections for clarity, similar to how the Intel Compilers Classic generated the reports.</p>
                    </section>

                    <section id="dk_improvements_code">
                        <h4>Improvements to Code Generation Reports</h4>
                        <p>The code generation section of the optimization report was empty before release 2025.0. Now, it includes a register allocation report that identifies registers used by the function, callee-save registers saved on the stack, and other information about function stack usage.</p>
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_looking_forward">
                        <h3 style="font-weight: 300;">Looking Forward</h3>
                        <p>The optimization reports produced by the Intel oneAPI compilers are intended to help our users understand how their code has been optimized and to stimulate ideas for rewriting code for better performance.&nbsp; With the release of 2025.0, we brought these reports up to the Intel Compilers Classic standards and improved them beyond those expectations.&nbsp; This is an ongoing project. We have many more improvements planned for future releases.</p>
                        <p>We would like to hear from those of you using the optimization reports.&nbsp; Ideas for additional improvements are most welcome! Let us know any extra compiler optimization guidance that could benefit your software development, by submitting your feedback in our community forums for the <a href="" style="color:#0563c1; text-decoration:underline !important">Intel® oneAPI DPC++/C++ Compiler</a> and <a href="" style="color:#0563c1; text-decoration:underline !important">Intel® Fortran Compiler</a>.</p>
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_download_compailers">
                        <h3 style="font-weight: 300;">Download the Compilers Now</h3>
                        <p>You can download the&nbsp;<a href="" style="color:#0563c1; text-decoration:underline !important">Intel oneAPI DPC++/C++ Compiler</a>&nbsp;and the <a href="" style="color:#0563c1; text-decoration:underline !important">Intel® Fortran Compiler</a> on Intel’s&nbsp;<a href="" style="color:#0563c1; text-decoration:underline !important">oneAPI Developer Tools product page</a>.&nbsp;</p>
                        <p>This version is also in&nbsp;the <a href="" style="color:#0563c1; text-decoration:underline !important">Intel® Toolkits</a>, which include an advanced set of foundational tools, libraries, analysis, debug and code migration tools.</p>
                        <p>You may also want to check out our contributions to the LLVM compiler project on&nbsp;<a href="" style="color:#0563c1; text-decoration:underline !important">GitHub</a>.</p>
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_additional_resou">
                        <h3 style="font-weight: 300;">Additional Resources</h3>
                        <ul>
                            <li><a class="b_special_a1" href="">oneAPI 2025.0 Release - Boost Developer Productity for AI and Open Accelerated Computing</a>&nbsp;&nbsp;</li>
                            <li><a class="b_special_a1" href="">DPC++/C++ Developer Guide and Reference</a>&nbsp;</li>
                            <li><a class="b_special_a1" href="">Fortran Developer Guide and Reference</a>&nbsp;</li>
                            <li>Hardware Profile-Guided Optimization
                            <ul style="list-style-type:circle">
                                <li><a href="" style="color:#0563c1; text-decoration:underline !important">Technical Article</a></li>
                                <li><a href="" style="color:#0563c1; text-decoration:underline !important">DPC++ Developer Guide and Reference</a>&nbsp;</li>
                            </ul>
                            </li>
                            <li><a href="" style="color:#0563c1; text-decoration:underline !important">oneAPI GPU Optimization Guide</a>&nbsp;</li>
                            <li><a href="" style="color:#0563c1; text-decoration:underline !important">Find Bugs Quickly Using Sanitizers with the Intel® oneAPI DPC++/C++ Compiler</a></li>
                            <li><a href="" style="color:#0563c1; text-decoration:underline !important">LLVM-based Projects from Intel</a></li>
                        </ul>
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_get_help">
                        <h3 style="font-weight: 300;">Get Help</h3>
                        <p class="mb-0">Your success is our success. Access this support resource when you need assistance.</p>
                        <ul>
                            <li><a href="" style="color:#0563c1; text-decoration:underline !important">Intel Fortran Compiler Forum</a></li>
                            <li><a href="" style="color:#0563c1; text-decoration:underline !important">Intel oneAPI DPC++/C++ Compiler Forum</a></li>
                            <li>For additional help, see our general&nbsp;<a href="" style="color:#0563c1; text-decoration:underline !important">oneAPI Support</a>.</li>
                        </ul>
                    </section>
                        
                    </section>
                </div>
            </div>
        </div>
    </section>


  
    

     <section style="border-top: 1px solid #d7d7d7;" class="container py-5">
        <h4 class="h6">Product and Performance Information</h4>
        <div class="disclaimer" style="font-size: 12px;"><sup>1</sup> Performance varies by use, configuration and other factors. Learn more at <a class="b_special_a1" href="">www.Intel.com/PerformanceIndex</a>.</div>
        </div>
    </section>

    <!-- footer -->
    <div id="footer"></div>

    <!-- script header and footer -->
    <script>
        // navbar include  
        fetch('/y_index/y_navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
        // footer include 
        fetch('/y_index/y_footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            });
    </script>

    <!-- nav script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
        if (document.getElementsByClassName('VK_all_sections section') && document.getElementsByClassName('VK_sidebar_dropdown')) {
            const sections = document.querySelectorAll('.VK_all_sections section');
            const navLinks = document.querySelectorAll('.VK_sidebar_dropdown a');
            const detailsElements = document.querySelectorAll('.VK_sidebar_dropdown details');

            function removeActiveClass() {
                navLinks.forEach(link => link.classList.remove('VK_sidebar_active_link'));
                detailsElements.forEach(details => {
                    details.removeAttribute('open');
                    details.setAttribute('close', ''); // Optional: to visually indicate it's closed
                });
            }

            function activateLinkAndDetails(targetId) {
                navLinks.forEach(link => {
                    if (link.getAttribute('href') === `#${targetId}`) {
                        link.classList.add('VK_sidebar_active_link');
                        let parentDetails = link.closest('details');

                        // Open all ancestor details elements
                        while (parentDetails) {
                            parentDetails.setAttribute('open', '');
                            parentDetails.removeAttribute('close'); // Optional: remove the closed indicator
                            parentDetails = parentDetails.parentElement.closest('details');
                        }
                    }
                });
            }

            function onScroll() {
                let currentSection = '';
                sections.forEach(section => {
                    const sectionTop = section.getBoundingClientRect().top;
                    const sectionBottom = section.getBoundingClientRect().bottom;

                    // Check if the section is in view
                    if (sectionTop <= 100 && sectionBottom >= 0) {
                        currentSection = section.getAttribute('id');
                    }
                });

                if (currentSection) {
                    removeActiveClass();
                    activateLinkAndDetails(currentSection);
                } else {
                    removeActiveClass();
                }
            }

            window.addEventListener('scroll', onScroll);
        } else {
            return
        }
    });
    </script>

    <!-- copy script -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".mv_copy_icon").forEach((icon) => {
                icon.addEventListener("click", async function () {
                    try {
                        const toolbar = this.closest(".mv_code_toolbar");
                        const codeBlock = toolbar.querySelector(".code-content");
                        const codeContent = codeBlock.innerText;
    
                        // Use Clipboard API to copy text
                        await navigator.clipboard.writeText(codeContent);
    
                        // Hide the copy icon and show the "Copied!" message
                        const message = toolbar.querySelector(".mv_copy_message");
                        this.classList.add("hidden"); // Hide the copy icon
                        message.classList.remove("hidden"); // Show the "Copied!" message
    
                        // Hide the message and show the icon again after 2 seconds
                        setTimeout(() => {
                            message.classList.add("hidden");
                            this.classList.remove("hidden");
                        }, 2000); // Adjust delay as needed
    
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                    }
                });
            });
        });
    </script>

</body>

</html>