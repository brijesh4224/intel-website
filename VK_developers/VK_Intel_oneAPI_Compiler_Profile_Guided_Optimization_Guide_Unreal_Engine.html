<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- font family -->
    <link href="https://fonts.cdnfonts.com/css/intel-clear" rel="stylesheet">
    <!-- boootstap file -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- costom css file -->
    <link rel="stylesheet" href="/css/vivek.css">
    <link rel="stylesheet" href="/css/yatri.css">

    <!-- all.min file -->
    <link rel="stylesheet" href="/css/all.min.css">


</head>

<body>

    <main>
        <!-- header -->
        <header>
            <div id="navbar"></div>
        </header>

        <!-- poster -->
        <section class=" VK_light_blue">
            <div class="VK_cont">
                <div class="row m-0">
                    <div class="col text-white">
                        <h1 class="VK_py_pre_heading fw-light m-0 pt-3 pb-4">
                            Intel® oneAPI DPC++/C++ Compiler and Profile Guided Optimization Usage Guide for Unreal
                            Engine* 5
                        </h1>
                    </div>
                </div>
            </div>
        </section>


        <section class="">
            <div class="VK_cont py-5 VK_border_bottom">
                <div class="row m-0">
                    <div class="col-md-4 col-lg-3 d-md-block d-none">
                        <div class="VK_sticky_side_bar VK_side_bar_postion_stickey bg-white">
                            <div>
                                <div>
                                    <div class="VK_sidebar_dropdown">
                                        <p class="mb-2">
                                            <a href="#VK_Introduction" class="text-decoration-none VK_a">
                                                Introduction
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Enable_Itel_oneAPI_Compiler" class="text-decoration-none VK_a">
                                                Enable Intel oneAPI DPC++/C++ Compiler
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Hardware_Sample_Based_PGO" class="text-decoration-none VK_a">
                                                Hardware (Sample-Based) PGO
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Build_ProfileEnabled_Configuration"
                                                class="text-decoration-none VK_a">
                                                Build Profile-Enabled Configuration
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Capture_Representative_Profile"
                                                class="text-decoration-none VK_a">
                                                Capture Representative Profile
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Process_Merge_Profile" class="text-decoration-none VK_a">
                                                Process and Merge Profile(s)
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Build_ProfileOptimized_Configuration"
                                                class="text-decoration-none VK_a">
                                                Build Profile-Optimized Configuration
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Instrumented_PGO" class="text-decoration-none VK_a">
                                                Instrumented PGO
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Build_Profile-Enabled_Configuration"
                                                class="text-decoration-none VK_a">
                                                Build Profile-Enabled Configuration
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_CaptureRepresentative_Profile"
                                                class="text-decoration-none VK_a">
                                                Capture Representative Profile
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Merge_Profiles" class="text-decoration-none VK_a">
                                                Merge Profiles
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Parting_Segue_Future_Beyond" class="text-decoration-none VK_a">
                                                Build Profile-Optimized Configuration
                                            </a>
                                        </p>
                                        <p class="mb-2">
                                            <a href="#VK_Parting_Segue_Future_Beyond" class="text-decoration-none VK_a">
                                                Closing Thoughts
                                            </a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="VK_theme_bg py-2 px-3 mt-4">
                            <p>
                                <b>
                                    Authors:
                                </b>
                            </p>
                            <ul class="m-0">
                                <li>
                                    Jeff Rous
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-8 ps-sm-5">
                        <div class="">
                            <div class="VK_section_descriptions">
                                <div class="text-end">
                                    <p class="m-0 VK_print_email_font">
                                        <span class="VK_a mx-2 d-inline-block">
                                            <i class="fa-solid fa-print"></i>
                                        </span>
                                        <span class="VK_a mx-2 d-inline-block">
                                            <i class="fa-regular fa-envelope"></i>
                                        </span>
                                    </p>
                                </div>
                                <div class="VK_all_sections">
                                    <section class="mt-5" id="VK_Introduction">
                                        <h3 class="VK_side_heading fw-light">
                                            Introduction
                                        </h3>
                                        <p>
                                            New enhancements to the profile guided optimization (PGO) feature set are
                                            now
                                            available with the release of the Intel® oneAPI DPC++/C++ Compiler version
                                            2024.0 (ICX), based on LLVM 17 compiler technology. Previously, only
                                            instrumented PGO was available which required a specially compiled binary.
                                            This
                                            required it capture its own profile traces to later feed into the linker,
                                            resulting in high overhead and low frame rates on games. With the ICX 2024.0
                                            release, PGO is enhanced with hardware assistance. Now developers can
                                            leverage
                                            the processor’s dedicated performance monitoring unit and significantly
                                            reduce
                                            the collection overhead of these profile traces.
                                        </p>
                                        <p>
                                            Beginning with Unreal Engine* version 5.4, support for the Intel ICX
                                            compiler,
                                            PGO, and HWPGO features are available to Unreal Engine developers on
                                            Windows*.
                                            This guide outlines how to use the features and how to maximize their
                                            performance.
                                        </p>
                                    </section>
                                    <section class="mt-5" id="VK_Enable_Itel_oneAPI_Compiler">
                                        <h3 class="VK_side_heading fw-light">
                                            Enable Intel oneAPI DPC++/C++ Compiler
                                        </h3>
                                        <p>
                                            The Intel oneAPI DPC++/C++ Compiler (ICX) is free to use and can be
                                            downloaded from this
                                            <a href="" class="Vk_text_underline_dots VK_a">
                                                link.
                                            </a>
                                        </p>
                                        <p>
                                            Once the ICX compiler is installed, open Unreal Engine 5's
                                            <span class="VK_theme_bg d-inline-block">BuildConfiguration.xml</span> file
                                            and set Intel as the compiler of choice. The
                                            Clang linker option must be set whenever link time optimizations or PGO are
                                            used, or it can be disabled to instead use the Microsoft Visual Studio*
                                            (MSVC) linker.
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="text-end">
                                                    <button
                                                        class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                                <code class="VK_theme_color">
<pre><p class="m-0">&lt;?xml version="1.0" encoding="utf-8" ?>
&lt;Configuration xmlns="https://www.unrealengine.com/BuildConfiguration">
    &lt;WindowsPlatform>
        &lt;Compiler>Intel&lt;/Compiler>
        &lt;bAllowClangLinker>true&lt;/bAllowClangLinker>
    &lt;/WindowsPlatform>
&lt;/Configuration></p></pre>
                                                </code>
                                            </div>
                                        </div>
                                    </section>
                                    <section class="mt-5" id="VK_Hardware_Sample_Based_PGO">
                                        <h3 class="VK_side_heading fw-light">
                                            Hardware (Sample-Based) PGO
                                        </h3>
                                        <p>
                                            Hardware (sample-based) PGO relies on programmable counters built into the
                                            performance monitoring unit of newer CPUs to capture performance data. With
                                            this hardware assistance, this results in very low overhead compared to
                                            instrumented PGO. To enjoy this advantage, a few steps need to be completed
                                            to reach an optimized build – building with profiling enabled, capturing a
                                            representative profile, processing and merging the profiles, and finally
                                            applying the profiles for an optimized build.
                                        </p>
                                    </section>
                                    <section class="mt-5" id="VK_Build_ProfileEnabled_Configuration">
                                        <h3 class="VK_side_heading fw-light">
                                            Build Profile-Enabled Configuration
                                        </h3>
                                        <p>
                                            In addition to setting Intel as the compiler of choice and enabling the
                                            Clang linker in Unreal Engine 5's BuildConfiguration.xml file as described
                                            above, the sample-based PGO option must also be enabled:
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="text-end">
                                                    <button
                                                        class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                                <code class="VK_theme_color">
<pre class="m-0"><p class="m-0">&lt;?xml version="1.0" encoding="utf-8" ?>
&lt;Configuration xmlns="https://www.unrealengine.com/BuildConfiguration">
    &lt;WindowsPlatform>
        &lt;Compiler>Intel&lt;/Compiler>
        &lt;bAllowClangLinker>true&lt;/bAllowClangLinker>
        &lt;bSampleBasedPGO>true&lt;/bSampleBasedPGO>
    &lt;/WindowsPlatform>
&lt;/Configuration></p></pre>
                                                </code>
                                            </div>
                                        </div>
                                        <p class="mt-4">
                                            Additionally, the project's <span
                                                class="d-inline-block VK_bg_e6">Target.cs</span> file must have the
                                            following variables
                                            set to enable link time optimization and a PGO profile build:
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="text-end">
                                                    <button
                                                        class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                                <code class="VK_theme_color">
<pre class="m-0"><p class="m-0">bAllowLTCG = true;
bPGOProfile = true;
bPGOOptimize = false;</p></pre>
                                                </code>
                                            </div>
                                        </div>
                                    </section>
                                    <section class="mt-5" id="VK_Capture_Representative_Profile">
                                        <h3 class="VK_side_heading fw-light">
                                            Capture Representative Profile
                                        </h3>
                                        <p>
                                            Capturing a representative profile relies on Sampling Enabling Product
                                            (SEP), which is a standalone command-line tool that performs hardware
                                            event-based sampling. SEP is installed by default with Intel® VTune™. Intel
                                            VTune is free to use and can be downloaded from this
                                            <a href="" class="Vk_text_underline_dots VK_a">
                                                link.
                                            </a>
                                        </p>
                                        <p>
                                            To capture a profile, run the profile-enabled binary on a system with an
                                            Intel CPU using the following script. The script captures branch records as
                                            the game runs to determine the hot path of execution. The capture time
                                            (taken in seconds) can be adjusted by the -d option. The frequency of
                                            samples can be adjusted with the SA= option (smaller is more frequent).
                                            Common values for the SA= option include 1000003, 400009, 200017, 100003 and
                                            10007. Longer samples can be taken with higher values of the SA= option. A
                                            good middle ground capture of 4 minutes with a fast sample rate on the
                                            CitySample Unreal Engine 5 example workload can be found below:
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3 overflow-hidden">
                                                <div class="overflow-auto">
                                                    <div class="text-end">
                                                        <button
                                                            class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                            <i class="fa-regular fa-copy"></i>
                                                        </button>
                                                    </div>
                                                    <code class="VK_theme_color">
<pre><p class="m-0">sep -start -d 240 -out app.tb7 -ec 
BR_INST_RETIRED.NEAR_TAKEN:PRECISE=YES:SA=100003:pdir:lbr:USR=YES,BR_MISP_RETIRED.ALL_BRANCHES:PRECISE=YES:SA=100003:lbr:USR=YES 
-lbr no_filter:usr -perf-script event,ip,brstack -app .\CitySample-Win64-Test.exe</p></pre>
                                                </code>
                                                </div>
                                            </div>
                                        </div>
                                        <ul>
                                            <li>
                                                Play the game for a representative sample of gameplay until the time
                                                expires and the game exits automatically.
                                            </li>
                                            <li>
                                                A TB7 capture file and a performance data script are generated upon game
                                                exit. These files are used for the next steps.
                                            </li>
                                            <li>
                                                Capture multiple profiles as needed to cover representative gameplay.
                                            </li>
                                        </ul>
                                    </section>
                                    <section class="mt-5" id="VK_Process_Merge_Profile">
                                        <h3 class="VK_side_heading fw-light">
                                            Process and Merge Profile(s)
                                        </h3>
                                        <p>
                                            The generated TB7 file and perf data script from the previous step need to
                                            be processed and then merged with previous profdata file(s) to become a
                                            final profdata file which the linker can apply for the profile-optimized
                                            build. This step uses
                                            <span class="d-inline-block VK_bg_e6">llvm-profgen.exe</span> and
                                            <span class="d-inline-block VK_bg_e6">llvm-profdata.exe</span> which are
                                            included in the install directory of the Intel® oneAPI DPC++/C++ compiler.
                                            These tools are different from the similarly named ones installed with
                                            Clang/LLVM and are not interoperable. The --sample-period option should
                                            match the SA= option above to correctly process the profile.
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="">
                                                    <div class="text-end">
                                                        <button
                                                            class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                            <i class="fa-regular fa-copy"></i>
                                                        </button>
                                                    </div>
                                                    <code class="VK_theme_color text-break">
<pre class="VK_normal_white m-0"><p class="m-0 text-break">llvm-profgen.exe --perfscript app.perf.data.script --binary CitySample-Win64-Test.exe --output app.freq.prof --sample-period 100003 --perf-event BR_INST_RETIRED.NEAR_TAKEN:pdir</p></pre>
                                                </code>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="my-4">
                                            The app.freq.prof file and previous profdata file(s) now need to be merged
                                            into a final profdata file which the linker can use to optimize the
                                            profile-optimized build. Multiple files from multiple different systems can
                                            be merged in this step to produce the final output file.
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="">
                                                    <div class="text-end">
                                                        <button
                                                            class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                            <i class="fa-regular fa-copy"></i>
                                                        </button>
                                                    </div>
                                                    <code class="VK_theme_color text-break">
<pre class="VK_normal_white m-0"><p class="m-0 text-break">llvm-profdata.exe merge app.freq.prof --sample -output CitySample-Win64-Test.profdata</p></pre>
                                                </code>
                                                </div>
                                            </div>
                                        </div>
                                        <ul class="mt-4">
                                            <li>
                                                The profdata file should be named
                                                <span
                                                    class="d-inline-block VK_bg_e6">Project-Platform-Configuration.profdata,</span>
                                                ex:
                                                <span
                                                    class="d-inline-block VK_bg_e6">CitySample-Win64-Test.profdata</span>
                                                for a CitySample Test build on Windows*.
                                            </li>
                                            <li>
                                                The profdata file should be placed in
                                                <span
                                                    class="VK_bg_e6 d-inline-block">ProjectDir\Platforms\Windows\Build\PGO\</span>
                                                so the build tool can find the
                                                profile during the link step.
                                            </li>
                                        </ul>
                                    </section>
                                    <section class="mt-5" id="VK_Build_ProfileOptimized_Configuration">
                                        <p>
                                            The last step to complete for an optimized build is applying the profiles.
                                            In the project's <span class="d-inline-block VK_bg_e6">Target.cs</span>
                                            file, set the following variables to enable link
                                            time optimization and a PGO optimized build. Be sure the build configuration
                                            (Development, Test, Shipping) matches the configuration of the profdata
                                            generated in the last steps:
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="">
                                                    <div class="text-end">
                                                        <button
                                                            class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                            <i class="fa-regular fa-copy"></i>
                                                        </button>
                                                    </div>
                                                    <code class="VK_theme_color text-break">
<pre class="m-0"><p class="m-0 text-break">bAllowLTCG = true;
bPGOProfile = false;
bPGOOptimize = true;</p></pre>
                                                </code>
                                                </div>
                                            </div>
                                        </div>
                                        <ul class="mt-3">
                                            <li>
                                                Rebuild
                                            </li>
                                            <li>
                                                Binary is now optimized by hardware PGO!
                                            </li>
                                            <li>
                                                Repeat previous steps as needed with different combinations of capture
                                                times and sample rates to generate a profile that, when applied, gives
                                                the best performance uplift.
                                            </li>
                                        </ul>
                                    </section>
                                    <section class="mt-5" id="VK_Instrumented_PGO">
                                        <h3 class="VK_side_heading fw-light">
                                            Instrumented PGO
                                        </h3>
                                        <p>
                                            Instrumented PGO relies on the compiled binary to capture its own
                                            performance data and generate a profile later used for optimization by the
                                            linker. No hardware assistance is used, so it has higher relative
                                        </p>
                                        <p>
                                            overhead compared to hardware PGO. Like hardware PGO, a few steps need to be
                                            completed to reach an optimized build – building with profiling enabled,
                                            capturing a representative profile, merging the profiles, and finally
                                            applying the profiles for an optimized build.
                                        </p>
                                    </section>
                                    <section class="mt-5" id="VK_Build_Profile-Enabled_Configuration">
                                        <h3 class="VK_side_heading fw-light">
                                            Build Profile-Enabled Configuration
                                        </h3>
                                        <p>
                                            To carry out instrumented PGO, Unreal Engine 5's
                                            <span class="VK_bg_e6 d-inline-block">BuildConfiguration.xml</span>
                                            file
                                            must have Intel set as the compiler of choice and the Clang linker enabled
                                            as described previously. The Clang linker is required when enabling
                                            link-time code generation (LTCG) or PGO options. Note that Sample-Based PGO
                                            is disabled in this configuration:
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="text-end">
                                                    <button
                                                        class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                                <code class="VK_theme_color">
<pre><p class="m-0">&lt;?xml version="1.0" encoding="utf-8" ?>
&lt;Configuration xmlns="https://www.unrealengine.com/BuildConfiguration">
    &lt;WindowsPlatform>
        &lt;Compiler>Intel&lt;/Compiler>
        &lt;bAllowClangLinker>true&lt;/bAllowClangLinker>
        &lt;bSampleBasedPGO>false&lt;/bSampleBasedPGO>
    &lt;/WindowsPlatform>
&lt;/Configuration></p></pre>
                                                </code>
                                            </div>
                                        </div>
                                        <p class="mt-3">
                                            In project's <span class="d-inline-block VK_bg_e6">Target.cs</span> file,
                                            set the following variables to enable link time optimization and a PGO
                                            profile build.
                                        </p>
                                        <div>
                                            <div class="VK_theme_bg border p-3 rounded-3">
                                                <div class="text-end">
                                                    <button
                                                        class="m-0 text-primary border-0 bg-transparent VK_copy_btn">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                                <code class="VK_theme_color">
<pre><p class="m-0">bAllowLTCG = true;
bPGOProfile = true;
bPGOOptimize = false;</p></pre>
                                                </code>
                                            </div>
                                        </div>
                                    </section>
                                    <section class="mt-5" id="VK_CaptureRepresentative_Profile">
                                        <p class="m-0">
                                            Once the profile-enabled build has completed, a representative profile needs
                                            to be gathered by running the game.
                                        </p>
                                        <ul>
                                            <li>
                                                Run the profile-enabled binary
                                            </li>
                                            <li>
                                                Play the game for a representative sample of gameplay
                                            </li>
                                            <li>
                                                Exit game
                                            </li>
                                            <li>
                                                Profraw file is generated upon game exit. This file is used for the next
                                                steps.
                                            </li>
                                        </ul>
                                    </section>
                                    <section class="mt-5" id="VK_Merge_Profiles"></section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>




        <!-- footer -->
        <footer>
            <div id="footer"></div>
        </footer>

    </main>


    <!---------------- Javascript Files ---------------->

    <!-- <script>
        // navbar include
        fetch('/y_index/y_navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
        // footer include 
        fetch('/y_index/y_footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            });
    </script> -->

    <!-- jquery -->
    <script src="/js/jquery-3.7.1.js"></script>


    <!-- bootstrap js file -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- costom js file -->
    <script src="/js/vivek.js"></script>

    <!-- all min -->
    <script src="/js/all.min.js"></script>


</body>

</html>