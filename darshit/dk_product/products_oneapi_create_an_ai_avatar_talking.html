<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Avatar Chatbot with PyTorch and OPEA</title>

    <link rel="stylesheet" href="/css/dk_developer_edge_iot_&_5G_social_distancing_for_retail_settings.css">

    <!-- header footer -->
    <link rel="stylesheet" href='/css/yatri.css'>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
</head>

<style>
    .dk_oneapi_deco{
        color: #0068b5;
        font-weight: bold;
    }
    .dk_oneapi_deco:hover{
        text-decoration: underline;
    }
    @media (max-width: 767px){
    .dk_designed_oneapi{
        flex-wrap: wrap-reverse !important;
    }
    .dk_designed_oneapi img{
        margin-bottom: 2rem;
        }  
    .dk_types_of_information img{
        width: 100% !important;
    }     
    }
    .dk_overview_api{
        word-wrap: break-word;
        background-color: #e6e6e6;
        padding: 20px;
        border-left: 3px solid #fdb813;
    }
    .dk_overview_api p{
        font-weight: bold;
    }
    .dk_overview_api_sub{
        color: blue;
        text-decoration: underline !important;
        font-weight: 700;
    }
    .dk_overview_api_sub:hover{
        color: blue;
    }
    .dk_overview_api_sub2{
        color: blue;
        text-decoration: underline !important;
        font-weight: 400;
    }
    .dk_overview_api_sub2:hover{
        color: blue;
    }
</style>

<body>

    <!-- header -->
    <div id="navbar"></div>

    <!-- Social Distancing for Retail Settings -->
    <section>
        <div class="mv_intel_amx_bg_color">
            <div class="container">
                <div class="row mv_intel_amx_content">
                    <div class="col-md-12 col-sm-12 mv_intel_amx_item">
                        <div class="mv_intel_amx">
                            <h2 style="font-weight: 300; font-size: 1.75rem;">Create an AI Avatar Talking Bot with PyTorch* and Open Platform for Enterprise AI (OPEA)</h2>
                            <p>Build and deploy on Intel® Xeon® Scalable Processors and Intel® Gaudi® Al Accelerators</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container py-5">
        <div class="row">
            <div class="d-flex justify-content-end col-xl-10 py-3 d-md-none">
                <i class="fa-solid fa-print fs-4 px-2 " style="color:#0068B5"></i>
                <i class="fa-regular fa-envelope fs-4 px-2" style="color:#0068B5"></i>
            </div>
            <div class="col-lg-3 col-md-4">
                <!-- nav -->
                <div class="VK_sticky_side_bar VK_side_bar_postion_stickey">
                    <div>
                        <div class="VK_sidebar_dropdown">
                            <details>
                                <summary>
                                    <a href="#dk_overview_ai_avtar" class="text-decoration-none VK_a">
                                        Overview
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_open_platform" class="text-decoration-none VK_a my-1">
                                            Open Platform for Enterprise AI (OPEA)
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <details>
                                <summary>
                                    <a href="#dk_how_to_build" class="text-decoration-none VK_a">
                                        How to build an AI Avatar Chatbot under the OPEA framework?
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_flow_chart" class="text-decoration-none VK_a my-1">
                                            I. Flow Chart
                                            <ol>
                                                <li><a href="#dk_build_animation">Build a new Microservice “Animation” in GenAIComps Repo</a></li>
                                                <li><a href="#dk_build_avatar">Build a new Megaservice “AvatarChatbot” in GenAIExamples</a></li>
                                                <li><a href="#dk_define_gateway">Define Gateway for our megaservice</a></li>
                                            </ol>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#dk_lip_synchronization" class="text-decoration-none VK_a my-1">
                                            II. Lip Synchronization and Face Animation Models
                                            <ol>
                                                <li><a href="#dk_wav2lip">Wav2Lip + GFPGAN</a></li>
                                                <li><a href="#dk_sadtalker">SadTalker</a></li>
                                            </ol>
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <p class="m-0">
                                <a href="#dk_how_deploy_intel" class="text-decoration-none VK_a">
                                    How to deploy on Intel® Xeon® scalable processors and Intel® Gaudi® AI Accelerators
                                </a>
                            </p>
                            <details>
                                <summary>
                                    <a href="#dk_deep_learning" class="text-decoration-none VK_a">
                                        Deep Learning Optimizations
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_mode_of_operation" class="text-decoration-none VK_a my-1">
                                            Mode of Operation: Eager mode vs. Lazy mode
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_run_inference" class="text-decoration-none VK_a my-1">
                                            Run Inference Using BF16 & FP8 with PyTorch Autocast and Intel® Neural Compressor
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <details>
                                <summary>
                                    <a href="#dk_feature_improve" class="text-decoration-none VK_a">
                                        Feature Improvements
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_text_to_speech" class="text-decoration-none VK_a my-1">
                                            Text-to-Speech (TTS) Service
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_animation_service" class="text-decoration-none VK_a my-1">
                                            Animation Service
                                        </a>
                                    </li>
                                </ul>
                            </details>
                            <p class="m-0">
                                <a href="#dk_instructions_run" class="text-decoration-none VK_a">
                                    Instructions to Run the AI Avatar Chatbot – Try on your own!
                                </a>
                            </p>
                            <details>
                                <summary>
                                    <a href="#dk_future_work" class="text-decoration-none VK_a">
                                        Future Work
                                    </a>
                                </summary>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_real_time" class="text-decoration-none VK_a my-1">
                                            Real-time streaming of LLM and TTS outputs and animated frames
                                        </a>
                                    </li>
                                </ul>
                                <ul class="list-unstyled ps-3 mb-0">
                                    <li>
                                        <a href="#dk_useful_res" class="text-decoration-none VK_a my-1">
                                            Useful Resources
                                            <ul style="list-style-type: none;">
                                                <li><a href="#references">References</a></li>
                                            </ul>
                                        </a>
                                    </li>
                                </ul>
                               
                            </details>
                        </div>
                    </div>
                </div>
                <!-- thinkcode -->
                <div class="dk_things_code_main">
                    <div class="dk_things_code">
                        <h2 class="text-left headline-font-one-bold mb-4">Stay in the Know on All Things CODE</h2>
                        <a class="dk_button" href="">Sign Up</a>
                        <p class="mb-0">&nbsp;</p>
                    </div> 
                </div>
                <p><i>Chun Tao, AI Software Solutions Engineer Intern, Intel | <a class="b_special_a2" href="">LinkedIn<br>
                </a>Alex Sin, AI Software Solutions Engineer, Intel | <a class="b_special_a2" href="">LinkedIn</a> <br>
               Louie Tsai, AI Software Solutions Engineer, Intel | <a class="b_special_a2" href="">LinkedIn<br>
                </a>Ramya Ravi, AI Software Marketing Engineer, Intel | <a class="b_special_a2" href="">LinkedIn<br>
                </a></i></p>
            </div>
            <div class="col-lg-9 col-md-8">
                <div class="d-md-flex justify-content-between col-xl-10 py-3 d-none">
                    <div class="">
                        <p>10/28/2024</p>
                    </div>
                    <div class="">
                        <i class="fa-solid fa-print fs-4 px-2 " style="color:#0068B5"></i>
                        <i class="fa-regular fa-envelope fs-4 px-2" style="color:#0068B5"></i>
                    </div>
                </div>
                <div class="col-xl-10 VK_all_sections">
                    <section id="dk_random_number">
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">&nbsp;</p>
                    </section>

                    <section id="dk_overview_ai_avtar">
                        <h3 style="font-weight: 300;">Overview</h3>
                        <p style="text-align:justify">AI Avatar chatbots are reshaping the business of various industries in today’s AI world. From reception desks of financial and educational institutions to public facilities such as airports and hospitals, ubiquitous digital human AIs assist in answering customer queries and providing personalized guidance.</p>
                        <p style="text-align:justify">To meet this need from enterprises of digital human AIs, we developed an “<a class="b_special_a1" href="">AI Avatar Audio Chatbot</a>”. This article introduces how to leverage <a class="b_special_a1" href="">Open Platform for Enterprise AI (OPEA)</a>, an open, multi-provider, and robust framework of composable building blocks for state-of-the-art (SOTA) Generative AI (GenAI) systems to create an AI Avatar Chatbot on <a class="b_special_a1" href="">Intel® Xeon® Scalable Processors</a> and <a class="b_special_a1" href="">Intel® Gaudi® Al Accelerators</a>. It also highlights how Intel-optimized software such as <a class="b_special_a1" href="">Intel® Gaudi® Software Suite</a> and <a class="b_special_a1" href="">PyTorch*</a> can help accelerate the training and inference performance of these AI solutions. accelerate the training and inference performance of these AI solutions.</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/ai-generated-images.png" alt="">
                        </div>
                        <p class="mb-4"><strong>Figure 1. Sample images generated from Stable Diffusion 3 Medium [13]</strong></p>
                    </section>

                    <section id="dk_open_platform">
                        <h4>Open Platform for Enterprise AI (OPEA)</h4>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/opea-stacked-logo-rwd.png" alt="">
                        </div>
                        <p class="mb-0">The OPEA platform includes:</p>
                        <ul>
                            <li>A framework of microservice building blocks for SOTA GenAI systems including LLM, data stores, and prompt engines</li>
                            <li>Architectural blueprints of Retrieval-Augmented Generation (RAG) GenAI component stack structure</li>
                            <li>Micro and Megaservices to get GenAI solutions into production and deployment</li>
                            <li>A four-step assessment for grading GenAI systems around performance, features, trustworthiness, and enterprise-grade readiness</li>
                        </ul>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/newsroom-rag-flow.jpg" alt="">
                        </div>
                        <p><strong>Figure 2. Retrieval Augmented Generation (RAG) enhanced GenAI Ref Solution on OPEA [14]</strong></p>
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">For any OPEA Enterprise AI solution, there are three major components:</p>
                        <ol>
                            <li>Microservices: Provides flexible and scalable solutions.<br>
                            The <a class="b_special_a1" href="">GenAIComps repo</a> hosts all the available microservices. Each microservice is designed to perform a specific function or task within the application architecture.<br>
                            &nbsp;</li>
                            <li>Megaservices: Provides comprehensive solutions.<br>
                            The <a class="b_special_a1" href="">GenAIExamples repo</a> hosts a collection of use case-based applications. Unlike individual microservices that focus on specific tasks, a megaservice orchestrates multiple microservices to deliver a comprehensive solution<br>
                            &nbsp;</li>
                            <li><strong>Gateways:</strong> Provides communication.<br>
                            The Gateway serves as the interface for users to access a megaservice and its underlying microservices. Gateways support API definition, versioning, rate limiting, request transformation, and data retrieval from microservices.</li>
                        </ol>
                        <p>Additionally, for most AI solutions, there is a corresponding UI that allows the user to interact with OPEA megaservices in a more direct, interactive, and visualized manner.</p>
                    </section>

                    <p class="">&nbsp;</p>

                    <section id="dk_how_to_build">
                     <h3 style="font-weight: 300">How to build an AI Avatar Chatbot under the OPEA framework?</h3>
                    </section>
                     <p class="mb-0">&nbsp;</p>

                     <section id="dk_flow_chart"> 
                        <h4>I. Flow Chart</h4>
                        <p style="text-align:justify">The flow of the entire application is shown in the graph. The code sample is the “Avatar Chatbot” example [15] in the OPEA GenAIExamples repository. In the flowchart diagram we highlight the “AvatarChatbot” megaservice, which is the core of the application. The megaservice orchestrates four different microservices “Automatic Speech Recognition (ASR)”, “Large Language Model (LLM)”, “Text-to-Speech (TTS)”, and “Animation”, connected in the form of a Directed Acyclic Graph (DAG).</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/flowchart.png" alt="">
                        </div>
                        <p><strong>Figure 3. Flowchart for the AvatarChatbot Example in OPEA [15]</strong></p>
                        <p class="mb-0">&nbsp;</p>
                        <p class="mb-0">Each microservice handles a particular functionality of the avatar chatbot. For example:</p>
                        <ul>
                            <li style="text-align:justify"><strong>Automatic Speech Recognition (ASR)</strong> is a voice recognition software that converts human speech to text.</li>
                            <li style="text-align:justify"><strong>Large Language Model (LLM)</strong> processes the transcribed text from ASR by understanding the user’s query and generates the appropriate text response.</li>
                            <li style="text-align:justify"><strong>Text-to-Speech (TTS)</strong> service converts the text response generated from the LLM into audio speech.</li>
                            <li style="text-align:justify"><strong>Animation</strong> service combines both the audio response from TTS and the user-defined AI avatar image/video and ensures that the avatar figure’s lip movements will match the synchronized speech. It then generates a video featuring the avatar speaking back to the user.</li>
                        </ul>
                        <p style="text-align:justify" class="mb-4">The user inputs include an audio query and an image/video visual input. The output is a face-animated avatar video. Users will be able to get close to real-time feedback from the avatar chatbot, including hearing the audible answer and watching the chatbot talk naturally.</p>
                     </section>
                     
                     <section id="dk_build_animation">
                        <h4><strong>1. Build a new Microservice “Animation” in GenAIComps Repo</strong></h4>
                        <p style="text-align:justify">To add a new microservice such as “Animation”, we would need to register that microservice under comps/animation:</p>

                            <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_green"># Register the microservice</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">@register_microservice</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name <span class="dk_code_org">=</span><span style="color: blue;">"opea_service@animation"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; service_type=ServiceType.ANIMATION,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endpoint <span class="dk_code_org">=</span><span style="color: blue;">"/v1/animation"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; host <span class="dk_code_org">=</span><span style="color: blue;">"0.0.0.0"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span><span class="dk_code_blue">9066</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_datatype<span class="dk_code_org">=</span>Base64ByteStrDoc,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_datatype<span class="dk_code_org">=</span>VideoPath,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span>}</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">@register_statistics(names<span class="dk_code_org">=</span>[ <span style="color: blue;">"opea_service@animation"</span> ])</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p style="text-align:justify">After the registration process, we define the callback function when this microservice is executed. In the case of “Animation,” we will use the “animate” function that takes a “Base64ByteStrDoc” object as its input audio and generates an “VideoPath” object that contains the path to the generated avatar video. Within “animation.py” we post an API request to the “wav2lip” FastAPI’s endpoint and collect the response, both in json format. Check out the code required in the <a class="b_special_a1" href="">link here</a>.</p>

                    <p><strong><em>Note:</em></strong><em> </em>Don’t forget to add “Base64ByteStrDoc” and “VideoPath” classes in comps/cores/proto/docarray.py and import it in comps/__init__.py!</p>

                    <p style="text-align:justify">The code for “wav2lip” server API is in the <a class="b_special_a1" href="">link here</a>. It’s a FastAPI that has its post function specified to process the incoming audio Base64Str and user-specified avatar image or video, and to output an animated video and return its path.</p>

                    <p>The above steps help us create the functional block for our microservice. To allow the user to build the necessary dependencies and run the “Animation” microservice, we need to write a Dockerfile for “wav2lip” server API and another one for “Animation”. The <a class="b_special_a1" href="">Dockerfile.intel_hpu</a>, for example, starts with the PyTorch* installer Docker image on Intel Gaudi, and ends with calling an “entrypoint” bash script.</p>

                     </section>

                    <section id="dk_build_avatar">
                        <h4 class="">2. Build a new Megaservice “AvatarChatbot” in GenAIExamples</h4>
                        <p>In python “AvatarChatbot/docker/avatarchatbot.py” file, we will first define the megaservice class AvatarChatbotService. In the “add_remote_service” function, use the “add” function of the megaservice orchestrator to add “asr”, “llm”, “tts”, and “animation” microservices as nodes in a Directed Acyclic Graph (DAG), and use the flow_to function to connect the edges.</p>

                          <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">class</span>&nbsp; AvatarChatbotService :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">def</span> __init__ ( self , host <span class="dk_code_org">=</span> <span style="color: blue;">" 0 . 0 . 0 . 0 ",</span> port <span class="dk_code_org">=</span> <span class="dk_code_blue">8000</span> ) :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.host <span class="dk_code_org">=</span> host</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.host <span class="dk_code_org">=</span> port</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice <span class="dk_code_org">=</span> ServiceOrchestrator() </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">def</span> add_remote_service ( self ) :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;asr <span class="dk_code_org">=</span> MicroService<span>(</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span>" asr " ,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host <span class="dk_code_org">=</span> ASR_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port <span class="dk_code_org">=</span> ASR_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    12
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;">"/v1/audio/transcriptions" </span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    13
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    14
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type<span class="dk_code_org">=</span>ServiceType.ASR,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    15
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    16
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;llm <span class="dk_code_org">=</span> MicroService(</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    17
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span><span style="color: blue;">"llm"</span>,</p>
                                    </div>
                                </div>
                            </div><div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    18
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host<span class="dk_code_org">=</span>LLM_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    19
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span>LLM_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    20
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;">"/v1/chat/completions"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    21
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    22
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type <span class="dk_code_org">=</span> ServiceType.LLM,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    23
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    24
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tts <span class="dk_code_org">=</span> MicroService(</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    25
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span> <span style="color: blue">"tts"</span> ,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    26
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host<span class="dk_code_org">=</span>TTS_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    27
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span>TTS_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    28
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;"> "/v1/audio/speech",</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    29
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    30
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type <span class="dk_code_org">=</span> ServiceType.TTS,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    31
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    32
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;animation <span class="dk_code_org">=</span> MicroService(</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    33
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span class="dk_code_org">=</span> <span style="color: blue;"> "animation"</span> ,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    34
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host<span class="dk_code_org">=</span>ANIMATION_SERVICE_HOST_IP,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    35
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port<span class="dk_code_org">=</span>ANIMATION_SERVICE_PORT,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    36
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endpoint<span class="dk_code_org">=</span> <span style="color: blue;">"/v1/animation"</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    37
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use_remote_service <span class="dk_code_org">=</span> <span class="dk_code_blue">True</span>,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    38
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service_type<span class="dk_code_org">=</span>ServiceType.ANIMATION,</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    39
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>)</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    40
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.add ( asr ) .add( llm ) .add ( tts ) .add ( animation )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    41
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.flow_to ( asr , llm )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    42
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.flow_to ( llm, tts )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    43
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.megaservice.flow_to ( tts , animation )
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    44
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.gateway <span class="dk_code_org">=</span> AvatarChatbotGateway(megaservice=self.megaservice, host<span class="dk_code_org">=</span> <span style="color: blue;">"0.0.0.0"</span>, port<span class="dk_code_org">=</span>self.port)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    </section>

                    <section id="dk_define_gateway">
                        <h4><strong>3. Define Gateway for our megaservice</strong></h4>
                        <p>A gateway is an interface for users to access the Megaservice. We define the AvatarChatbotGateway class in the python file - <a class="b_special_a1" href="">GenAIComps/comps/cores/mega/gateway.py</a>. The AvatarChatbotGateway contains the megaservice orchestrator, host, port, endpoint, and input and output datatype information. It also has a handle_request function that schedules passing the initial input with parameters to the first microservice and collects response from the last microservice.<br>
                            Finally, we need to write a <a class="b_special_a1" href="">Dockerfile</a> for users to easily build the AvatarChatbot backend Docker&nbsp;image and deploy the “AvatarChatbot” examples. The Dockerfile includes scripts to install necessary GenAI components and dependencies.</p>
                    </section>

                    <section id="dk_lip_synchronization">
                        <h4 style="font-weight: 400;">II. Lip Synchronization and Face Animation Models</h4>
                    </section>

                    <section id="dk_wav2lip">
                        <h4 style="font-weight: 400;">1. Wav2Lip + GFPGAN</h4>
                        <p class="mb-0"><strong>Wav2Lip [2]</strong> is a cutting-edge lip-synchronization technique that leverages deep learning to accurately align audio with video. Wav2Lip includes:</p>
                        <ul>
                            <li>A pre-trained expert lip-sync discriminator that is accurate in detecting sync in real videos</li>
                            <li>A modified LipGAN [6] model to generate a talking face video frame-by-frame</li>
                        </ul>
                        <p>The pretraining stage includes training an expert lip-sync discriminator on the LRS2 [4] dataset. The lip-sync expert is pre-trained to output the probability that the input video-audio pair is in sync.</p>
                        <p class="mb-0">During Wav2Lip training, a similar architecture to LipGAN is used. The generator contains a speech encoder, a visual encoder, and a face decoder. All three are stacks of convolutional layers. The discriminator is also a convolutional block. The modified LipGAN is trained like any other GANs: the generator is trained to minimize the adversarial loss, based on the discriminator’s score; the discriminator is trained to distinguish between frames generated by the generator versus the ground-truth frames. Overall, the generator is trained by minimizing a weighted sum of the following loss components:</p>
                        <ol>
                            <li>An L1 reconstruction loss between generated and ground-truth frames</li>
                            <li>A synchronization loss between generated video frames and input audio from the lip-sync expert</li>
                            <li>An adversarial loss between the generated and ground-truth frames, based on the discriminator score</li>
                        </ol>
                        <p>Upon inference, we feed the Wav2Lip model with the audio speech from the preceding TTS block, along with the video frames that contain the avatar figure. The trained Wav2Lip model outputs a lip-synced video featuring the avatar speaking out the speech.</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/wav2lip.png" alt="">
                        </div>
                        <p><strong>Figure 4. Wav2Lip [2] approach to generate accurate lip-sync</strong></p>
                        <p class="mb-0">&nbsp;</p>
                        <p>The video generated from Wav2Lip features lip synchronization, but the resolution around the mouth area is lowered. Optionally, we could append a GFPGAN [7] model after Wav2Lip to improve the face quality within the generated video frames. The GFPGAN model estimates a high-quality image from an input facial image suffering from unknown degradation through face restoration. It is a U-Net [8] degradation removal module that uses a pretrained face GAN (such as Style-GAN2 [3]) as a prior. The GFPGAN model is pretrained to restore high-quality face details in its output frames, leaving us with a more vivid and realistic avatar representation.</p>
                    </section>

                    <section id="dk_sadtalker">
                        <h4 style="font-weight: 400;">2. SadTalker</h4>
                        <p>In addition to Wav2Lip, we offer another state-of-the-art model choice to perform face animation. Stylized Audio-Driven Talking-head video generation, SadTalker [5], generates 3D motion coefficients (head, pose, expression) of a 3D Morphable Model (3DMM) [1] from audio. These coefficients are mapped to 3D key points, and further used to drive the input image through a 3D-aware face renderer. The output is a realistic talking head video.</p>
                        <p>We enabled the deployment of both Wav2Lip and SadTalker models on Intel® Xeon® Scalable processors, and Wav2Lip model on Intel® Gaudi® Al accelerators.</p>
                    </section>

                    <p class="mb-0">&nbsp;</p>

                    <section id="dk_how_deploy_intel">
                        <h4 style="font-weight: 300;">How to deploy on Intel® Xeon® scalable processors and Intel® Gaudi® AI Accelerators</h4>
                        <p>Based on your intended deployment environment, the required Docker images for the same FastAPI service/microservice/megaservice could vary. For example, “wav2lip” service container&nbsp;uses an image named “opea/wav2lip:latest” when deployed on Intel® Xeon® CPUs and another image named “opea/wav2lip-gaudi:latest” when deployed on Intel® Gaudi® AI Accelerators. These images use separate versions of Dockerfiles, to include their respective dependencies.</p>
                        <div class="">
                            <img class="w-100" src="/img/darshit_image/code-comparison.png" alt="">
                        </div>
                        <p><strong>Figure 5. YAML Files Comparison for Intel Xeon and Intel Gaudi accelerators</strong></p>
                        <p>&nbsp;</p>
                        <p class="mb-0">The above difference calls for a YAML file to explicitly set for each service container. The “compose.yaml” file enables OPEA users to customize the following key elements:</p>
                        <ul>
                            <li>Service image: the specific Docker image to use for each service</li>
                            <li>Ports: mapping external ports to the container’s internal port</li>
                            <li>Environment variables: ensuring that each service has the necessary context and configs (Ex., LLM model name, Device, Inference mode, Additional inputs, etc.)</li>
                            <li>Volumes: shared data between host and containers</li>
                            <li>Other elements such as IPC, Network, Runtime, cap_add, etc.</li>
                        </ul>
                        <p>By default, on Intel® Gaudi® AI accelerators, the OPEA-based AI Avatar Audio Chatbot example distributes its workload on four Intel® Gaudi® cards on a single Intel® Gaudi® 2 AI accelerator node. Each microservice is assigned to one card. This can be verified in the “compose.yaml” config file, where “asr”, “llm”, “tts”, and “animation” microservice’s Docker containers are each associated with a dedicated Intel Gaudi card by setting the “<strong>HABANA_VISIBLE_MODULES</strong>” environment variable to values 0, 1, 2, 3, respectively. This is referred to as “<a class="b_special_a1" href="">Multiple Dockers Each With a Single Workload</a>” [10].</p>
                        <p>A deeper dive into the Intel® Gaudi® 2 node gives a clearer picture of Intel® Gaudi® card layouts. First, we find the mapping between the index and module ID of the Intel Gaudi® processors through the “hl-smi” System Management Interface tool [9] and sample output of the mapping is shown in the <a class="b_special_a1" href="">link here</a>.</p>
                        <p>Similarly, we can use another “hl-smi” command to figure out <a class="b_special_a1" href="">NUMA Affinity</a> [9]. NUMA (Non-Uniform Memory Access) affinity for devices refers to the alignment of devices with a specific&nbsp;region of memory to optimize performance. In multi-card systems like Intel Gaudi®, NUMA affinity provides Intel Gaudi® cards with fast access to the memory controlled by the CPU nearest to it. In <a class="b_special_a1" href="">this example</a>, Intel Gaudi® cards with module IDs 0-3 correspond to memory controlled by CPUs 0 and 1.</p>
                    </section>
                    <p class="mb-0">&nbsp;</p>

                    <section id="dk_deep_learning">
                        <h4>Deep Learning Optimizations</h4>
                    </section>
                    <p class="mb-0">&nbsp;</p>

                    <section id="dk_mode_of_operation">
                        <h4>Mode of Operation: Eager mode vs. Lazy mode</h4>
                        <p>The mode of operation is controlled by the environment variable “PT_HPU_LAZY_MODE” that can have values 0 and 1 (0 for Eager mode and 1 for Lazy mode).</p>
                        <p>In “GenAIComps/comps/animation/entrypoint.sh”, we set this variable to 0 to use Eager mode. At the same time, we extend the Eager mode with torch.compile, wrapping the face detector, Wav2Lip, and GFPGAN models into corresponding graphs. Unlike Lazy mode, Eager mode with torch.compile does not require building a graph in each iteration which reduces host computation overhead. In addition, the backend parameter for torch.compile must be set as hpu_backend for both training and inference. A list of common models that support Eager mode + torch.compile can be found here [11].</p>

                                <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_green"># Load Wav2Lip , BG sampler , GFPGAN models</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">model <span class="dk_code_org">=</span> load_model ( args ) </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">model <span class="dk_code_org">=</span> torch . <span style="color: blue;">compile</span> (model, backend <span class="dk_code_org">=</span> <span style="color: blue;">"hpu_backend"</span> )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">print</span> ( <span style="color: blue;">" Wav2Lip Model loaded "</span>)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>On the other hand, Lazy mode helps users retain the flexibility and benefits that come with the PyTorch define-by-run approach. The execution of the ops in the accumulated graph is triggered only when a tensor value is required. This allows the Intel Gaudi graph to be constructed with multiple ops, providing the graph compiler opportunity to optimize the device execution for these ops. A more detailed discussion over PyTorch Gaudi Theory of Operations can be found at [16].</p>
                    </section>

                    <section id="dk_run_inference">
                        <h4>Run Inference Using BF16 & FP8 with PyTorch Autocast and Intel® Neural Compressor</h4>
                        <p>Mixed-precision quantization allows deep learning neural networks operations to be executed faster while reducing model weight’s size on memory. In this example, we enabled quantization of the face detector and the Wav2Lip model through 2 methods.</p>
                        <p>First, we can utilize the native PyTorch autocast to automatically run a default list of registered operators (ops) in the lower precision bfloat16 data type. The list of ops can be found at [12]. This enables inference of the face animation module in BF16.</p>
            
                         <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"><span class="dk_code_blue">with</span> &nbsp;  torch.no_grad ( ) :</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">with</span> torch.autocast(device_type <span class="dk_code_org">=</span> <span style="color: blue;">" hpu "</span>, dtype<span class="dk_code_org">=</span>torch.bfloat16):</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pred <span class="dk_code_org">=</span> model ( mel_batch , img_batch ) </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>In a second method, we can take advantage of the <a class="b_special_a1" href="">Intel Neural Compressor</a> package to enable FP8 inference on Intel® Gaudi® accelerator [18]. Using FP8 data type for inference halves the required memory bandwidth of the model. Further, the computation speed of FP8 is twice as fast as BF16. We need to first write a JSON config file, and then use the “convert” API to quantize the model as shown in the <a class="b_special_a1" href="">link here</a>.</p>
                    </section>
                    <p class="mb-0">&nbsp;</p>

                    <section id="dk_feature_improve">
                        <h4 style="font-weight: 300; margin-bottom: 15px;">Feature Improvements</h4>
                    </section>

                    <section id="dk_text_to_speech">
                        <h4>Text-to-Speech (TTS) Service</h4>
                        <p class="mb-4">We used a SOTA model “microsoft/SpeechT5” [17] as the default TTS model to use in OPEA. Instead of letting it transform the entire length of the text tokens to audio, we apply the code in the file “<a class="b_special_a1" href="">speecht5_model.py</a>” to automatically detect the last punctuation in the last token chunk, during batch splitting of the long text. This modification allows the TTS service to output text that’s integral and continuous, without abrupt stopping.</p>
                    </section>

                    <section id="dk_animation_service">
                        <h4>Animation Service</h4>
                        <p>In Wav2Lip [2] animation, we allow tunable frames-per-second (fps) for the video frame generation and the code is in the <a class="b_special_a1" href="">link here</a>. This is controlled by the user-specified “fps” parameter. When the visual input to Wav2Lip is an image containing the avatar face, we have the freedom to define the frame rate for the final video. Based on the frame rate, a variable number of audio Mel spectrogram chunks are fused together with a single frame. Although fps=30 endows slightly better video render smoothness, setting fps=10 leads to 1/3 video frames to generate, and thus 1/3 neural network iterations and computation. Making the frame rate tunable is ideal for low-latency, high-throughput animation scenarios.</p>

                        
                            <!-- code toolbar 3 -->
                     <div class="mv_code_toolbar">
                        <div class="mv_toolbar_item mv_copy_icon">
                            <i class="fa-regular fa-copy"></i>
                        </div>
                        <div class="mv_copy_message text-end hidden">Copied</div>
                        <div class="code-content">
                            <div style="padding-bottom: 0rem !important" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    1
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue"> if not</span> &nbsp;os.path.isfile(args.face):</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    2
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">raise</span>  ValueError ( <span style="color: blue;">"--face argument must be a valid path to video/image file"</span> )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    3
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">elif</span>  args.face.split ( <span style="color: blue;"> " . "</span> ) [ <span class="dk_code_org">-</span> <span class="dk_code_blue">1</span> ] in [ " <span style="color: blue;">jpg</span> " , " <span style="color: blue;">jpeg</span> "  , " <span style="color: blue;">png</span> " ]:</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    4
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full_frames <span class="dk_code_org">=</span> [ cv2.imread ( args.face ) ]</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    5
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fps <span class="dk_code_org">=</span> args.fps</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    6
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dk_code_blue">else</span>:</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    7
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;video_stream <span class="dk_code_org">=</span> cv2.VideoCapture ( args . face )</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    8
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fps <span class="dk_code_org">=</span> video_stream.get ( cv2.CAP_PROP_FPS ) </p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc" class="pe-3">
                                    9
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> . . . . . . . . . . . .</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    10
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"> . . . . . . . . . . . .</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    11
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    12
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;<span class="dk_code_green"> # one single video frame corresponds to 80/25*0.01 = 0.032 seconds (or 32 milliseconds) of audio</span></p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important; padding-bottom: 0px !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    13
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mel_chunks <span class="dk_code_org">=</span>  [ ]</p>
                                    </div>
                                </div>
                            </div>
                            <div style="padding-top: 0rem !important;" class="d-flex mv_pre">
                                <div style="border-right: 1px solid #ccc; padding-right: 7px;" class="">
                                    14
                                </div>
                                <div class="">
                                    <div class="mv_code text-break">
                                        <p class="mb-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mel_idx_multiplier <span class="dk_code_org">=</span> <span class="dk_code_blue">80.0</span>  <span class="dk_code_org">/</span> fps</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </section>

                    
                    <section id="dk_instructions_run">
                        <h4 style="font-weight: 300;">Instructions to Run the AI Avatar Chatbot – Try on your own!</h4>
                        <p class="mb-0">Follow the instructions in <a class="b_special_a1" href="">AvatarChatbot Microservice</a> and <a class="b_special_a1" href="">Avatar Animation Microservice</a> to:</p>
                        <ol>
                            <li>Build required Docker images for all microservices (“asr”, “llm”, “tts”, “animation”) and the AvatarChatbot megaservice</li>
                            <li>Set the necessary environment variables with export commands</li>
                            <li>Start the Docker services on Intel® Xeon® scalable processors / Intel® Gaudi® AI accelerators, using Docker compose</li>
                            <li>Validate the Docker services with curl commands or Python files</li>
                            <li>Interact with the AI Avatar application in the Gradio UI on your local browser</li>
                        </ol>
                        <p>Watch the <a class="b_special_a1" href="">short demo</a> on how to run this AI Avatar Application.</p>
                        <video class="w-100 dk_intel_video" controls loop>
                            <source src="/img/darshit_image/video.mp4">
                        </video>
                    </section>
                    <p>&nbsp;</p>

                    <section id="dk_future_work">
                        <h3 style="font-weight: 300;">Future Work</h3>
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_real_time">
                        <h4>Real-time streaming of LLM and TTS outputs and animated frames</h4>
                        <p>Hugging Face LLM model API [19] enables setting the streaming mode for LLMs, allowing the generation of a stream of tokens asynchronously and the code will be available in the <a class="b_special_a1" href="">python file here</a>. By setting “streaming=True” in the LLM params and enabling streaming in TTS, we can expect text tokens and their corresponding audio waveform to be generated at a faster pace. Then, we apply techniques such as frame buffering, to accumulate frames processed by the “Animation” microservice. We start streaming the output video once the number buffered frames surpass a checkpoint, for example 1/3, of the total number of expected frames. Then, the users will soon experience the avatar video animation.</p>
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_useful_res">
                        <h4>Useful Resources</h4>
                        <ul>
                            <li><a class="b_special_a1" href="">Overview - Intel® Gaudi® Al Accelerators</a></li>
                            <li><a class="b_special_a1" href="">Overview - Intel® Xeon® Scalable Processors</a></li>
                            <li><a class="b_special_a1" href="">Introducing The Open Platform for Enterprise AI</a></li>
                            <li><a class="b_special_a1" href="">OPEA Project GitHub repo</a></li>
                            <li><a class="b_special_a1" href="">Sign up on Intel® Tiber™ Developer Cloud</a></li>
                            <li><a class="b_special_a1" href="">Official documentation - PyTorch* Optimizations from Intel</a></li>
                            <li><a class="b_special_a1" href="">Intel® Extension for PyTorch* - Documentation</a></li>
                        </ul>
                        
                    </section>
                    <p class="mb-0">&nbsp;</p> 

                    <section id="dk_additional_resou">
                        <h4>References</h4>
                        <p>[1] B. Egger et al., “3D Morphable Face Models -- Past, Present and Future,” Apr. 16, 2020, arXiv: arXiv:1909.01815. Accessed: Sep. 12, 2024. [Online]. Available: <a class="b_special_a1" href="">http://arxiv.org/abs/1909.01815</a></p>
                        <p>[2] K. R. Prajwal, R. Mukhopadhyay, V. Namboodiri, and C. V. Jawahar, “A Lip Sync Expert Is All You Need for Speech to Lip Generation In The Wild,” in Proceedings of the 28th ACM International Conference on Multimedia, Oct. 2020, pp. 484–492. doi: <a class="b_special_a1" href="">10.1145/3394171.3413532</a>.</p>
                        <p>[3] T. Karras, S. Laine, M. Aittala, J. Hellsten, J. Lehtinen, and T. Aila, “Analyzing and Improving the Image Quality of StyleGAN,” Mar. 23, 2020, arXiv: arXiv:1912.04958. doi: <a class="b_special_a1" href="">10.48550/arXiv.1912.04958</a>.</p>
                        <p>[4] “Lip Reading Sentences 2 (LRS2) dataset.” Accessed: Sep. 12, 2024. [Online]. Available: <a class="b_special_a1" href="">https://www.robots.ox.ac.uk/~vgg/data/lip_reading/lrs2.html</a></p>
                        <p>[5] W. Zhang et al., “SadTalker: Learning Realistic 3D Motion Coefficients for Stylized Audio-Driven Single Image Talking Face Animation,” arXiv.org. Accessed: Sep. 12, 2024. [Online]. Available: <a class="b_special_a1" href="">https://arxiv.org/abs/2211.12194v2</a></p>
                        <p>[6] P. K. R, R. Mukhopadhyay, J. Philip, A. Jha, V. Namboodiri, and C. V. Jawahar, “Towards Automatic Face-to-Face Translation,” in Proceedings of the 27th ACM International Conference on Multimedia, Oct. 2019, pp. 1428–1436. doi: <a class="b_special_a1" href="">10.1145/3343031.3351066</a>.</p>
                        <p>[7] X. Wang, Y. Li, H. Zhang, and Y. Shan, “Towards Real-World Blind Face Restoration with Generative Facial Prior,” Jun. 10, 2021, arXiv: arXiv:2101.04061. doi: <a class="b_special_a1" href="">10.48550/arXiv.2101.04061</a>.</p>
                        <p>[8] O. Ronneberger, P. Fischer, and T. Brox, “U-Net: Convolutional Networks for Biomedical Image Segmentation,” May 18, 2015, arXiv: arXiv:1505.04597. doi: <a class="b_special_a1" href="">10.48550/arXiv.1505.04597</a>.</p>
                        <p>[9] “System Management Interface Tool (hl-smi) — Gaudi Documentation 1.17.1 documentation.” Accessed: Oct. 03, 2024. [Online]. Available: <a class="b_special_a1" href="">https://docs.habana.ai/en/latest/Management_and_Monitoring/Embedded_System_Tools_Guide/System_Management_Interface_Tool.html?highlight=numa#hl-smi-utility-options</a></p>
                        <p>[10] “Multiple Dockers Each with a Single Workload — Gaudi Documentation 1.17.1 documentation.” Accessed: Oct. 03, 2024. [Online]. Available: <a class="b_special_a1" href="">https://docs.habana.ai/en/latest/Orchestration/Multiple_Tenants_on_HPU/Multiple_Dockers_each_with_Single_Workload.html</a></p>
                        <p>[11] HabanaAI/Model-References. (Oct. 02, 2024). Jupyter Notebook. Intel® Gaudi® AI Accelerator. Accessed: Oct. 04, 2024. [Online]. Available: <a class="b_special_a1" href="">https://github.com/HabanaAI/Model-References</a></p>
                        <p>[12] “Mixed Precision Training with PyTorch Autocast — Gaudi Documentation 1.17.1 documentation.” Accessed: Oct. 04, 2024. [Online]. Available: <a class="b_special_a1" href="">https://docs.habana.ai/en/latest/PyTorch/PyTorch_Mixed_Precision/index.html</a></p>
                        <p>[13] “Stable Diffusion 3 Medium - a Hugging Face Space by stabilityai.” Accessed: Oct. 20, 2024. [Online]. Available: <a class="b_special_a1" href="">https://huggingface.co/spaces/stabilityai/stable-diffusion-3-medium</a></p>
                        <p>[14] “Open Platform For Enterprise AI,” Open Platform for Enterprise AI (OPEA). Accessed: Oct. 20, 2024. [Online]. Available: <a class="b_special_a1" href="">https://opea.dev/</a></p>
                        <p>[15] “AvatarChatbot · opea-project/GenAIExamples,” GitHub. Accessed: Oct. 20, 2024. [Online]. Available:&nbsp;<a class="b_special_a1" href="">https://github.com/opea-project/GenAIExamples/tree/main/AvatarChatbot</a></p>
                        <p>[16] “PyTorch Gaudi Theory of Operations — Gaudi Documentation 1.18.0 documentation.” Accessed: Oct. 20, 2024. [Online]. Available: <a class="b_special_a1" href="">https://docs.habana.ai/en/latest/PyTorch/Reference/PyTorch_Gaudi_Theory_of_Operations.html</a></p>
                        <p>[17] J. Ao et al., “SpeechT5: Unified-Modal Encoder-Decoder Pre-Training for Spoken Language Processing,” May 24, 2022, arXiv: arXiv:2110.07205. Accessed: Oct. 20, 2024. [Online]. Available: <a class="b_special_a1" href="">http://arxiv.org/abs/2110.07205</a></p>
                        <p>[18] “Run Inference Using FP8 — Gaudi Documentation 1.18.0 documentation.” Accessed: Oct. 20, 2024. [Online]. Available: <a class="b_special_a1" href="">https://docs.habana.ai/en/latest/PyTorch/Inference_on_PyTorch/Inference_Using_FP8.html</a></p>
                        <p>[19] “langchain_community.llms.huggingface_endpoint.HuggingFaceEndpoint — 🦜🔗 LangChain 0.2.16.” Accessed: Oct. 20, 2024. [Online]. Available: <a class="b_special_a1" href="">https://api.python.langchain.com/en/latest/llms/langchain_community.llms.huggingface_endpoint.HuggingFaceEndpoint.html</a></p>
                    </section>
                    <p class="mb-0">&nbsp;</p> 
                        
                    </section>
                </div>
            </div>
        </div>
    </section>


  
    

     <section style="border-top: 1px solid #d7d7d7;" class="container py-5">
        <h4 class="h6">Product and Performance Information</h4>
        <div class="disclaimer" style="font-size: 12px;"><sup>1</sup> Performance varies by use, configuration and other factors. Learn more at <a class="b_special_a1" href="">www.Intel.com/PerformanceIndex</a>.</div>
        </div>
    </section>

    <!-- footer -->
    <div id="footer"></div>

    <!-- script header and footer -->
    <script>
        // navbar include  
        fetch('/y_index/y_navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
        // footer include 
        fetch('/y_index/y_footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            });
    </script>

    <!-- nav script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
        if (document.getElementsByClassName('VK_all_sections section') && document.getElementsByClassName('VK_sidebar_dropdown')) {
            const sections = document.querySelectorAll('.VK_all_sections section');
            const navLinks = document.querySelectorAll('.VK_sidebar_dropdown a');
            const detailsElements = document.querySelectorAll('.VK_sidebar_dropdown details');

            function removeActiveClass() {
                navLinks.forEach(link => link.classList.remove('VK_sidebar_active_link'));
                detailsElements.forEach(details => {
                    details.removeAttribute('open');
                    details.setAttribute('close', ''); // Optional: to visually indicate it's closed
                });
            }

            function activateLinkAndDetails(targetId) {
                navLinks.forEach(link => {
                    if (link.getAttribute('href') === `#${targetId}`) {
                        link.classList.add('VK_sidebar_active_link');
                        let parentDetails = link.closest('details');

                        // Open all ancestor details elements
                        while (parentDetails) {
                            parentDetails.setAttribute('open', '');
                            parentDetails.removeAttribute('close'); // Optional: remove the closed indicator
                            parentDetails = parentDetails.parentElement.closest('details');
                        }
                    }
                });
            }

            function onScroll() {
                let currentSection = '';
                sections.forEach(section => {
                    const sectionTop = section.getBoundingClientRect().top;
                    const sectionBottom = section.getBoundingClientRect().bottom;

                    // Check if the section is in view
                    if (sectionTop <= 100 && sectionBottom >= 0) {
                        currentSection = section.getAttribute('id');
                    }
                });

                if (currentSection) {
                    removeActiveClass();
                    activateLinkAndDetails(currentSection);
                } else {
                    removeActiveClass();
                }
            }

            window.addEventListener('scroll', onScroll);
        } else {
            return
        }
    });
    </script>

    <!-- copy script -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".mv_copy_icon").forEach((icon) => {
                icon.addEventListener("click", async function () {
                    try {
                        const toolbar = this.closest(".mv_code_toolbar");
                        const codeBlock = toolbar.querySelector(".code-content");
                        const codeContent = codeBlock.innerText;
    
                        // Use Clipboard API to copy text
                        await navigator.clipboard.writeText(codeContent);
    
                        // Hide the copy icon and show the "Copied!" message
                        const message = toolbar.querySelector(".mv_copy_message");
                        this.classList.add("hidden"); // Hide the copy icon
                        message.classList.remove("hidden"); // Show the "Copied!" message
    
                        // Hide the message and show the icon again after 2 seconds
                        setTimeout(() => {
                            message.classList.add("hidden");
                            this.classList.remove("hidden");
                        }, 2000); // Adjust delay as needed
    
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                    }
                });
            });
        });
    </script>

</body>

</html>