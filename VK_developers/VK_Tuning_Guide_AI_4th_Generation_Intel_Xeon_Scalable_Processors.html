<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- font family -->
    <link href="https://fonts.cdnfonts.com/css/intel-clear" rel="stylesheet">
    <!-- boootstap file -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- costom css file -->
    <link rel="stylesheet" href="/css/vivek.css">
    <link rel="stylesheet" href="/css/yatri.css">

    <!-- all.min file -->
    <link rel="stylesheet" href="/css/all.min.css">


</head>

<body>

    <main>

        <!-- header -->
        <header>
            <div id="navbar"></div>
        </header>

        <!-- poster -->
        <section class=" VK_light_blue">
            <div class="VK_cont">
                <div class="row m-0">
                    <div class="col text-white">
                        <h1 class="VK_py_pre_heading fw-light m-0 py-4 mt-2">
                            Tuning Guide for AI on the 4th Generation Intel® Xeon® Scalable Processors
                        </h1>
                        <div
                            class="d-flex pb-4 col-md-4 col-sm-6 col-12 flex-md-row flex-column justify-content-between">
                            <div class="d-flex flex-md-column flex-row">
                                <p class="mb-2 me-3 w-100">
                                    ID
                                </p>
                                <p class="mb-2 me-3 w-100">
                                    767351
                                </p>
                            </div>
                            <div class="d-flex flex-md-column flex-row">
                                <p class="mb-2 me-3 w-100">
                                    Updated
                                </p>
                                <p class="mb-2 me-3 w-100">
                                    2/1/2023
                                </p>
                            </div>
                            <div class="d-flex flex-md-column flex-row">
                                <p class="mb-2 me-3 w-100">
                                    Version
                                </p>
                                <p class="mb-2 me-3 w-100">
                                    Latest
                                </p>
                            </div>
                            <div class="d-flex flex-md-column flex-row">
                                <p class="mb-2 me-3 d-none d-md-block">
                                    &nbsp;
                                </p>
                                <p class="mb-2 me-3 w-100">
                                    Public
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!--  -->
        <!--  -->
        <section class="">
            <div class="VK_cont py-5 VK_border_bottom">
                <div class="row m-0">
                    <div class="col-md-4 col-lg-3 d-md-block d-none">
                        <div class="VK_sticky_side_bar VK_side_bar_postion_stickey">
                            <div>
                                <div class="VK_sidebar_dropdown VK_nav_li">
                                    <details>
                                        <summary>
                                            <a href="#VK_Overview" class="text-decoration-none VK_a">
                                                Overview
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_AIStages" class="text-decoration-none VK_a my-1">
                                                    AI Stages
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Introducing_Advanced_Matrix_Extension"
                                                class="text-decoration-none VK_a">
                                                Introducing Advanced Matrix Extension (AMX)
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <details>
                                                    <summary>
                                                        <a href="#VK_Intel_Deep_Learning_Boost"
                                                            class="text-decoration-none VK_a">
                                                            Intel® Deep Learning Boost
                                                        </a>
                                                    </summary>
                                                    <ul class="list-unstyled ps-4">
                                                        <li>
                                                            <a href="#VK_AMX" class="text-decoration-none VK_a">
                                                                AMX
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </details>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Environment" class="text-decoration-none VK_a">
                                                Environment
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_Hardware" class="text-decoration-none VK_a my-1">
                                                    Hardware
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Software" class="text-decoration-none VK_a my-1">
                                                    Software
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_BIOS_Settings" class="text-decoration-none VK_a my-1">
                                                    BIOS Settings
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Memory" class="text-decoration-none VK_a my-1">
                                                    Memory
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_CPU" class="text-decoration-none VK_a my-1">
                                                    CPU
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Network" class="text-decoration-none VK_a my-1">
                                                    Network
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Hard_drive" class="text-decoration-none VK_a my-1">
                                                    Hard drive
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Linux_Operating_System_Optimization"
                                                class="text-decoration-none VK_a">
                                                Linux Operating System Optimization
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_OpenMP_Parameter_Settings"
                                                    class="text-decoration-none VK_a my-1">
                                                    OpenMP Parameter Settings
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Number_CPU_cores" class="text-decoration-none VK_a my-1">
                                                    Number of CPU cores
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_NUMA_Configuration" class="text-decoration-none VK_a my-1">
                                                    NUMA Configuration
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Configuration_Linux_Performance_Governor"
                                                    class="text-decoration-none VK_a my-1">
                                                    Configuration of Linux Performance Governor
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_CPU_CStates_Settings"
                                                    class="text-decoration-none VK_a my-1">
                                                    CPU C-States Settings
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Using_Intel_Extension" class="text-decoration-none VK_a">
                                                Using Intel® Optimization for TensorFlow*
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_Install_Intel_Optimization_TensorFlow"
                                                    class="text-decoration-none VK_a my-1">
                                                    Install Intel® Optimization for TensorFlow*
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Optimization_Recommendations_TensorFlow"
                                                    class="text-decoration-none VK_a my-1">
                                                    Optimization Recommendations for TensorFlow-based Deep Learning
                                                    Models
                                                </a>
                                            </li>
                                            <li>
                                                <details>
                                                    <summary>
                                                        <a href="#VK_Enabling_BF16" class="text-decoration-none VK_a">
                                                            Enabling BF16
                                                        </a>
                                                    </summary>
                                                    <ul class="list-unstyled ps-4">
                                                        <li>
                                                            <a href="#VK_For_Inference"
                                                                class="text-decoration-none VK_a">
                                                                For Inference
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#VK_For_Training"
                                                                class="text-decoration-none VK_a">
                                                                For Training
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </details>
                                            </li>
                                            <li>
                                                <a href="#VK_Enabling_INT8" class="text-decoration-none VK_a my-1">
                                                    Enabling INT8
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Using_Intel_Extension1" class="text-decoration-none VK_a">
                                                Using Intel® Extension for Pytorch* for optimization and Performance
                                                boost
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <details>
                                                    <summary>
                                                        <a href="#VK_Using_PyTorchLearning_Framework"
                                                            class="text-decoration-none VK_a">
                                                            Using PyTorch*, a Deep Learning Framework
                                                        </a>
                                                    </summary>
                                                    <ul class="list-unstyled ps-4">
                                                        <li>
                                                            <a href="#VK_Deploying_PyTorch"
                                                                class="text-decoration-none VK_a">
                                                                Deploying PyTorch
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#VK_Intel_Extension_PyTorch_Installation"
                                                                class="text-decoration-none VK_a">
                                                                Intel® Extension for PyTorch* Installation
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </details>
                                            </li>
                                            <li>
                                                <details>
                                                    <summary>
                                                        <a href="#VK_Getting_Started" class="text-decoration-none VK_a">
                                                            Getting Started
                                                        </a>
                                                    </summary>
                                                    <ul class="list-unstyled ps-4">
                                                        <li>
                                                            <a href="#VK_Optimization_Recommendations_Training"
                                                                class="text-decoration-none VK_a">
                                                                Optimization Recommendations for Training and
                                                                Inferencing PyTorch-based Deep Learning Models
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#VK_Enabling_BF16_Inference"
                                                                class="text-decoration-none VK_a">
                                                                Enabling BF16 Inference
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </details>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_AI_Neural_Network_Precision_Optimization"
                                                class="text-decoration-none VK_a">
                                                AI Neural Network Model Low Precision Optimization
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_ai_Overview" class="text-decoration-none VK_a my-1">
                                                    Overview
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Instruction" class="text-decoration-none VK_a my-1">
                                                    Instruction
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Steps" class="text-decoration-none VK_a my-1">
                                                    Steps
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_AI_Neural_Network_Quantization_Process"
                                                    class="text-decoration-none VK_a my-1">
                                                    AI Neural Network Quantization Process
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_AI_Neural_Network_Mixed_Precision_Process"
                                                    class="text-decoration-none VK_a my-1">
                                                    AI Neural Network Mixed Precision Process
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Intel_Neural_Compressor"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® Neural Compressor
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Installing_Intel_Neural_Compressor"
                                                    class="text-decoration-none VK_a my-1">
                                                    Installing Intel® Neural Compressor
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Using_Intel_Neural_Compressor"
                                                    class="text-decoration-none VK_a my-1">
                                                    Using Intel® Neural Compressor
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Dataset_preparation"
                                                    class="text-decoration-none VK_a my-1">
                                                    Dataset preparation:
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Pretrained_FP32_Model_preparation"
                                                    class="text-decoration-none VK_a my-1">
                                                    Pretrained FP32 Model preparation:
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_Run_Quantization" class="text-decoration-none VK_a my-1">
                                                    Run Quantization:
                                                </a>
                                            </li>
                                            <li>
                                                <details>
                                                    <summary>
                                                        <a href="#VK_Run_Mix_Precision_BF16"
                                                            class="text-decoration-none VK_a">
                                                            Run Mix Precision (BF16 + FP32):
                                                        </a>
                                                    </summary>
                                                    <ul class="list-unstyled ps-4">
                                                        <li>
                                                            <a href="#VK_Convert_Without_Tuning_Accuracy"
                                                                class="text-decoration-none VK_a">
                                                                Convert Without Tuning Accuracy
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#VK_Convert_With_Tuning_accuracy"
                                                                class="text-decoration-none VK_a">
                                                                Convert With Tuning Accuracy
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </details>
                                            </li>
                                            <li>
                                                <a href="#VK_INT8_BF16_FP32" class="text-decoration-none VK_a my-1">
                                                    INT8 + BF16 + FP32
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Run Benchmark:
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Graphics_Building_Blocks_Creators_GenAI"
                                                class="text-decoration-none VK_a">
                                                Using Intel® Distribution of OpenVINO™ Toolkit for Inference
                                                Acceleration
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® Distribution of OpenVINO™ Toolkit
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Enable BF16/INT8 Inference with Intel® Deep Learning Boost
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <details>
                                        <summary>
                                            <a href="#VK_Graphics_Building_Blocks_Creators_GenAI"
                                                class="text-decoration-none VK_a">
                                                Data Analytics and Machine Learning Acceleration
                                            </a>
                                        </summary>
                                        <ul class="list-unstyled ps-4">
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® Distribution for Python*
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® Distribution of Modin*
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® Distribution of Modin*
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® Extension for Scikit-learn*
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    XGBoost* Optimized for Intel® Architecture
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#VK_More_Accessible_Differentiable_Rendering"
                                                    class="text-decoration-none VK_a my-1">
                                                    Intel® oneAPI Data Analytics Library (oneDAL)
                                                </a>
                                            </li>
                                        </ul>
                                    </details>
                                    <p class="m-0 my-2">
                                        <a href="#VK_Additional_resources" class="text-decoration-none VK_a">
                                            Performance Data
                                        </a>
                                    </p>
                                    <p class="m-0 my-2">
                                        <a href="#VK_Additional_resources" class="text-decoration-none VK_a">
                                            References
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-8 col-lg-7">
                        <div class="VK_all_sections">
                            <div class="VK_section_descriptions">
                                <div class="text-end">
                                    <p class="m-0 VK_print_email_font">
                                        <span class="VK_a mx-2 d-inline-block">
                                            <i class="fa-solid fa-print"></i>
                                        </span>
                                        <span class="VK_a mx-2 d-inline-block">
                                            <i class="fa-regular fa-envelope"></i>
                                        </span>
                                    </p>
                                </div>
                            </div>
                            <section class="mt-5" id="VK_Overview">
                                <h3 class="VK_side_heading fw-light">
                                    Overview
                                </h3>
                                <p>
                                    This guide is for users who are familiar with Intel® AI Analytics Toolkit and Intel®
                                    Distribution of OpenVINO™ Toolkit. It provides recommendations for tuning the 4th
                                    Generation Intel® Xeon® Scalable Processor platform for Intel® optimized AI
                                    Toolkits. These hardware and software configurations provide the best performance in
                                    most situations. However, please note that we rely on users to carefully consider
                                    these settings for their specific scenarios, since these tools can be deployed in
                                    multiple ways.
                                </p>
                                <p class="m-0">
                                    The 4th Generation Intel® Xeon® Scalable Processor platform is an unique, scalable
                                    platform optimized for different workloads acceleration including HPC, AI, BigData,
                                    Networking etc. with higher performance and TCO efficiency:
                                </p>
                                <ul>
                                    <li>
                                        More cores with up to 56 cores per socket and up to 448 cores in an 8-socket
                                        platform
                                    </li>
                                    <li>
                                        New built-in AI acceleration engine, Intel® Advanced Matrix Extensions (AMX),
                                        which accelerates a variety of AI Inference and Training workloads (NLP,
                                        recommendation systems, image recognition…) with BF16 and INT8 datatype support
                                    </li>
                                    <li>
                                        Increased memory bandwidth and speed with DDR5 (vs. DDR4) and High Bandwidth
                                        Memory (HBM) for memory-bound workloads
                                    </li>
                                    <li>
                                        Accelerate time to data analysis with new integrated In-Memory Database
                                        Accelerator (IAX)
                                    </li>
                                    <li>
                                        High throughput for latency-sensitive workloads with up to 2x I/O bandwidth with
                                        PCIe 5.0
                                    </li>
                                    <li>
                                        Increased overall system performance with Intel Dynamic Load Balancer (DLB) –
                                        efficient handling of network data
                                    </li>
                                    <li>
                                        Up to 4x cryptography and data compression workloads acceleration with
                                        Integrated Intel QuickAssist Technology (QAT)
                                    </li>
                                </ul>
                            </section>
                            <section class="mt-5" id="VK_AIStages">
                                <h4 class="VK_n22">
                                    AI Stages
                                </h4>
                                <p>
                                    A typical deep learning application has following stages:
                                </p>
                                <div class="col-xxl-8">
                                    <img src="/img/vivek/VK_239.png" class="w-100" alt="">
                                </div>
                                <p class="m-0">
                                    Each stage requires the allocation of these resources:
                                </p>
                                <ul>
                                    <li>
                                        Computational power
                                    </li>
                                    <li>
                                        Memory
                                    </li>
                                    <li>
                                        Storage for datasets
                                    </li>
                                    <li>
                                        Communication link between compute nodes
                                    </li>
                                    <li>
                                        Optimized software
                                    </li>
                                </ul>
                                <p>
                                    Choosing the right combination of resources greatly accelerates the efficiency of
                                    your AI services. All of the processes including dataset preparation, model
                                    training, model optimization, and model deployment, can be done on a 4th Generation
                                    Intel® Xeon® Scalable Processor platform-based infrastructure that supports machine
                                    learning/deep learning platforms for training and inference. A proposed
                                    infrastructure is shown in the figure below:
                                </p>
                                <div class="col-xxl-9">
                                    <img src="/img/vivek/VK_240.jpg" class="w-100" alt="">
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Introducing_Advanced_Matrix_Extension">
                                <h3 class="VK_side_heading fw-light">
                                    Introducing Advanced Matrix Extension (AMX)
                                </h3>
                                <p>
                                    Intel® Advanced Vector Extensions 512 (Intel® AVX-512) is a “single instruction,
                                    multiple data” (SIMD) instruction set based on x86 processors. It is used for
                                    executing multiple data operations with a single instruction. As the name implies,
                                    Intel® AVX-512 has a register width of 512 bits, and it supports 16 32-bit
                                    single-precision floating-point numbers or 64 8-bit integers.
                                </p>
                                <p>
                                    Intel® Xeon® Scalable Processors support multiple types of workloads, including
                                    complex AI workloads. They improve AI computation performance with Intel® Deep
                                    Learning Boost (Intel® DL Boost). Intel Deep Learning Boost includes Intel® AVX-512
                                    VNNI (Vector Neural Network Instructions), AVX512 BF16 and AMX (Advanced Matrix
                                    Extension).
                                </p>
                                <p>
                                    AVX-512 VNNI can combine three instructions (vpmaddubsw, vpmaddwd, and vpaddd) into
                                    one (vpdpbusd) execution. This further unleashes the computing potential of
                                    next-generation Intel® Xeon® Scalable Processors and increases the inference
                                    performance of the INT8 model. 2nd Generation, 3rd Generation, and 4th Generation
                                    Intel® Xeon® Scalable Processors all support VNNI.
                                </p>
                                <p>
                                    The AVX-512_BF16 feature includes an instruction (VDPBF16PS) to compute dot product
                                    of BF16 pairs and to accumulate to single precision (FP32), as well as instructions
                                    (VCVTNE2PS2BF16, VCVTNEPS2BF16) to convert packed single precision data (FP32) to
                                    packed BF16 data.
                                </p>
                                <p>
                                    Intel® Advanced Matrix Extensions (Intel® AMX) is a new 64-bit programming paradigm
                                    consisting of two components: a set of 2-dimensional registers (tiles) representing
                                    sub-arrays from a larger 2-dimensional memory image and an accelerator able to
                                    operate on tiles. The first implementation is called TMUL (tile matrix multiply
                                    unit).
                                </p>

                            </section>
                            <section class="mt-5" id="VK_Intel_Deep_Learning_Boost">
                                <h4 class="VK_n22">
                                    Intel® Deep Learning Boost
                                </h4>
                                <div class="overflow-auto">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Processor
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AVX-512 VNNI
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AVX-512 BF16
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AMX
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr>
                                                <td class="VK_start_border">
                                                    Cascade Lake
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Cooper Lake
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Ice Lake
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Sapphire Rapids
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="my-5">
                                    <img src="/img/vivek/VK_241.jpg" class="w-100" alt="">
                                </div>
                                <p class="text-center">
                                    Deep Learning VNNI
                                </p>
                                <p>
                                    Platforms not using VNNI require the vpmaddubsw, vpmaddwd and vpaddd instructions to
                                    complete the multiply-accumulate operations in INT8 convolution operation:
                                </p>
                                <div class="my-5">
                                    <img src="/img/vivek/VK_242.jpg" class="w-100" alt="">
                                </div>
                                <p class="text-center">
                                    Diagram showing INT8 described in text
                                </p>
                                <p>
                                    Platforms using VNNI require only one instruction, “vpdpbusd”, to complete the INT8
                                    convolution operation:
                                </p>
                                <div class="mt-5">
                                    <div class="col-xxl-8">
                                        <img src="/img/vivek/VK_243.jpg" class="w-100" alt="">
                                    </div>
                                </div>
                                <p class="text-center mt-4">
                                    Diagram showing INT8 described in text
                                </p>
                            </section>
                            <section class="mt-5" id="VK_AMX">
                                <h4 class="VK_n22">
                                    AMX
                                </h4>
                                <p>
                                    AMX introduces a new matrix register file with eight rank-2 tensor registers called
                                    “tiles”. It also introduces the concept of accelerators that are capable of
                                    operating on those tiles. The matrix register file comprises eight tiles (named
                                    TMM0…TMM7), each having a maximum size of 16 rows by 64-byte columns for a total
                                    size of 1 KiB/register and 8 KiB for the entire register file. Load a tile
                                    representing a small section from a larger image in memory, operate on that tile,
                                    and repeat with the next tile that represents the next portion of the image. When
                                    done, store the resultant tile to memory. The Tile Matrix Multiply (TMUL) unit
                                    comprises a grid of fused multiply-add units capable of operating on tiles.
                                </p>
                                <div class="my-5">
                                    <div class="col-xxl-9">
                                        <img src="/img/vivek/VK_244.png" class="w-100" alt="">
                                    </div>
                                </div>
                                <h4 class="mt-4 VK_n22">
                                    AMX sub-extensions and related instructions
                                </h4>
                                <p>
                                    The AMX extension comprises three sub-extensions: AMX-TILE, AMX-INT8, and AMX-BF16.
                                </p>
                                <div class="overflow-auto">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Instruction
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AMX-TILE
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AMX-INT8
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AMX-BF16
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr>
                                                <td class="VK_start_border">
                                                    LDTILECFG
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    STTILECFG
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TILELOADD
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TILELOADDT1
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TILESTORED
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TILERELEASE
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TILEZERO
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TDPBSSD
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TDPBSUD
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TDPBUSD
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TDPBUUD
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    TDPBF16PS
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                                <td class="VK_start_border">
                                                    V
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Environment">
                                <h3 class="VK_side_heading">
                                    Environment
                                </h3>
                                <p>
                                    This configuration is based on 4th Generation Intel Xeon processor hardware. Server
                                    platform, memory, hard drives, network interface cards can be determined according
                                    to usage requirements. Hardware and software tested for this tuning guide include:
                                </p>
                            </section>
                            <section class="mt-4" id="VK_Hardware">
                                <h4 class="VK_n22">
                                    Hardware
                                </h4>
                                <div class="overflow-auto my-4">
                                    <table class="VK_font14">
                                        <thead>
                                            <tr>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Hardware
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Model
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr>
                                                <td class="VK_start_border">
                                                    Server Platform Name/Brand/Model
                                                </td>
                                                <td class="VK_start_border">
                                                    Intel® Eagle Stream Server Platform
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    CPU
                                                </td>
                                                <td class="VK_start_border">
                                                    Intel® Xeon® PLATINUM 8480 CPU @ 2.00GHz
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Memory
                                                </td>
                                                <td class="VK_start_border">
                                                    8*32 GB DDR5, 4800 MT/s
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Software">
                                <h4 class="VK_n22">
                                    Software
                                </h4>
                                <div class="overflow-auto my-4">
                                    <table class="VK_font14">
                                        <thead>
                                            <tr>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Software
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Version
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr>
                                                <td class="VK_start_border">
                                                    Operating System
                                                </td>
                                                <td class="VK_start_border">
                                                    Ubuntu 22.04.1 LTS
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Kernel
                                                </td>
                                                <td class="VK_start_border">
                                                    5.17.6
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Frequency Driver
                                                </td>
                                                <td class="VK_start_border">
                                                    intel_pstate
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Frequency Governor
                                                </td>
                                                <td class="VK_start_border">
                                                    performance
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_BIOS_Settings">
                                <h4 class="VK_n22">
                                    BIOS Settings
                                </h4>
                                <div class="overflow-auto my-4">
                                    <table class="VK_font14">
                                        <thead>
                                            <tr>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Configuration item
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Recommended value
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr>
                                                <td class="VK_start_border">
                                                    <b class="VK_table_color">
                                                        Processor Configuration
                                                    </b>
                                                </td>
                                                <td class="VK_start_border">
                                                    &nbsp;
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    (New BIOS) Enable LP
                                                </td>
                                                <td class="VK_start_border">
                                                    All LPs
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    (Old BIOS) Hyper-Threading [ALL]
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Hardware Prefetcher
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Adjacent Cache Prefetch
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    DCU Streamer Prefetcher
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    DCU IP Prefetcher
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    LLC Prefetch
                                                </td>
                                                <td class="VK_start_border">
                                                    Disabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    LLC Dead Line Allocation
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Homeless Prefetch
                                                </td>
                                                <td class="VK_start_border">
                                                    Auto
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    <b class="VK_table_color">
                                                        Advanced Power Management Configuration
                                                    </b>
                                                </td>
                                                <td class="VK_start_border">

                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Intel® Turbo Boost Technology
                                                </td>
                                                <td class="VK_start_border">
                                                    Enabled
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Memory">
                                <h4 class="VK_n22">
                                    Memory
                                </h4>
                                <p>
                                    One important system configuration is balanced DIMM population, which is suggested
                                    to be set as balanced to get optimized performance.
                                </p>
                                <p>
                                    Populate as many channels per socket as possible prior to adding additional DIMMs to
                                    the channel. It might impact the memory bandwidth if two dimm share one channel.
                                </p>
                                <p>
                                    Please also refer to Chapter 4 in
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Eagle Stream Platform Performance & Power Optimization Guide
                                    </a>
                                    for more details.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_CPU">
                                <h4 class="VK_n22">
                                    CPU
                                </h4>
                                <p>
                                    The 4th Generation of Intel® Xeon® Scalable processor comes with the all new Intel®
                                    AMX (Advanced Matrix Extensions) instruction set. Intel® AMX provides acceleration
                                    for mixed precision deep learning training and inference workloads. The 4th
                                    Generation of Intel® Xeon® Scalable processor provides two instruction sets viz.
                                    AMX_BF16 and AMX_INT8 which provides acceleration for bfloat16 and int8 operations
                                    respectively
                                </p>
                                <p>
                                    Note: To confirm that AMX_BF16 and AMX_INT8 are supported by the CPU, enter the
                                    following command on the bash terminal and look for AMX in the “flags” section. In
                                    case AMX instructions are not getting listed, consider updating the Linux kernel to
                                    5.17 and above
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy1(1)" id="VK_beet_btn1">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">$ cat /proc/cpuinfo</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Network">
                                <h4 class="VK_n22">
                                    Network
                                </h4>
                                <p>
                                    If cross-node training clusters are required, choose high-speed networks, such as
                                    25G/100G, for better scalability.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Hard_drive">
                                <h4 class="VK_n22">
                                    Hard drive
                                </h4>
                                <p>
                                    For high I/O efficiency, use SSDs and drives with higher read and write speeds.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Linux_Operating_System_Optimization">
                                <h3 class="VK_side_heading fw-light">
                                    Linux Operating System Optimization
                                </h3>
                                <p>
                                    To speed up processing tune the Linux operating system for parallel programming.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_OpenMP_Parameter_Settings">
                                <h4 class="VK_n22">
                                    OpenMP Parameter Settings
                                </h4>
                                <p class="m-0">
                                    The
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        OpenMP
                                    </a>is a specification for parallel programming. In case your application implements
                                    OpenMP based threading, experiment with the following environment variables and find
                                    the best fit values:
                                </p>
                                <ul>
                                    <li>
                                        OMP_NUM_THREADS = “number of cpu cores in container”
                                    </li>
                                    <li>
                                        KMP_BLOCKTIME = 1 or 0 (set according to actual type of model)
                                    </li>
                                    <li>
                                        KMP_AFFINITY=granularity=fine, verbose, compact,1,0
                                    </li>
                                </ul>
                            </section>
                            <section class="mt-5" id="VK_Number_CPU_cores">
                                <h4 class="VK_n22">
                                    Number of CPU cores
                                </h4>
                                <p class="m-0">
                                    Consider the impact on inference performance based on the number of CPU cores being
                                    used, as follows:
                                </p>
                                <ul>
                                    <li>
                                        When batchsize is small (in online services for instance) the increase in
                                        inference throughput gradually weakens as the number of CPU cores increases. In
                                        practice, 8-16 CPU cores is recommended for service deployment depending on the
                                        model used.
                                    </li>
                                    <li>
                                        When batchsize is large (in offline services for instance) the inference
                                        throughput can increase linearly as the number of CPU cores increases. In
                                        practice, more than 20 CPU cores is recommended for service deployment.
                                    </li>
                                </ul>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy2(2)" id="VK_beet_btn2">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment"># taskset -C xxx-xxx –p pid (limits the number of CPU cores used in service)</span></p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_NUMA_Configuration">
                                <h4 class="VK_n22">
                                    NUMA Configuration
                                </h4>
                                <p>
                                    For NUMA-based servers, a 5-10% increase in performance may be realized when
                                    configuring NUMA on the same node compared to using it on different nodes.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy3(3)" id="VK_beet_btn3">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment">#numactl -N NUMA_NODE -l command args ... (controls NUMA nodes running in service)</span></p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Configuration_Linux_Performance_Governor">
                                <h4 class="VK_n22">
                                    Configuration of Linux Performance Governor
                                </h4>
                                <p>
                                    Efficiency is the key consideration. Set the CPU frequency to its peak for the best
                                    performance.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy4(4)" id="VK_beet_btn4">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment"># cpupower frequency-set -g performance</span></p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_CPU_CStates_Settings">
                                <h4 class="VK_n22">
                                    CPU C-States Settings
                                </h4>
                                <p>
                                    There are several power modes available for each CPU which are collectively referred
                                    to as C-states or C-modes. To reduce power consumption when the CPU is idle, the CPU
                                    can be placed in the low-power mode. Disabling C-States can increase performance.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy5(5)" id="VK_beet_btn5">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment">#cpupower idle-set -d 2,3</span></p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Using_Intel_Optimization_TensorFlow">
                                <h3 class="VK_side_heading fw-light">
                                    Using Intel® Optimization for TensorFlow*
                                </h3>
                                <p>
                                    Starting with TensorFlow Version 2.9, the performance improvements delivered by the
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Intel® oneAPI Deep Neural Network Library (oneDNN)
                                    </a>
                                    are turned on by default. While Intel® Optimization for TensorFlow* adds
                                    optimizations for extra performance when running TensorFlow on Intel hardware. The
                                    intention is to deliver up-to-date features and optimizations for TensorFlow on
                                    Intel hardware. Examples include AVX-512 Vector Neural Network Instructions (AVX512
                                    VNNI) and Intel® Advanced Matrix Extensions (Intel® AMX).
                                </p>
                                <p>
                                    Intel® Optimization for TensorFlow* has been released as an
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        open–source project.
                                    </a>
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Install_Intel_Optimization_TensorFlow">
                                <h4 class="VK_n22">
                                    Install Intel® Optimization for TensorFlow*
                                </h4>
                                <div class="VK_bg_e6 VK_yellow_border p-4">
                                    <b>
                                        Note:
                                    </b>
                                    Optimizations for 4th Generation Intel® Xeon® Scalable processors start from Intel®
                                    Optimization for TensorFlow* 2.11, and dev
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        packages
                                    </a>
                                    are needed.
                                </div>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy6(6)" id="VK_beet_btn6">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">conda create -n intel-tf python=3.8 -y
conda activate intel-tf
pip install intel-tensorflow==2.11.dev202242</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Optimization_Recommendations_TensorFlow">
                                <h4 class="VK_n22">
                                    Optimization Recommendations for TensorFlow-based Deep Learning Models
                                </h4>
                                <p class="m-0">
                                    To maximize deep learning performance on Intel® platform, Intel® Optimization for
                                    TensorFlow* takes advantage of following techniques:
                                </p>
                                <ul>
                                    <li>
                                        NUMA Control: numactl specifies NUMA scheduling and memory placement policy
                                    </li>
                                    <li>
                                        Multi-threads: utilize OpenMP to parallelize deep learnng model execution among
                                        CPU cores
                                    </li>
                                    <li>
                                        Thread Affinity: use KMP_AFFINITY to restrict execution of certain threads to a
                                        subset of the physical processing units in a multiprocessor computer
                                    </li>
                                </ul>
                                <p>
                                    Refer to
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Maximize TensorFlow* Performance on CPU
                                    </a>
                                    for more details.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Enabling_BF16">
                                <h4 class="VK_n22">
                                    Enabling BF16
                                </h4>
                                <p>
                                    Intel® 4th Generation Intel® Xeon® Scalable Processors support accelerating AI
                                    inference by using low precision data types such as BF16 and INT8 based on the
                                    Intel® Deep Learning Boost and Intel® Advanced Matrix Extension(AMX). There are
                                    several instructions such as AMX_BF16, AMX_INT8, AVX512_BF16, AVX512_VNNI to
                                    accelerate AI models.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_For_Inference">
                                <h4 class="VK_n22">
                                    For Inference
                                </h4>
                                <p class="m-0">
                                    For a pre-trained FP32 model (resnet50 from TensorFlow Hub as an example below):
                                </p>
                                <ol>
                                    <li>
                                        Install tensorflow_hub for this sample in addition to Intel® Optimization for
                                        TensorFlow*
                                        <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                            <div class="text-end">
                                                <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                                    onclick="gen_4th_copy7(7)" id="VK_beet_btn7">
                                                    <i class="fa-regular fa-copy"></i>
                                                </button>
                                            </div>
                                            <div class="VK_code-container">
                                                <div class="VK_line-number"></div>
                                                <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">pip install tensorflow_hub</p></pre>
                                                </code>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        Run inference with export
                                        <span class="VK_bg_e6 d-inline-block">
                                            ONEDNN_VERBOSE=1
                                        </span>,
                                        you should be able to see AVX512_BF16 and AMX_BF16 instructions are enabled.
                                        <ul>
                                            <li>
                                                Save below code as inference.py
                                            </li>
                                        </ul>
                                        <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                            <div class="text-end">
                                                <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                                    onclick="gen_4th_copy8(8)" id="VK_beet_btn8">
                                                    <i class="fa-regular fa-copy"></i>
                                                </button>
                                            </div>
                                            <div class="VK_code-container">
                                                <div class="VK_line-number"></div>
                                                <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_blue">import </span>os
<span class="VK_code_blue">import  </span>tensorflow <span class="VK_code_blue">as </span>tf
<span class="VK_code_blue">import  </span>tensorflow_hub <span class="VK_code_blue">as </span>tf_hub

<span class="VK_code_comment"># Enable Auto Mixed Precision</span>
tf.config.optimizer.set_experimental_options({<span class="VK_code_blue">"auto_mixed_precision_onednn_bfloat16"</span>:<span class="VK_code_blue">True</span>})

os.environ[<span class="VK_code_blue">"TFHUB_CACHE_DIR"</span>]= <span class="VK_code_blue"> 'tfhub_models'</span>
model = tf_hub.KerasLayer('https://tfhub.dev/google/imagenet/resnet_v1_50/classification/5')
model(tf.random.uniform((1, 224, 224, 3)))</p></pre>
                                                </code>
                                            </div>
                                        </div>
                                        <ul>
                                            <li>
                                                Run inference script in terminal
                                            </li>
                                        </ul>
                                        <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                            <div class="text-end">
                                                <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                                    onclick="gen_4th_copy9(9)" id="VK_beet_btn9">
                                                    <i class="fa-regular fa-copy"></i>
                                                </button>
                                            </div>
                                            <div class="VK_code-container">
                                                <div class="VK_line-number"></div>
                                                <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">export ONEDNN_VERBOSE=1
python inference.py</p></pre>
                                                </code>
                                            </div>
                                        </div>
                                        <ul>
                                            <li>
                                                Check the result
                                            </li>
                                        </ul>
                                        <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                            <div class="text-end">
                                                <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                                    onclick="gen_4th_copy10('10')" id="VK_beet_btn10">
                                                    <i class="fa-regular fa-copy"></i>
                                                </button>
                                            </div>
                                            <div class="VK_code-container">
                                                <div class="VK_line-number"></div>
                                                <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">dst_bf16::blocked:Adcb16a:f0,,,64x3x7x7,69.343
onednn_verbose,exec,cpu,convolution,jit:avx512_core_amx_bf16,forward_training,src_bf16::blocked:acdb:f0 wei_bf16::blocked:Adcb16a:f0 bia_undef::undef::f0 dst_bf16::blocked:acdb:f0,attr-scratchpad:user attr-post-ops:binary_sub:f32:2+binary_mul:f32:2+binary_mul:f32:2+binary_add:f32:2+eltwise_relu ,alg:convolution_direct,mb1_ic3oc64_ih224oh112kh7sh2dh0ph3_iw224ow112kw7sw2dw0pw3,3.29614
onednn_verbose,exec,cpu,pooling_v2,jit:avx512_core_bf16,forward_training,src_bf16::blocked:acdb:f0 dst_bf16::blocked:acdb:f0 ws_u8::blocked:acdb:f0,,alg:pooling_max,mb1ic64_ih112oh56kh3sh2dh0ph0_iw112ow56kw3sw2dw0pw0,5.21802</p></pre>
                                                </code>
                                            </div>
                                        </div>
                                    </li>
                                </ol>
                            </section>
                            <section class="mt-5" id="VK_For_Training">
                                <h4 class="VK_n22 mb-3">
                                    For Training
                                </h4>
                                <p class="m-0">
                                    You can also train a mixed precision model with bf16 using TensorFlow Keras API
                                </p>
                                <ul>
                                    <li>
                                        Save below code as training.py
                                    </li>
                                </ul>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy11('11')" id="VK_beet_btn11">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_blue">import </span>tensorflow <span class="VK_code_blur">as </span> tf
<span class="VK_code_blue">from </span>keras.utils  <span class="VK_code_blue">import  </span>np_utils
<span class="VK_code_blue">from </span>tensorflow.keras <span class="VK_code_blue">import </span>mixed_precision

<span class="VK_code_comment"># Enable Auto Mixed Precision</span>
mixed_precision.set_global_policy(<span class="VK_code_blue">'mixed_bfloat16'</span>:<span class="VK_code_blue">True</span>)

<span class="VK_code_comment"># load data</span>
cifar10 = tf.keras.datasets.cifar10
(x_train, y_train), (x_test, y_test) = cifar10.load_data()
num_classes = <span class="VK_code_blue">10</span>

<span class="VK_code_comment"># pre-process</span>
x_train, x_test = x_train/ <span class="VK_code_blue">255.0,</span> x_test/<span class="VK_code_blue">255.0</span>
y_train = np_utils.to_categorical(y_train, num_classes)
y_test = np_utils.to_categorical(y_test, num_classes)

<span class="VK_code_comment"># build model</span>
feature_extractor_layer = tf.keras.applications.ResNet50(include_top=<span class="VK_code_blue">False</span>, weights=<span class="VK_code_blue">'imagenet'</span>)
feature_extractor_layer.trainable = <span class="VK_code_blue">False</span>
model = tf.keras.Sequential([
    tf.keras.layers.Input(shape=(32, 32, 3)),
    feature_extractor_layer,
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(1024, activation='relu'),
    tf.keras.layers.Dropout(0.2),
    tf.keras.layers.Dense(num_classes, activation='softmax')
])
model.<span class="VK_code_blue">compile</span>(
    optimizer=tf.keras.optimizers.Adam(),
    loss=tf.keras.losses.CategoricalCrossentropy(),
    metrics=[<span class="VK_code_blue">'acc'</span>])

<span class="VK_code_commit"># train model</span>
model.fit(x_train, y_train,
    batch_size = <span class="VK_code_blue">128</span>,
    validation_data=(x_test, y_test), 
    epochs=<span class="VK_code_blue">1</span>)

model.save(<span class="VK_code_blue">'resnet_bf16_model'</span>)</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <ul>
                                    <li>
                                        Run training script in terminal
                                    </li>
                                </ul>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy12('12')" id="VK_beet_btn12">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">export ONEDNN_VERBOSE=1
python training.py</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <ul>
                                    <li>
                                        Check the result
                                    </li>
                                </ul>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy0('0')" id="VK_beet_btn0">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">dst_bf16::blocked:Adcb16a:f0,,,64x3x7x7,160.375
onednn_verbose,exec,cpu,convolution,jit:avx512_core_amx_bf16,forward_training,src_bf16::blocked:acdb:f0 wei_bf16::blocked:Adcb16a:f0 bia_bf16::blocked:a:f0 dst_bf16::blocked:acdb:f0,attr-scratchpad:user ,alg:convolution_direct,mb128_ic3oc64_ih32oh16kh7sh2dh0ph3_iw32ow16kw7sw2dw0pw3,2.0481
onednn_verbose,exec,cpu,batch_normalization,bnorm_jit:avx512_core_bf16,forward_inference,data_bf16::blocked:acdb:f0 diff_undef::undef::f0,,flags:GSR,mb128ic64ih16iw16,0.783203
onednn_verbose,exec,cpu,pooling_v2,jit:avx512_core_bf16,forward_training,src_bf16::blocked:acdb:f0 dst_bf16::blocked:acdb:f0 ws_u8::blocked:acdb:f0,,alg:pooling_max,mb128ic64_ih18oh8kh3sh2dh0ph0_iw18ow8kw3sw2dw0pw0,0.908936</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Enabling_INT8">
                                <h3 class="VK_n22">
                                    Enabling INT8
                                </h3>
                                <p>
                                    Intel® Optimized TensorFlow* co-works with
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Intel® Neural Compressor
                                    </a>
                                    to provide compatible TensorFlow INT8 quantization solution support with same user
                                    experience.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Using_Intel_Extension1">
                                <h3 class="VK_side_heading fw-light">
                                    Using Intel® Extension for Pytorch* for optimization and Performance boost
                                </h3>
                                <p>
                                    Intel® Extension for PyTorch* adds optimizations for extra performance when running
                                    PyTorch on Intel hardware. Most of these optimizations will be included in stock
                                    PyTorch releases in the future. The intention of the extension is to deliver
                                    up-to-date features and optimizations for PyTorch on Intel hardware. Examples
                                    include AVX-512 Vector Neural Network Instructions (AVX512 VNNI) and Intel® Advanced
                                    Matrix Extensions (Intel® AMX).
                                </p>
                                <p>
                                    Intel® Extension for PyTorch* has been released as an
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        open–source project.
                                    </a>
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Using_PyTorchLearning_Framework">
                                <h3 class="VK_n22">
                                    Using PyTorch*, a Deep Learning Framework
                                </h3>
                                <p>
                                    Make sure PyTorch is installed so that the extension will work properly. For more
                                    information on installation refer to:
                                    <a href="" class="Vk_text_undrline_dots VK_a">
                                        Installation
                                    </a>
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Deploying_PyTorch">
                                <h3 class="VK_n22">
                                    Deploying PyTorch
                                </h3>
                                <p>
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Reference
                                    </a>
                                </p>
                                <p>
                                    Environment: Python 3.7 or above
                                </p>
                                <p>
                                    Step 1: Visit the
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        official PyTorch website
                                    </a>
                                </p>
                                <p>
                                    Step 2: Select CPU
                                </p>
                                <p>
                                    Currently, Intel oneDNN is integrated into the official version of PyTorch, so there
                                    is no need for an additional installation to achieve accelerated performance on the
                                    Intel® Xeon® Scalable Processor platform. Select “CPU” for Compute Platform. See the
                                    figure below for details.
                                </p>
                                <div class="">
                                    <img src="/img/vivek/VK_245.png" class="w-100" alt="">
                                </div>
                                <p class="mt-4">
                                    Step 3: Installation
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy13('13')" id="VK_beet_btn13">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">pip3 install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cpu</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Intel_Extension_PyTorch_Installation">
                                <h3 class="VK_n22">
                                    Intel® Extension for PyTorch* Installation
                                </h3>
                                <p>
                                    You can use either of the following commands to install Intel® Extension for
                                    PyTorch*:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy14('14')" id="VK_beet_btn14">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">python -m pip install intel_extension_for_pytorch</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy15('15')" id="VK_beet_btn15">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">python -m pip install intel_extension_for_pytorch -f https://software.intel.com/ipex-whl-stable</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Getting_Started">
                                <h3 class="VK_n22">
                                    Getting Started
                                </h3>
                                <p>
                                    Minor code changes are required for users to get started with Intel® Extension for
                                    PyTorch*. Both PyTorch imperative mode and TorchScript mode are supported.
                                </p>
                                <p>
                                    <span class="d-inline-block VK_bg_e6">
                                        For inference
                                    </span>
                                    applies the ipex.optimize function to the model object.
                                </p>
                                <p>
                                    <span class="d-inline-block VK_bg_e6">
                                        For training
                                    </span>
                                    applies the ipex.optimize function to the model object, as well as an optimizer
                                    object.
                                </p>
                                <p>
                                    The following code snippet shows training code with BF16/FP32 data types. More
                                    examples for training and inference are available at
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Example Page
                                    </a>
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy16('16')" id="VK_beet_btn16">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_blue">import </span>torch 
<span class="VK_code_blue">import </span>intel_extension_for_pytorch <span class="VK_code_blue">as </span>ipex

model = Model()
model = model.to(memory_format=torch.channels_last)
criterion = ...
optimizer = ...
model.train()

<span class="VK_code_comment"># For FP32</span>
model, optimizer = ipex.optimize(model, optimizer=optimizer)

<span class="VK_code_comment"># For BF16</span>
model, optimizer = ipex.optimize(model, optimizer=optimizer, dtype=torch.bfloat16)

<span class="VK_code_comment"># Setting memory_format to torch.channels_last could improve performance with 4D input data. This is optional.</span>
data = data.to(memory_format=torch.channels_last)
optimizer.zero_grad()
output = model(data)</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Optimization_Recommendations_Training">
                                <h3 class="VK_n22">
                                    Optimization Recommendations for Training and Inferencing PyTorch-based Deep
                                    Learning Models
                                </h3>
                                <p class="m-0">
                                    Although default primitives of PyTorch and Intel® Extension for PyTorch* are highly
                                    optimized, there are additional configuration options that can improve performance.
                                    Most can be applied by a launch script that automates setting configuration options,
                                    mainly for the following:
                                </p>
                                <ol>
                                    <li>
                                        OpenMP library: [Intel OpenMP library (default) | GNU OpenMP library]
                                    </li>
                                    <li>
                                        Memory allocator: [PyTorch default memory allocator | Jemalloc | TCMalloc
                                        (default)]
                                    </li>
                                    <li>
                                        Number of instances: [Single instance (default) | Multiple instances]
                                    </li>
                                </ol>
                                <p>
                                    For more details refer to
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Launch Script Usage Guide
                                    </a>
                                </p>
                                <p>
                                    Apart from launch scripts there are other hardware settings that include configuring
                                    the structure of Intel CPUs, as well as Non-Uniform Memory Access (NUMA). Software
                                    configuration can be set to take advantage of Channels Last memory format, OpenMP,
                                    numactl to fully utilize CPU computation resources with Intel® Extension for
                                    PyTorch* to boost performance. For more details refer to Performance Tuning Guide
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Enabling_BF16_Inference">
                                <h3 class="VK_n22">
                                    Enabling BF16 Inference
                                </h3>
                                <p>
                                    Intel® 4th Generation Intel® Xeon® Scalable Processors support accelerating AI
                                    inference by using low precision data types such as BF16 and INT8 based on the
                                    Intel® Deep Learning Boost and Intel® Advanced Matrix Extension(AMX). There are
                                    several instructions such as AMX_BF16, AMX_INT8, AVX512_BF16, AVX512_VNNI to
                                    accelerate AI models.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Auto_Mixed_Precision">
                                <h3 class="VK_n22">
                                    Auto Mixed Precision(AMP)
                                </h3>
                                <p>
                                    <span class="VK_bg_e6 d-inline-block">
                                        torch.cpu.amp
                                    </span>
                                    provides convenience for auto data type conversion at runtime. Deep learning
                                    workloads can benefit from lower-precision floating point data types such as
                                    torch.float16 or torch.bfloat16, because of its lighter calculation workload and
                                    smaller memory usage. The Auto Mixed Precision (AMP) feature automates the tuning of
                                    data type conversions over all operators.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Steps_enable_AMX_BF16">
                                <h3 class="VK_n22">
                                    Steps to enable AMX_BF16
                                </h3>
                                <p>
                                    To check whether given cpu machine supports AMX_BF16 instructions, use
                                    <span class="VK_bg_e6 d-inline-block">
                                        lscpu
                                    </span>
                                    command.
                                </p>
                                <p>
                                    <span class="VK_bg_e6 d-inline-block">
                                        torch.cpu.amp.autocast
                                    </span>
                                    allows scopes of your script to run with mixed precision. In these scopes,
                                    operations run in a data type chosen by the autocast class to improve performance
                                    while maintaining accuracy. The following simple network should show a speedup with
                                    mixed precision:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy17('17')" id="VK_beet_btn17">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_blue">class  </span>SimpleNet(torch.nn.Module): 
    <span class="VK_code_blue">def </span>__init__(self): 
        <span class="VK_code_blue">super</span>(SimpleNet, self).__init__()
        self.conv = torch.nn.Conv2d(<span class="VK_code_blue">64, 128, (3, 3</span>),  stride=( <span class="VK_code_blue">2, 2</span>),padding=(1, 1), bias=False)

    <span class="VK_code_blue">def </span>forward(self, x):
        <span class="VK_codE_blue">return </span>self.conv(x)</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    <span class="VK_bg_e6 d-inline-block">
                                        torch.cpu.amp.autocast
                                    </span>
                                    is designed to be a context manager that allow the scope of your script to run with
                                    mixed precision. AMX_BF16 are newer and have more advanced intrinsics than
                                    AVX512_BF16. They offer better performance to support AI applications. Therefore,
                                    for the data type BFloat16, AMX_BF16 has the highest execution priority. The AI
                                    frameworks optimized by Intel will choose AMX_BF16 first. If it is not available,
                                    then AVX512_BF16 will be chosen. For more details refer to
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Auto Mixed Precision (AMP)
                                    </a>
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy18('18')" id="VK_beet_btn18">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">model = SimpleNet().<span class="VK_code_blue">eval </span>()
x = torch.rand(<span class="VK_code_blue">64, 64, 224, 224 </span>) 
<span class="VK_code_blue">with </span>torch.cpu.amp.autocast():
    y = model(x)</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    To Check whether AMX_BF16 is enabled, check for
                                    <span class="VK_bg_e6 d-inline-block">
                                        avx512_core_amx_bf16
                                    </span>
                                    JIT Kernel usage. Review the setting
                                    <span class="VK_bg_e6 d-inline-block">
                                        ONEDNN_VERBOSE=1
                                    </span>
                                </p>
                                <p>
                                    The Github link to the Intel® Extension for PyTorch* is:
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Intel® Extension for PyTorch*
                                    </a>
                                </p>
                            </section>
                            <section class="mt-5" id="VK_AI_Neural_Network_Precision_Optimization">
                                <h3 class="VK_side_heading fw-light">
                                    AI Neural Network Model Low Precision Optimization
                                </h3>
                            </section>
                            <section class="mt-5" id="VK_ai_Overview">
                                <h4 class="VK_n22">
                                    Overview
                                </h4>
                                <p class="m-0">
                                    Intel® 4th Generation Intel® Xeon® Scalable Processors support accelerating AI
                                    inference by using low precision data types such as BF16 and INT8 based on the
                                    Intel® Deep Learning Boost and Intel® Advanced Matrix Extension.
                                </p>
                                <ol>
                                    <li>
                                        Quantization
                                    </li>
                                </ol>
                                <p class="m-0">
                                    Using the INT8 data type to optimize AI model is one type of quantization, the
                                    process of mapping continuous infinite values to a smaller set of discrete finite
                                    values.
                                </p>
                                <ol start="2">
                                    <li>
                                        Mixed Precision
                                    </li>
                                </ol>
                                <p class="m-0">
                                    Mixed Precision uses lower-precision data types such as BF16 to make models that run
                                    with 16-bit and 32-bit mixed floating-point types during training and inference.
                                    This runs faster with less memory consumption.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Instruction">
                                <h4 class="VK_n22">
                                    Instruction
                                </h4>
                                <p>
                                    Intel® 4th Generation Intel® Xeon® Scalable Processors support several instructions
                                    to accelerate AI models:
                                </p>
                                <div class="overflow-auto">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    Intrinsics
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AVX512_VNNI
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AVX512_BF16
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AMX_INT8
                                                </th>
                                                <th class="VK_start_border px-4 py-3 VK_table_color">
                                                    AMX_BF16
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr>
                                                <td class="VK_start_border">
                                                    Data type
                                                </td>
                                                <td class="VK_start_border">
                                                    INT8
                                                </td>
                                                <td class="VK_start_border">
                                                    BF16
                                                </td>
                                                <td class="VK_start_border">
                                                    INT8
                                                </td>
                                                <td class="VK_start_border">
                                                    BF16
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="VK_start_border">
                                                    Variable type
                                                </td>
                                                <td class="VK_start_border">
                                                    Vector
                                                </td>
                                                <td class="VK_start_border">
                                                    Vector
                                                </td>
                                                <td class="VK_start_border">
                                                    Matrix
                                                </td>
                                                <td class="VK_start_border">
                                                    Matrix
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p class="mt-3">
                                    AMX_INT8/AMX_BF16 are newer and more advanced intrinsics than
                                    AVX512_VNNI/AVX512_BF16. They offer better performance to support AI applications.
                                    AMX_INT8 has the highest execution priority. The AI frameworks optimized by Intel
                                    will choose AMX_INT8 first. If it is not available, then AVX512_VNNI will be chosen.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Steps">
                                <h3 class="VK_n22">
                                    Steps
                                </h3>
                                <ol>
                                    <li>
                                        Convert FP32 model to INT8/BF16 model.
                                        <br><br>
                                    </li>
                                    <li>
                                        Execute the INT8/BF16 model inference on Intel® 4th Generation Intel® Xeon®
                                        Scalable Processors by the AI frameworks optimized for Intel Architecture.
                                        <br><br>
                                        The AI framework will call highest level instrinsics supported by them in CPU to
                                        gain better performance.
                                        <br><br>
                                    </li>
                                </ol>
                                <p>
                                    &nbsp; &nbsp; &nbsp; &nbsp;
                                    For example: If AI framework calls AVX512_VNNI, instead of AMX_INT8, please check if
                                    the newer release supports AMX_INT8 and install right release.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_AI_Neural_Network_Quantization_Process">
                                <h3 class="VK_n22">
                                    AI Neural Network Quantization Process
                                </h3>
                                <p>
                                    Computations in neural networks are mainly concentrated in the convolution layer and
                                    the fully connected layer. The computations on these two layers can be expressed as:
                                    Y = X * Weights + Bias. Therefore, it is natural to focus on matrix multiplication
                                    to optimize performance. The way to begin neural network model quantization is by
                                    trading-off precision (limited) for performance improvement. By replacing 32-bit
                                    floating-point numbers with low-precision integers for matrix operations, it not
                                    only speeds up calculations, but also compresses the model, thus saving memory
                                    bandwidth.
                                </p>
                                <p class="m-0">
                                    There are three approaches to the quantization of neural network models:
                                </p>
                                <ul>
                                    <li>
                                        Post-Training Quantization (PTQ), which is supported by most AI frameworks.
                                        Quantize a trained FP32 model. It execute a calibration process (infer FP32
                                        model with small dataset) and record the data range of every layer’s input and
                                        output. Then quantize the model according to the data range info. It provides
                                        good quantizatin result.
                                    </li>
                                    <li>
                                        Quantization-Aware-Training (QAT), which inserts the FakeQuantization node into
                                        the FP32 model when the training converges. It increases the
                                        quantization-induced noise. During the backpropagation stage of the training,
                                        the model weights fall into a finite interval which results in better
                                        quantization precision.
                                    </li>
                                    <li>
                                        Dynamic Quantization (DQ) is very similar to PTQ. They are both quantization
                                        methods used on post-trained models. The difference lies in that the
                                        quantization factor in the activation layer is dynamically decided by the data
                                        range used when the neural network model is run, while for PTQ samples from a
                                        small-scale pre-processed dataset are used to obtain data distribution and range
                                        information in the activation layer, then records it permanently in the newly
                                        generated quantization model. Of the Intel® Intel® Neural Compressor which we
                                        will talk about later on, onnxruntime supports this method at the backend only.
                                    </li>
                                </ul>
                                <p class="m-0">
                                    The basic procedure for the post-training quantization of neural network is as
                                    follows:
                                </p>
                                <ol>
                                    <li>
                                        Fuse FP32 OP to INT8 OP. For example, MatMul, BiasAdd and ReLU can be fused into
                                        a single quantized OP at the fully connected layer,
                                        QuantizedMatMulWithBiasAndRelu. Different neural network frameworks support
                                        different fuse-able OPs. For Intel® Intel® Neural Compressor, which will be
                                        discussed later on,
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            here
                                        </a>
                                        is a list of fuse-able OPs supported by TensorFlow. For fuse-able OPs supported
                                        by pyTorch,
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            please see.
                                        </a>
                                    </li>
                                    <li>
                                        Quantize weights and save them in the quantized model.
                                    </li>
                                    <li>
                                        Quantize the input/activation layer by sampling the calibration dataset to
                                        acquire the distribution and range information of the data in the activation
                                        layer, which is then recorded in the newly generated quantized model.
                                    </li>
                                    <li>
                                        The Requantize operation is fused into its corresponding INT8 OP to generate the
                                        final quantized model.
                                    </li>
                                </ol>
                                <p>
                                    Using a simple model which includes two layers of MatMul as an example, we can
                                    observe the quantization process as follows:
                                </p>
                                <div>
                                    <img src="/img/vivek/VK_246.jpg" class="w-100" alt="">
                                </div>
                            </section>
                            <section class="mt-5" id="VK_AI_Neural_Network_Mixed_Precision_Process">
                                <h4 class="VK_n22">
                                    AI Neural Network Mixed Precision Process
                                </h4>
                                <p class="m-0">
                                    FP32 and BF16 have same data range and different decimal part. It’s easy to convert
                                    FP32 to BF16. But use BF16 will impact the model accuracy due to the cutted decimal
                                    part. Some operations are numerically-safe for BF16, that means the operation based
                                    on BF16 has no obviously accuracy loss compared to FP32. Some operations are
                                    numerically-dangerous for BF16, that means the operation based on BF16 has obviously
                                    accuracy loss compared to FP32. The following procedure will be handled by the AI
                                    framework/tool automatically. You can tune it by configuring whether to allow or to
                                    deny numerically-dangerous operations.
                                </p>
                                <ol>
                                    <li>
                                        According to the experiment, set the numerically-safe operations to allow or to
                                        deny numerically-dangerous operations
                                    </li>
                                    <li>
                                        Convert the operations in allow set to BF16
                                    </li>
                                    <li>
                                        Insert the “Cast” operation between FP32 and BF16 operations to convert data
                                        from FP32 to BF16 or revert
                                    </li>
                                </ol>
                            </section>
                            <section class="mt-5" id="VK_Intel_Neural_Compressor">
                                <h4 class="VK_n22">
                                    Intel® Neural Compressor
                                </h4>
                                <p>
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Intel Neural Compressor
                                    </a>
                                    is one of the key AI software components in the Intel® oneAPI AI Analytics Toolkit.
                                    It is an open-source Python library that runs on Intel CPUs and GPUs. This toolkit
                                    delivers unified interfaces across multiple deep learning frameworks for popular
                                    network compression technologies, such as quantization, pruning, and knowledge
                                    distillation. It supports automatic, accuracy-driven, tuning strategies to quickly
                                    find the best model. It also implements different weight pruning algorithms to
                                    generate a pruned model with a pre-defined sparsity goal and it supports knowledge
                                    distillation from a teacher model to a student model.
                                </p>
                                <p>
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Reference
                                    </a>
                                </p>
                                <div class="col-xxl-8">
                                    <img src="/img/vivek/VK_247.png" class="w-100" alt="">
                                </div>
                                <p class="m-0 mt-4">
                                    Intel® Neural Compressor currently support the following Intel optimized deep
                                    learning frameworks:
                                </p>
                                <ul>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            Tensorflow*
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            PyTorch*
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            Apache* MXNet
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            ONNX Runtime
                                        </a>
                                    </li>
                                </ul>
                                <p class="m-0">
                                    The frameworks and their versions that have already been verified are shown below:
                                </p>
                                <ul>
                                    <li>
                                        OS version: CentOS 8.4, Ubuntu 20.04
                                    </li>
                                    <li>
                                        Python version: 3.7, 3.8, 3.9, 3.10
                                    </li>
                                </ul>
                                <div class="overflow-auto">
                                    <table class="">
                                        <thead>
                                            <th class="VK_table_color p-4 VK_start_border">
                                                Framework
                                            </th>
                                            <th class="VK_table_color p-4 VK_start_border VK_bg_e6">
                                                TensorFlow
                                            </th>
                                            <th class="VK_table_color p-4 VK_start_border VK_bg_e6">
                                                Intel TensorFlow
                                            </th>
                                            <th class="VK_table_color p-4 VK_start_border VK_bg_e6">
                                                PyTorch
                                            </th>
                                            <th class="VK_table_color p-4 VK_start_border VK_bg_e6">
                                                IPEX
                                            </th>
                                            <th class="VK_table_color p-4 VK_start_border VK_bg_e6">
                                                ONNX Runtime
                                            </th>
                                            <th class="VK_table_color p-4 VK_start_border VK_bg_e6">
                                                MXNet
                                            </th>
                                        </thead>
                                        <tbody class="VK_tbody">
                                            <tr class="VK_theme_bg">
                                                <td class="VK_start_border">
                                                    Version
                                                </td>
                                                <td class="VK_start_border">
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        2.9.1
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        2.8.2
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        2.7.3
                                                    </a>
                                                </td>
                                                <td class="VK_start_border">
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        2.9.1
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        2.8.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        2.7.0
                                                    </a>
                                                </td>
                                                <td class="VK_start_border">
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.12.0+cpu
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.11.0+cpu
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.10.0+cpu
                                                    </a>
                                                </td>
                                                <td class="VK_start_border">
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.12.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.11.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.10.0
                                                    </a>
                                                </td>
                                                <td class="VK_start_border">
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.11.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.10.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.9.0
                                                    </a>
                                                </td>
                                                <td class="VK_start_border">
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.8.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.7.0
                                                    </a>
                                                    <br>
                                                    <a href="" class="Vk_text_underline_dots VK_a">
                                                        1.6.0
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="VK_yellow_border VK_bg_e6 p-4">
                                    <b>
                                        Note:
                                    </b>
                                    Please set the environment variable TF_ENABLE_ONEDNN_OPTS=1 to enable oneDNN
                                    optimizations if you are using TensorFlow from v2.6 to v2.8. oneDNN has been fully
                                    default from TensorFlow v2.9.
                                </div>
                                <p class="mt-4">
                                    The tuning strategies supported by Intel® Neural Compressor include:
                                </p>
                                <ul>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            Basic
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            Bayesian
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            MSE
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            TPE
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            Exhaustive
                                        </a>
                                    </li>
                                    <li>
                                        <a href="" class="Vk_text_underline_dots VK_a">
                                            Random
                                        </a>
                                    </li>
                                </ul>
                                <p>
                                    The workflow for Intel® Neural Compressor is shown below. The model quantization
                                    parameters matching the accuracy loss target are automatically selected according to
                                    the set tuning strategy, and the quantized model is generated:
                                </p>
                                <div class="">
                                    <img src="/img/vivek/VK_249.png" class="w-100" alt="">
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Installing_Intel_Neural_Compressor">
                                <h3 class="VK_n22">
                                    Installing Intel® Neural Compressor
                                </h3>
                                <p>
                                    For details on installation, refer to:
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Intel Neural Compressor Installation
                                    </a>
                                </p>
                                <p>
                                    Step 1: Use Anaconda to create a Python3.x virtual environment with the name:
                                    env_inc. We are using Python 3.9 here as an example:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy19('19')" id="VK_beet_btn19">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">conda create -n env_inc python=3.9
conda activate env_inc</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Step 2: Install Intel® Neural Compressor with the binary file:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy20('20')" id="VK_beet_btn20">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment"># install stable basic version from pip</span>
pip install neural-compressor
<span class="VK_code_comment"># install stable full version from pip (including GUI)</span>
pip install neural-compressor-full</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    or
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy21('21')" id="VK_beet_btn21">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment"># install nightly basic version from pip</span>
pip install -i https://test.pypi.org/simple/ neural-compressor
<span class="VK_code_comment"># install nightly full version from pip (including GUI)</span>
pip install -i https://test.pypi.org/simple/ neural-compressor-full</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    or
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy22('22')" id="VK_beet_btn22">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment"># install stable basic version from from conda</span>
conda install neural-compressor -c conda-forge -c https://software.repos.intel.com/python/conda/
<span class="VK_code_comment"># install stable full version from from conda (including GUI)</span>
conda install neural-compressor-full -c conda-forge -c https://software.repos.intel.com/python/conda/</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Step 3: Install AI Framework
                                </p>
                                <p>
                                    Install Tensorflow, Pytorch, ONNX-RT, MXNet according to the model type to be
                                    handled. For example, to install intel-tensorflow
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy23('23')" id="VK_beet_btn23">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_comment"># install intel-tensorflow from pip</span>
pip install intel-tensorflow</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Using_Intel_Neural_Compressor">
                                <h3 class="VK_side_heading">
                                    Using Intel® Neural Compressor
                                </h3>
                                <p>
                                    We are using ResNet50 v1.0 as an example to explain how to use this tool for
                                    quantization and mixed precision optimization.
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Dataset_preparation">
                                <h3 class="VK_n22">
                                    Dataset preparation:
                                </h3>
                                <p>
                                    Step 1: Download and decompress the ImageNet validation dataset:
                                </p>
                                <p>
                                    To download the raw images, the user must create an account with
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        ImageNet.
                                    </a>
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy24('24')" id="VK_beet_btn24">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">mkdir –p img_raw/val
cd img_raw
wget http://www.image-net.org/challenges/LSVRC/2012/xxxxxxxx/ILSVRC2012_img_val.tar
tar –xvf ILSVRC2012_img_val.tar -C val</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Step 2: Move the image files to the child directories sorted by label:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy25('25')" id="VK_beet_btn25">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">cd val
wget -qO- https://raw.githubusercontent.com/soumith/imagenetloader.torch/master/valprep.sh | bash</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Step 3: Use the script, prepare_dataset.sh, to convert raw data to the TFrecord
                                    format with 128 shards:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy26('26')" id="VK_beet_btn26">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">git clone https://github.com/intel/neural-compressor.git
cd neural-compressor/
git checkout 6663f7b
cd examples/tensorflow/image_recognition/tensorflow_models/quantization/ptq
bash prepare_dataset.sh --output_dir=./data --raw_dir=/PATH/TO/img_raw/val/ --shards=128 --subset=validation</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Reference
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Pretrained_FP32_Model_preparation">
                                <h3 class="VK_n22">
                                    Pretrained FP32 Model preparation:
                                </h3>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy27('27')" id="VK_beet_btn27">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">wget https://storage.googleapis.com/intel-optimized-tensorflow/models/v1_6/resnet50_fp32_pretrained_model.pb</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Run_Quantization">
                                <h3 class="VK_n22">
                                    Run Quantization:
                                </h3>
                                <p>
                                    Edit the file:
                                </p>
                                <p>
                                    Change all default dataset path (root: /path/to/evaluation/dataset) for
                                    quantization, evaluation to real local path to save the TFRecord format dataset
                                    generated previously during the data preparation stage.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy28('28')" id="VK_beet_btn28">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">cd examples/tensorflow/image_recognition/tensorflow_models/quantization/ptq
    bash run_tuning.sh --config=resnet50_v1.yaml \
        --input_model=/PATH/TO/resnet50_fp32_pretrained_model.pb \
        --output_model=./nc_resnet50_v1.pb</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Reference
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Run_Mix_Precision_BF16">
                                <h3 class="VK_n22">
                                    Run Mix Precision (BF16 + FP32):
                                </h3>
                                <p>
                                    Refer to
                                    <a href="" class="Vk_text_underline_dots VK_a">
                                        Mixed Precision
                                    </a>
                                </p>
                            </section>
                            <section class="mt-5" id="VK_Convert_Without_Tuning_Accuracy">
                                <h3 class="VK_n22">
                                    Convert Without Tuning Accuracy
                                </h3>
                                <p>
                                    This method is sample and convert more nodes to BF16 as possible. The accuracy of
                                    model would be lossed as unexpected.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy29('29')" id="VK_beet_btn29">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0">python convert_bf16_without_tuning.py
    
<span class="VK_code_blue">from </span>neural_compressor.experimental <span class="VK_code_blue">import </span> MixedPrecision
converter = MixedPrecision()
converter.precisions = <span class="VK_code_blue">'bf16'</span>
converter.model = <span class="VK_code_blue">'/PATH/TO/resnet50_fp32_pretrained_model.pb'</span>
optimized_model = converter()
optimized_model.save(<span class="VK_code_blue">'nc_resnet50_v1_bf16.pb'</span>)</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Convert_With_Tuning_accuracy">
                                <h3 class="VK_n22">
                                    Convert With Tuning Accuracy
                                </h3>
                                <p class="m-0">
                                    This method is accuracy driven and needs evaluation precedure. The accuracy of model
                                    would be lossed as expected, but less nodes are converted to BF16 compared with
                                    above method.
                                </p>
                                <ol>
                                    <li>
                                        Edit resnet50_v1.yaml
                                    </li>
                                </ol>
                                <p>
                                    Add
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy30('30')" id="VK_beet_btn30">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_blue">mixed_precision:</span>
    <span class="VK_code_blue">precisions: </span><span class="VK_code_string"> 'bf16'</span></p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Like:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111(111)" id="VK_beet_btn111">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont111">
<pre class="VK_code-block"><p class="m-0"><span class="VK_code_blue">model:</span>
    <span class="VK_code_blue">name: </span> resnet50_v1
    <span class="VK_code_blue">framework: </span> tensorflow

<span class="VK_code_blue">mixed_precision: </span>
    <span class="VK_code_blue">precisions: </span> <span class="VK_code_string">'bf16'</span>

<span class="VK_code_blue">evaluation: </span>
    <span class="VK_code_blue">accuracy:</span>
        <span class="VK_code_blue">dataloader:</span>
            ...
        <span class="VK_code_blue"> metric:</span>
            ...</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <ol start="2">
                                    <li>
                                        Run Python
                                    </li>
                                </ol>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('33')" id="VK_beet_btn33">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont33">
<pre class="VK_code-block"><p class="m-0">python convert_bf16_with_tuning.py

<span class="VK_code_blue">from </span> neural_compressor.experimental <span class="VK_code_blue">import </span> MixedPrecision
converter = MixedPrecision(<span class="VK_code_string">'resnet50_v1.yaml'</span>)
converter.precisions = <span class="VK_code_string">'bf16'</span>
converter.model = <span class="VK_code_string">'/PATH/TO/resnet50_fp32_pretrained_model.pb'</span>
optimized_model = converter()
optimized_model.save(<span class="VK_code_blue">'nc_resnet50_v1_bf16.pb'</span>)</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>s
                            <section class="mt-5" id="VK_INT8_BF16_FP32">
                                <h3 class="VK_n22">
                                    INT8 + BF16 + FP32
                                </h3>
                                <p>
                                    It’s possible to mix INT8, BF16, FP32 in a model to optimize performance. In this
                                    example, we could apply mixed precesion on the quantized model: nc_resnet50_v1.pb.
                                    So we could get INT8 + BF16 + FP32 model.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('35')" id="VK_beet_btn35">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont35">
<pre class="VK_code-block"><p class="m-0">python convert_bf16_without_tuning.py

<span class="VK_code_blue">from  </span> neural_compressor.experimental <span class="VK_code_blue">import </span>  MixedPrecision
converter = MixedPrecision()
converter.precisions = <span class="VK_code_string">'bf16'</span>
converter.model = <span class="VK_code_sting">'/PATH/TO/nc_resnet50_v1.pb'</span>
optimized_model = converter()
optimized_model.save(<span class="VK_code_string">'nc_resnet50_v1_int8_bf16.pb'</span>)</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    In the log, we could see there is one operation: MatMul to be converted to BF16.
                                    That would improve the performance a little more. If the quantized model has more
                                    operations are FP32, mixed precision could convert more to BF16 and gain better
                                    performance.
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('34')" id="VK_beet_btn34">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont34">
<pre class="VK_code-block"><p class="m-0">2022-08-04 19:50:01 [INFO] |**********Mixed Precision Statistics**********|
2022-08-04 19:50:01 [INFO] +-------------+--------+-------+-------+-------+
2022-08-04 19:50:01 [INFO] |       Op Type       |    Total    |    INT8    |    BF16    |    FP32    |
2022-08-04 19:50:01 [INFO] +-------------+--------+-------+-------+-------+
2022-08-04 19:50:01 [INFO] |       MaxPool       |       1        |        1        |        0      |      0       |
2022-08-04 19:50:01 [INFO] |       AvgPool       |       1        |        1        |       0       |       0      | 
2022-08-04 19:50:01 [INFO] |        Conv2D       |      53     |       53      |       0       |       0      | 
2022-08-04 19:50:01 [INFO] |        MatMul        |       1        |       0       |       1        |       0       |
2022-08-04 19:50:01 [INFO] |     QuantizeV2   |       1        |        1        |       0       |       0       |
2022-08-04 19:50:01 [INFO] |     Dequantize   |       1        |        1        |       0       |       0       |
2022-08-04 19:50:01 [INFO] |          Cast          |       2        |       0       |        1       |       1        |
2022-08-04 19:50:01 [INFO] +-------------+--------+-------+-------+-------+</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                            <section class="mt-5" id="VK_Run_Benchmark">
                                <h3 class="VK_n22">
                                    Run Benchmark:
                                </h3>
                                <p>
                                    For performance:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('36')" id="VK_beet_btn36">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont36">
<pre class="VK_code-block"><p class="m-0">bash run_benchmark.sh --input_model=./xxx.pb --config=resnet50_v1.yaml --mode=performance</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Performance mode benchmark result:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('37')" id="VK_beet_btn37">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont37">
<pre class="VK_code-block"><p class="m-0">Batch size = 1
Latency: xxx
Throughput: xxx</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    For accuracy:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('38')" id="VK_beet_btn38">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont38">
<pre class="VK_code-block"><p class="m-0">bash run_benchmark.sh --input_model=./xxx.pb --config=resnet50_v1.yaml --mode=accuracy</p></pre>
                                        </code>
                                    </div>
                                </div>
                                <p>
                                    Accuracy mode benchmark result:
                                </p>
                                <div class="VK_theme_bg border my-5 pb-4 pt-1 px-4 rounded-3">
                                    <div class="text-end">
                                        <button class="m-0 text-primary border-0 bg-transparent VK_copy_btn"
                                            onclick="gen_4th_copy111('39')" id="VK_beet_btn39">
                                            <i class="fa-regular fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="VK_code-container">
                                        <div class="VK_line-number"></div>
                                        <code class="VK_theme_color" id="VK_code_cont39">
<pre class="VK_code-block"><p class="m-0">Accuracy is x.xx
    Batch size = 32</p></pre>
                                        </code>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </section>



        <!-- footer -->
        <footer>
            <div id="footer"></div>
        </footer>

    </main>


    <!---------------- Javascript Files ---------------->

    <!-- <script>
        // navbar include
        fetch('/y_index/y_navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
        // footer include 
        fetch('/y_index/y_footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            });
    </script> -->

    <!-- jquery -->
    <script src="/js/jquery-3.7.1.js"></script>


    <!-- bootstrap js file -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- costom js file -->
    <script src="/js/vivek.js"></script>

    <!-- all min -->
    <script src="/js/all.min.js"></script>

</body>

</html>